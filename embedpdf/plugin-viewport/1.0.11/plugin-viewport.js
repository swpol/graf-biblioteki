/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@embedpdf/plugin-viewport@1.0.11/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{BasePlugin as t,createBehaviorEmitter as i,createEmitter as e}from"/npm/@embedpdf/core@1.0.11/+esm";var l="viewport",r={id:l,name:"Viewport Plugin",version:"1.0.0",provides:["viewport"],requires:[],optional:[],defaultConfig:{enabled:!0,viewportGap:10,scrollEndDelay:300}},o="SET_VIEWPORT_METRICS",s="SET_VIEWPORT_SCROLL_METRICS",c="SET_VIEWPORT_GAP",a="SET_SCROLL_ACTIVITY";var p={viewportGap:0,viewportMetrics:{width:0,height:0,scrollTop:0,scrollLeft:0,clientWidth:0,clientHeight:0,scrollWidth:0,scrollHeight:0,relativePosition:{x:0,y:0}},isScrolling:!1},h=class extends t{constructor(t,l,r){var o;super(t,l),this.id=t,this.viewportResize$=i(),this.viewportMetrics$=i(),this.scrollMetrics$=i(),this.scrollReq$=e(),this.scrollActivity$=i(),this.rectProvider=null,r.viewportGap&&this.dispatch((o=r.viewportGap,{type:c,payload:o})),this.scrollEndDelay=r.scrollEndDelay||300}buildCapability(){return{getViewportGap:()=>this.state.viewportGap,getMetrics:()=>this.state.viewportMetrics,getBoundingRect:()=>this.rectProvider?.()??{origin:{x:0,y:0},size:{width:0,height:0}},scrollTo:t=>this.scrollTo(t),isScrolling:()=>this.state.isScrolling,onScrollChange:this.scrollMetrics$.on,onViewportChange:this.viewportMetrics$.on,onViewportResize:this.viewportResize$.on,onScrollActivity:this.scrollActivity$.on}}setViewportResizeMetrics(t){this.dispatch(function(t){return{type:o,payload:t}}(t)),this.viewportResize$.emit(this.state.viewportMetrics)}setViewportScrollMetrics(t){t.scrollTop===this.state.viewportMetrics.scrollTop&&t.scrollLeft===this.state.viewportMetrics.scrollLeft||(this.dispatch(function(t){return{type:s,payload:t}}(t)),this.bumpScrollActivity(),this.scrollMetrics$.emit({scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}))}onScrollRequest(t){return this.scrollReq$.on(t)}registerBoundingRectProvider(t){this.rectProvider=t}bumpScrollActivity(){this.debouncedDispatch({type:a,payload:!1},this.scrollEndDelay)}scrollTo(t){const{x:i,y:e,center:l,behavior:r="auto"}=t;if(l){const t=this.state.viewportMetrics,l=i-t.clientWidth/2,o=e-t.clientHeight/2;this.scrollReq$.emit({x:l,y:o,behavior:r})}else this.scrollReq$.emit({x:i,y:e,behavior:r})}onStoreUpdated(t,i){t!==i&&(this.viewportMetrics$.emit(i.viewportMetrics),t.isScrolling!==i.isScrolling&&this.scrollActivity$.emit(i.isScrolling))}async initialize(t){}async destroy(){super.destroy(),this.viewportMetrics$.clear(),this.viewportResize$.clear(),this.scrollMetrics$.clear(),this.scrollReq$.clear(),this.scrollActivity$.clear(),this.rectProvider=null,this.scrollEndTimer&&clearTimeout(this.scrollEndTimer)}};h.id="viewport";var n={manifest:r,create:(t,i,e)=>new h(l,t,e),reducer:(t=p,i)=>{switch(i.type){case c:return{...t,viewportGap:i.payload};case o:return{...t,viewportMetrics:{width:i.payload.width,height:i.payload.height,scrollTop:i.payload.scrollTop,scrollLeft:i.payload.scrollLeft,clientWidth:i.payload.clientWidth,clientHeight:i.payload.clientHeight,scrollWidth:i.payload.scrollWidth,scrollHeight:i.payload.scrollHeight,relativePosition:{x:i.payload.scrollWidth<=i.payload.clientWidth?0:i.payload.scrollLeft/(i.payload.scrollWidth-i.payload.clientWidth),y:i.payload.scrollHeight<=i.payload.clientHeight?0:i.payload.scrollTop/(i.payload.scrollHeight-i.payload.clientHeight)}}};case s:return{...t,viewportMetrics:{...t.viewportMetrics,scrollTop:i.payload.scrollTop,scrollLeft:i.payload.scrollLeft},isScrolling:!0};case a:return{...t,isScrolling:i.payload};default:return t}},initialState:p};export{l as VIEWPORT_PLUGIN_ID,h as ViewportPlugin,n as ViewportPluginPackage,r as manifest};export default null;
//# sourceMappingURL=/sm/8f9b756fa1a560a8a5a0b417add3ef3b632e61491124ff448b56f2dc2958e3c0.map