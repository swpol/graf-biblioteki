{"version":3,"file":"index.cjs","sources":["../../src/preact/hooks/use-viewport.ts","../../src/preact/hooks/use-viewport-ref.ts","../../src/preact/components/viewport.tsx"],"sourcesContent":["import { useCapability, usePlugin } from '@embedpdf/core/preact';\nimport { ViewportPlugin } from '@embedpdf/plugin-viewport';\n\nexport const useViewportPlugin = () => usePlugin<ViewportPlugin>(ViewportPlugin.id);\nexport const useViewportCapability = () => useCapability<ViewportPlugin>(ViewportPlugin.id);\n","import { Rect } from '@embedpdf/models';\nimport { RefObject } from 'preact';\nimport { useLayoutEffect, useRef } from 'preact/hooks';\n\nimport { useViewportPlugin } from './use-viewport';\n\nexport function useViewportRef(): RefObject<HTMLDivElement> {\n  const { plugin: viewportPlugin } = useViewportPlugin();\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  useLayoutEffect(() => {\n    if (!viewportPlugin) return;\n\n    const container = containerRef.current;\n    if (!container) return;\n\n    /* ---------- live rect provider --------------------------------- */\n    const provideRect = (): Rect => {\n      const r = container.getBoundingClientRect();\n      return {\n        origin: { x: r.left, y: r.top },\n        size: { width: r.width, height: r.height },\n      };\n    };\n    viewportPlugin.registerBoundingRectProvider(provideRect);\n\n    // Example: On scroll, call setMetrics\n    const onScroll = () => {\n      viewportPlugin.setViewportScrollMetrics({\n        scrollTop: container.scrollTop,\n        scrollLeft: container.scrollLeft,\n      });\n    };\n    container.addEventListener('scroll', onScroll);\n\n    // Example: On resize, call setMetrics\n    const resizeObserver = new ResizeObserver(() => {\n      viewportPlugin.setViewportResizeMetrics({\n        width: container.offsetWidth,\n        height: container.offsetHeight,\n        clientWidth: container.clientWidth,\n        clientHeight: container.clientHeight,\n        scrollTop: container.scrollTop,\n        scrollLeft: container.scrollLeft,\n        scrollWidth: container.scrollWidth,\n        scrollHeight: container.scrollHeight,\n      });\n    });\n    resizeObserver.observe(container);\n\n    const unsubscribeScrollRequest = viewportPlugin.onScrollRequest(\n      ({ x, y, behavior = 'auto' }) => {\n        requestAnimationFrame(() => {\n          container.scrollTo({ left: x, top: y, behavior });\n        });\n      },\n    );\n\n    // Cleanup\n    return () => {\n      viewportPlugin.registerBoundingRectProvider(null);\n      container.removeEventListener('scroll', onScroll);\n      resizeObserver.disconnect();\n      unsubscribeScrollRequest();\n    };\n  }, [viewportPlugin]);\n\n  // Return the ref so your React code can attach it to a div\n  return containerRef;\n}\n","/** @jsxImportSource preact */\nimport { ComponentChildren, JSX } from 'preact';\nimport { useEffect, useState } from 'preact/hooks';\n\nimport { useViewportCapability } from '../hooks';\nimport { useViewportRef } from '../hooks/use-viewport-ref';\n\ntype ViewportProps = JSX.HTMLAttributes<HTMLDivElement> & {\n  children: ComponentChildren;\n};\n\nexport function Viewport({ children, ...props }: ViewportProps) {\n  const [viewportGap, setViewportGap] = useState(0);\n  const viewportRef = useViewportRef();\n  const { provides: viewportProvides } = useViewportCapability();\n\n  useEffect(() => {\n    if (viewportProvides) {\n      setViewportGap(viewportProvides.getViewportGap());\n    }\n  }, [viewportProvides]);\n\n  const { style, ...restProps } = props;\n  return (\n    <div\n      {...restProps}\n      ref={viewportRef}\n      style={{\n        ...(typeof style === 'object' ? style : {}),\n        padding: `${viewportGap}px`,\n      }}\n    >\n      {children}\n    </div>\n  );\n}\n"],"names":["useViewportPlugin","usePlugin","ViewportPlugin","useViewportCapability","useCapability","useViewportRef","viewportPlugin","containerRef","useRef","useLayoutEffect","container","provideRect","r","onScroll","resizeObserver","unsubscribeScrollRequest","x","y","behavior","Viewport","children","props","viewportGap","setViewportGap","useState","viewportRef","viewportProvides","useEffect","style","restProps","jsx"],"mappings":"0NAGaA,EAAoB,IAAMC,YAA0BC,EAAAA,eAAe,EAAE,EACrEC,EAAwB,IAAMC,gBAA8BF,EAAAA,eAAe,EAAE,ECEnF,SAASG,GAA4C,CAC1D,KAAM,CAAE,OAAQC,CAAe,EAAIN,EAAkB,EAC/CO,EAAeC,SAAuB,IAAI,EAEhDC,OAAAA,EAAAA,gBAAgB,IAAM,CACpB,GAAI,CAACH,EAAgB,OAErB,MAAMI,EAAYH,EAAa,QAC/B,GAAI,CAACG,EAAW,OAGhB,MAAMC,EAAc,IAAY,CACxB,MAAAC,EAAIF,EAAU,sBAAsB,EACnC,MAAA,CACL,OAAQ,CAAE,EAAGE,EAAE,KAAM,EAAGA,EAAE,GAAI,EAC9B,KAAM,CAAE,MAAOA,EAAE,MAAO,OAAQA,EAAE,MAAO,CAC3C,CACF,EACAN,EAAe,6BAA6BK,CAAW,EAGvD,MAAME,EAAW,IAAM,CACrBP,EAAe,yBAAyB,CACtC,UAAWI,EAAU,UACrB,WAAYA,EAAU,UAAA,CACvB,CACH,EACUA,EAAA,iBAAiB,SAAUG,CAAQ,EAGvC,MAAAC,EAAiB,IAAI,eAAe,IAAM,CAC9CR,EAAe,yBAAyB,CACtC,MAAOI,EAAU,YACjB,OAAQA,EAAU,aAClB,YAAaA,EAAU,YACvB,aAAcA,EAAU,aACxB,UAAWA,EAAU,UACrB,WAAYA,EAAU,WACtB,YAAaA,EAAU,YACvB,aAAcA,EAAU,YAAA,CACzB,CAAA,CACF,EACDI,EAAe,QAAQJ,CAAS,EAEhC,MAAMK,EAA2BT,EAAe,gBAC9C,CAAC,CAAE,EAAAU,EAAG,EAAAC,EAAG,SAAAC,EAAW,UAAa,CAC/B,sBAAsB,IAAM,CAC1BR,EAAU,SAAS,CAAE,KAAMM,EAAG,IAAKC,EAAG,SAAAC,EAAU,CAAA,CACjD,CAAA,CAEL,EAGA,MAAO,IAAM,CACXZ,EAAe,6BAA6B,IAAI,EACtCI,EAAA,oBAAoB,SAAUG,CAAQ,EAChDC,EAAe,WAAW,EACDC,EAAA,CAC3B,CAAA,EACC,CAACT,CAAc,CAAC,EAGZC,CACT,CC1DO,SAASY,EAAS,CAAE,SAAAC,EAAU,GAAGC,GAAwB,CAC9D,KAAM,CAACC,EAAaC,CAAc,EAAIC,EAAAA,SAAS,CAAC,EAC1CC,EAAcpB,EAAe,EAC7B,CAAE,SAAUqB,CAAiB,EAAIvB,EAAsB,EAE7DwB,EAAAA,UAAU,IAAM,CACVD,GACaH,EAAAG,EAAiB,gBAAgB,CAClD,EACC,CAACA,CAAgB,CAAC,EAErB,KAAM,CAAE,MAAAE,EAAO,GAAGC,CAAA,EAAcR,EAE9B,OAAAS,EAAA,IAAC,MAAA,CACE,GAAGD,EACJ,IAAKJ,EACL,MAAO,CACL,GAAI,OAAOG,GAAU,SAAWA,EAAQ,CAAC,EACzC,QAAS,GAAGN,CAAW,IACzB,EAEC,SAAAF,CAAA,CACH,CAEJ"}