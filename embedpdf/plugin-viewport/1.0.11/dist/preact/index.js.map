{"version":3,"file":"index.js","sources":["../../../core/dist/preact/index.js","../../src/preact/hooks/use-viewport.ts","../../src/preact/hooks/use-viewport-ref.ts","../../src/preact/components/viewport.tsx"],"sourcesContent":["import { createContext as b } from \"preact\";\nimport { u as w } from \"../jsxRuntime.module-Bzuv3cXw.js\";\nimport { useState as a, useRef as m, useEffect as f, useContext as S } from \"preact/hooks\";\nimport { P as v, a as C } from \"../math-ChSRQF3r.js\";\nconst P = b({\n  registry: null,\n  isInitializing: !0,\n  pluginsReady: !1\n});\nfunction F({ engine: t, onInitialized: r, plugins: e, children: i }) {\n  const [o, s] = a(null), [u, c] = a(!0), [y, d] = a(!1), l = m(r);\n  return f(() => {\n    l.current = r;\n  }, [r]), f(() => {\n    const n = new v(t);\n    return n.registerPluginBatch(e), (async () => {\n      var p;\n      await n.initialize(), !n.isDestroyed() && (await ((p = l.current) == null ? void 0 : p.call(l, n)), !n.isDestroyed() && (n.pluginsReady().then(() => {\n        n.isDestroyed() || d(!0);\n      }), s(n), c(!1)));\n    })().catch(console.error), () => {\n      n.destroy(), s(null), c(!0), d(!1);\n    };\n  }, [t, e]), /* @__PURE__ */ w(P.Provider, { value: { registry: o, isInitializing: u, pluginsReady: y }, children: typeof i == \"function\" ? i({ registry: o, isInitializing: u, pluginsReady: y }) : i });\n}\nfunction g() {\n  const t = S(P);\n  if (t === void 0)\n    throw new Error(\"useCapability must be used within a PDFContext.Provider\");\n  const { registry: r, isInitializing: e } = t;\n  if (e)\n    return t;\n  if (r === null)\n    throw new Error(\"PDF registry failed to initialize properly\");\n  return t;\n}\nfunction h(t) {\n  const { registry: r } = g();\n  if (r === null)\n    return {\n      plugin: null,\n      isLoading: !0,\n      ready: new Promise(() => {\n      })\n    };\n  const e = r.getPlugin(t);\n  if (!e)\n    throw new Error(`Plugin ${t} not found`);\n  return {\n    plugin: e,\n    isLoading: !1,\n    ready: e.ready()\n  };\n}\nfunction L(t) {\n  const { plugin: r, isLoading: e, ready: i } = h(t);\n  if (!r)\n    return {\n      provides: null,\n      isLoading: e,\n      ready: i\n    };\n  if (!r.provides)\n    throw new Error(`Plugin ${t} does not provide a capability`);\n  return {\n    provides: r.provides(),\n    isLoading: e,\n    ready: i\n  };\n}\nfunction V() {\n  const { registry: t } = g(), [r, e] = a(null);\n  return f(() => {\n    if (!t) return;\n    e(t.getStore().getState());\n    const i = t.getStore().subscribe((o, s) => {\n      e(s);\n    });\n    return () => i();\n  }, [t]), r;\n}\nfunction $() {\n  const { registry: t } = g(), [r, e] = a(null);\n  return f(() => {\n    if (!t) return;\n    const i = t.getStore();\n    e(i.getState().core);\n    const o = i.subscribe((s, u, c) => {\n      i.isCoreAction(s) && !C(u.core, c.core) && e(u.core);\n    });\n    return () => o();\n  }, [t]), r;\n}\nexport {\n  F as EmbedPDF,\n  P as PDFContext,\n  L as useCapability,\n  $ as useCoreState,\n  h as usePlugin,\n  g as useRegistry,\n  V as useStoreState\n};\n//# sourceMappingURL=index.js.map\n","import { useCapability, usePlugin } from '@embedpdf/core/preact';\nimport { ViewportPlugin } from '@embedpdf/plugin-viewport';\n\nexport const useViewportPlugin = () => usePlugin<ViewportPlugin>(ViewportPlugin.id);\nexport const useViewportCapability = () => useCapability<ViewportPlugin>(ViewportPlugin.id);\n","import { Rect } from '@embedpdf/models';\nimport { RefObject } from 'preact';\nimport { useLayoutEffect, useRef } from 'preact/hooks';\n\nimport { useViewportPlugin } from './use-viewport';\n\nexport function useViewportRef(): RefObject<HTMLDivElement> {\n  const { plugin: viewportPlugin } = useViewportPlugin();\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  useLayoutEffect(() => {\n    if (!viewportPlugin) return;\n\n    const container = containerRef.current;\n    if (!container) return;\n\n    /* ---------- live rect provider --------------------------------- */\n    const provideRect = (): Rect => {\n      const r = container.getBoundingClientRect();\n      return {\n        origin: { x: r.left, y: r.top },\n        size: { width: r.width, height: r.height },\n      };\n    };\n    viewportPlugin.registerBoundingRectProvider(provideRect);\n\n    // Example: On scroll, call setMetrics\n    const onScroll = () => {\n      viewportPlugin.setViewportScrollMetrics({\n        scrollTop: container.scrollTop,\n        scrollLeft: container.scrollLeft,\n      });\n    };\n    container.addEventListener('scroll', onScroll);\n\n    // Example: On resize, call setMetrics\n    const resizeObserver = new ResizeObserver(() => {\n      viewportPlugin.setViewportResizeMetrics({\n        width: container.offsetWidth,\n        height: container.offsetHeight,\n        clientWidth: container.clientWidth,\n        clientHeight: container.clientHeight,\n        scrollTop: container.scrollTop,\n        scrollLeft: container.scrollLeft,\n        scrollWidth: container.scrollWidth,\n        scrollHeight: container.scrollHeight,\n      });\n    });\n    resizeObserver.observe(container);\n\n    const unsubscribeScrollRequest = viewportPlugin.onScrollRequest(\n      ({ x, y, behavior = 'auto' }) => {\n        requestAnimationFrame(() => {\n          container.scrollTo({ left: x, top: y, behavior });\n        });\n      },\n    );\n\n    // Cleanup\n    return () => {\n      viewportPlugin.registerBoundingRectProvider(null);\n      container.removeEventListener('scroll', onScroll);\n      resizeObserver.disconnect();\n      unsubscribeScrollRequest();\n    };\n  }, [viewportPlugin]);\n\n  // Return the ref so your React code can attach it to a div\n  return containerRef;\n}\n","/** @jsxImportSource preact */\nimport { ComponentChildren, JSX } from 'preact';\nimport { useEffect, useState } from 'preact/hooks';\n\nimport { useViewportCapability } from '../hooks';\nimport { useViewportRef } from '../hooks/use-viewport-ref';\n\ntype ViewportProps = JSX.HTMLAttributes<HTMLDivElement> & {\n  children: ComponentChildren;\n};\n\nexport function Viewport({ children, ...props }: ViewportProps) {\n  const [viewportGap, setViewportGap] = useState(0);\n  const viewportRef = useViewportRef();\n  const { provides: viewportProvides } = useViewportCapability();\n\n  useEffect(() => {\n    if (viewportProvides) {\n      setViewportGap(viewportProvides.getViewportGap());\n    }\n  }, [viewportProvides]);\n\n  const { style, ...restProps } = props;\n  return (\n    <div\n      {...restProps}\n      ref={viewportRef}\n      style={{\n        ...(typeof style === 'object' ? style : {}),\n        padding: `${viewportGap}px`,\n      }}\n    >\n      {children}\n    </div>\n  );\n}\n"],"names":["b","g","S","h","i","useViewportPlugin","usePlugin","ViewportPlugin","useViewportCapability","useCapability","useViewportRef","viewportPlugin","containerRef","useRef","useLayoutEffect","container","provideRect","r","onScroll","resizeObserver","unsubscribeScrollRequest","x","y","behavior","Viewport","children","props","viewportGap","setViewportGap","useState","viewportRef","viewportProvides","useEffect","style","restProps","jsx"],"mappings":"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"}