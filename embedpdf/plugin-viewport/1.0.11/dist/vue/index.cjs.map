{"version":3,"file":"index.cjs","sources":["../../../core/dist/vue/index.js","../../src/vue/hooks/use-viewport.ts","../../src/vue/hooks/use-viewport-ref.ts","../../src/vue/components/viewport.vue"],"sourcesContent":["import { inject as p, ref as u, onMounted as a, onBeforeUnmount as l, shallowRef as d, watch as v, computed as y, defineComponent as m, provide as P, renderSlot as w } from \"vue\";\nimport { a as h, P as S } from \"../math-ChSRQF3r.js\";\nconst f = Symbol(\"pdfKey\");\nfunction c() {\n  const r = p(f);\n  if (!r) throw new Error(\"useRegistry must be used inside <EmbedPDF>\");\n  return r;\n}\nfunction b() {\n  const { registry: r } = c(), e = u();\n  return a(() => {\n    const o = r.value.getStore();\n    e.value = o.getState().core;\n    const t = o.subscribe((s, n, i) => {\n      o.isCoreAction(s) && !h(n.core, i.core) && (e.value = n.core);\n    });\n    l(t);\n  }), e;\n}\nfunction R(r) {\n  const { registry: e } = c(), o = d(null), t = u(!0), s = u(new Promise(() => {\n  })), n = () => {\n    var g;\n    if (!e.value) return;\n    const i = e.value.getPlugin(r);\n    if (!i) throw new Error(`Plugin ${r} not found`);\n    o.value = i, t.value = !1, s.value = ((g = i.ready) == null ? void 0 : g.call(i)) ?? Promise.resolve();\n  };\n  return a(n), v(e, n), { plugin: o, isLoading: t, ready: s };\n}\nfunction z(r) {\n  const { plugin: e, isLoading: o, ready: t } = R(r);\n  return { provides: y(() => {\n    if (!e.value) return null;\n    if (!e.value.provides)\n      throw new Error(`Plugin ${r} does not implement provides()`);\n    return e.value.provides();\n  }), isLoading: o, ready: t };\n}\nfunction C() {\n  const { registry: r } = c(), e = u();\n  function o() {\n    return r.value ? (e.value = r.value.getStore().getState(), r.value.getStore().subscribe((s, n) => e.value = n)) : () => {\n    };\n  }\n  let t = o();\n  return v(r, () => {\n    t == null || t(), t = o();\n  }), l(() => t == null ? void 0 : t()), e;\n}\nconst F = /* @__PURE__ */ m({\n  __name: \"embed-pdf\",\n  props: {\n    engine: {},\n    plugins: {},\n    onInitialized: { type: Function }\n  },\n  setup(r) {\n    const e = r, o = d(null), t = u(!0), s = u(!1);\n    return P(f, { registry: o, isInitializing: t, pluginsReady: s }), a(async () => {\n      var i;\n      const n = new S(e.engine);\n      n.registerPluginBatch(e.plugins), await n.initialize(), await ((i = e.onInitialized) == null ? void 0 : i.call(e, n)), o.value = n, t.value = !1, n.pluginsReady().then(() => s.value = !0);\n    }), l(() => {\n      var n;\n      return (n = o.value) == null ? void 0 : n.destroy();\n    }), (n, i) => w(n.$slots, \"default\", {\n      registry: o.value,\n      isInitializing: t.value,\n      pluginsReady: s.value\n    });\n  }\n});\nexport {\n  F as EmbedPDF,\n  z as useCapability,\n  b as useCoreState,\n  R as usePlugin,\n  c as useRegistry,\n  C as useStoreState\n};\n//# sourceMappingURL=index.js.map\n","import { useCapability, usePlugin } from '@embedpdf/core/vue';\nimport { ViewportPlugin } from '@embedpdf/plugin-viewport';\n\nexport const useViewportPlugin = () => usePlugin<ViewportPlugin>(ViewportPlugin.id);\nexport const useViewportCapability = () => useCapability<ViewportPlugin>(ViewportPlugin.id);\n","import { Rect } from '@embedpdf/models';\nimport { onMounted, onUnmounted, ref } from 'vue';\n\nimport { useViewportPlugin } from './use-viewport';\n\nexport function useViewportRef() {\n  const { plugin: pluginRef } = useViewportPlugin();\n  const containerRef = ref<HTMLDivElement | null>(null);\n\n  onMounted(() => {\n    const viewportPlugin = pluginRef.value;\n    const container = containerRef.value;\n    if (!container || !viewportPlugin) return;\n\n    /* ---------- live rect provider --------------------------------- */\n    const provideRect = (): Rect => {\n      const r = container.getBoundingClientRect();\n      return {\n        origin: { x: r.left, y: r.top },\n        size: { width: r.width, height: r.height },\n      };\n    };\n    viewportPlugin.registerBoundingRectProvider(provideRect);\n\n    // Example: On scroll, call setMetrics\n    const onScroll = () => {\n      viewportPlugin.setViewportScrollMetrics({\n        scrollTop: container.scrollTop,\n        scrollLeft: container.scrollLeft,\n      });\n    };\n    container.addEventListener('scroll', onScroll);\n\n    // Example: On resize, call setMetrics\n    const resizeObserver = new ResizeObserver(() => {\n      viewportPlugin.setViewportResizeMetrics({\n        width: container.offsetWidth,\n        height: container.offsetHeight,\n        clientWidth: container.clientWidth,\n        clientHeight: container.clientHeight,\n        scrollTop: container.scrollTop,\n        scrollLeft: container.scrollLeft,\n        scrollWidth: container.scrollWidth,\n        scrollHeight: container.scrollHeight,\n      });\n    });\n    resizeObserver.observe(container);\n\n    const unsubscribeScrollRequest = viewportPlugin.onScrollRequest(\n      ({ x, y, behavior = 'auto' }) => {\n        requestAnimationFrame(() => {\n          container.scrollTo({ left: x, top: y, behavior });\n        });\n      },\n    );\n\n    onUnmounted(() => {\n      viewportPlugin.registerBoundingRectProvider(null);\n      container.removeEventListener('scroll', onScroll);\n      resizeObserver.disconnect();\n      unsubscribeScrollRequest();\n    });\n  });\n\n  // Return the ref so your Vue code can attach it to a div\n  return containerRef;\n}\n","<script setup lang=\"ts\">\nimport { ref, watch, useAttrs } from 'vue';\n\nimport { useViewportCapability, useViewportRef } from '../hooks';\n\n/* -------------------------------------------------- */\n/* props & attrs                                      */\n/* -------------------------------------------------- */\nconst attrs = useAttrs(); // forward class/id/â€¦ to <div>\n\n/* -------------------------------------------------- */\n/* plugin + reactive viewport gap                     */\n/* -------------------------------------------------- */\nconst { provides: viewportProvides } = useViewportCapability();\nconst viewportGap = ref(0);\n\nwatch(\n  viewportProvides,\n  (vp) => {\n    if (vp) viewportGap.value = vp.getViewportGap();\n  },\n  { immediate: true },\n);\n\n/* -------------------------------------------------- */\n/* element ref that wires up scroll / resize logic    */\n/* -------------------------------------------------- */\nconst viewportRef = useViewportRef();\n</script>\n\n<template>\n  <div ref=\"viewportRef\" v-bind=\"attrs\" :style=\"{ padding: `${viewportGap}px` }\">\n    <slot />\n  </div>\n</template>\n"],"names":["f","c","r","p","R","e","o","d","t","u","g","i","a","v","z","y","useViewportPlugin","usePlugin","ViewportPlugin","useViewportCapability","useCapability","useViewportRef","pluginRef","containerRef","ref","onMounted","viewportPlugin","container","provideRect","onScroll","resizeObserver","unsubscribeScrollRequest","x","behavior","onUnmounted","attrs","useAttrs","viewportProvides","viewportGap","watch","vp","viewportRef","_openBlock","_createElementBlock","_mergeProps","_unref","_renderSlot","_ctx"],"mappings":"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"}