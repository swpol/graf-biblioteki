{"version":3,"file":"index.js","sources":["../../../core/dist/vue/index.js","../../src/vue/hooks/use-viewport.ts","../../src/vue/hooks/use-viewport-ref.ts","../../src/vue/components/viewport.vue"],"sourcesContent":["import { inject as p, ref as u, onMounted as a, onBeforeUnmount as l, shallowRef as d, watch as v, computed as y, defineComponent as m, provide as P, renderSlot as w } from \"vue\";\nimport { a as h, P as S } from \"../math-ChSRQF3r.js\";\nconst f = Symbol(\"pdfKey\");\nfunction c() {\n  const r = p(f);\n  if (!r) throw new Error(\"useRegistry must be used inside <EmbedPDF>\");\n  return r;\n}\nfunction b() {\n  const { registry: r } = c(), e = u();\n  return a(() => {\n    const o = r.value.getStore();\n    e.value = o.getState().core;\n    const t = o.subscribe((s, n, i) => {\n      o.isCoreAction(s) && !h(n.core, i.core) && (e.value = n.core);\n    });\n    l(t);\n  }), e;\n}\nfunction R(r) {\n  const { registry: e } = c(), o = d(null), t = u(!0), s = u(new Promise(() => {\n  })), n = () => {\n    var g;\n    if (!e.value) return;\n    const i = e.value.getPlugin(r);\n    if (!i) throw new Error(`Plugin ${r} not found`);\n    o.value = i, t.value = !1, s.value = ((g = i.ready) == null ? void 0 : g.call(i)) ?? Promise.resolve();\n  };\n  return a(n), v(e, n), { plugin: o, isLoading: t, ready: s };\n}\nfunction z(r) {\n  const { plugin: e, isLoading: o, ready: t } = R(r);\n  return { provides: y(() => {\n    if (!e.value) return null;\n    if (!e.value.provides)\n      throw new Error(`Plugin ${r} does not implement provides()`);\n    return e.value.provides();\n  }), isLoading: o, ready: t };\n}\nfunction C() {\n  const { registry: r } = c(), e = u();\n  function o() {\n    return r.value ? (e.value = r.value.getStore().getState(), r.value.getStore().subscribe((s, n) => e.value = n)) : () => {\n    };\n  }\n  let t = o();\n  return v(r, () => {\n    t == null || t(), t = o();\n  }), l(() => t == null ? void 0 : t()), e;\n}\nconst F = /* @__PURE__ */ m({\n  __name: \"embed-pdf\",\n  props: {\n    engine: {},\n    plugins: {},\n    onInitialized: { type: Function }\n  },\n  setup(r) {\n    const e = r, o = d(null), t = u(!0), s = u(!1);\n    return P(f, { registry: o, isInitializing: t, pluginsReady: s }), a(async () => {\n      var i;\n      const n = new S(e.engine);\n      n.registerPluginBatch(e.plugins), await n.initialize(), await ((i = e.onInitialized) == null ? void 0 : i.call(e, n)), o.value = n, t.value = !1, n.pluginsReady().then(() => s.value = !0);\n    }), l(() => {\n      var n;\n      return (n = o.value) == null ? void 0 : n.destroy();\n    }), (n, i) => w(n.$slots, \"default\", {\n      registry: o.value,\n      isInitializing: t.value,\n      pluginsReady: s.value\n    });\n  }\n});\nexport {\n  F as EmbedPDF,\n  z as useCapability,\n  b as useCoreState,\n  R as usePlugin,\n  c as useRegistry,\n  C as useStoreState\n};\n//# sourceMappingURL=index.js.map\n","import { useCapability, usePlugin } from '@embedpdf/core/vue';\nimport { ViewportPlugin } from '@embedpdf/plugin-viewport';\n\nexport const useViewportPlugin = () => usePlugin<ViewportPlugin>(ViewportPlugin.id);\nexport const useViewportCapability = () => useCapability<ViewportPlugin>(ViewportPlugin.id);\n","import { Rect } from '@embedpdf/models';\nimport { onMounted, onUnmounted, ref } from 'vue';\n\nimport { useViewportPlugin } from './use-viewport';\n\nexport function useViewportRef() {\n  const { plugin: pluginRef } = useViewportPlugin();\n  const containerRef = ref<HTMLDivElement | null>(null);\n\n  onMounted(() => {\n    const viewportPlugin = pluginRef.value;\n    const container = containerRef.value;\n    if (!container || !viewportPlugin) return;\n\n    /* ---------- live rect provider --------------------------------- */\n    const provideRect = (): Rect => {\n      const r = container.getBoundingClientRect();\n      return {\n        origin: { x: r.left, y: r.top },\n        size: { width: r.width, height: r.height },\n      };\n    };\n    viewportPlugin.registerBoundingRectProvider(provideRect);\n\n    // Example: On scroll, call setMetrics\n    const onScroll = () => {\n      viewportPlugin.setViewportScrollMetrics({\n        scrollTop: container.scrollTop,\n        scrollLeft: container.scrollLeft,\n      });\n    };\n    container.addEventListener('scroll', onScroll);\n\n    // Example: On resize, call setMetrics\n    const resizeObserver = new ResizeObserver(() => {\n      viewportPlugin.setViewportResizeMetrics({\n        width: container.offsetWidth,\n        height: container.offsetHeight,\n        clientWidth: container.clientWidth,\n        clientHeight: container.clientHeight,\n        scrollTop: container.scrollTop,\n        scrollLeft: container.scrollLeft,\n        scrollWidth: container.scrollWidth,\n        scrollHeight: container.scrollHeight,\n      });\n    });\n    resizeObserver.observe(container);\n\n    const unsubscribeScrollRequest = viewportPlugin.onScrollRequest(\n      ({ x, y, behavior = 'auto' }) => {\n        requestAnimationFrame(() => {\n          container.scrollTo({ left: x, top: y, behavior });\n        });\n      },\n    );\n\n    onUnmounted(() => {\n      viewportPlugin.registerBoundingRectProvider(null);\n      container.removeEventListener('scroll', onScroll);\n      resizeObserver.disconnect();\n      unsubscribeScrollRequest();\n    });\n  });\n\n  // Return the ref so your Vue code can attach it to a div\n  return containerRef;\n}\n","<script setup lang=\"ts\">\nimport { ref, watch, useAttrs } from 'vue';\n\nimport { useViewportCapability, useViewportRef } from '../hooks';\n\n/* -------------------------------------------------- */\n/* props & attrs                                      */\n/* -------------------------------------------------- */\nconst attrs = useAttrs(); // forward class/id/â€¦ to <div>\n\n/* -------------------------------------------------- */\n/* plugin + reactive viewport gap                     */\n/* -------------------------------------------------- */\nconst { provides: viewportProvides } = useViewportCapability();\nconst viewportGap = ref(0);\n\nwatch(\n  viewportProvides,\n  (vp) => {\n    if (vp) viewportGap.value = vp.getViewportGap();\n  },\n  { immediate: true },\n);\n\n/* -------------------------------------------------- */\n/* element ref that wires up scroll / resize logic    */\n/* -------------------------------------------------- */\nconst viewportRef = useViewportRef();\n</script>\n\n<template>\n  <div ref=\"viewportRef\" v-bind=\"attrs\" :style=\"{ padding: `${viewportGap}px` }\">\n    <slot />\n  </div>\n</template>\n"],"names":["f","c","p","R","e","o","d","t","u","s","n","g","i","a","v","z","y","useViewportPlugin","usePlugin","ViewportPlugin","useViewportCapability","useCapability","useViewportRef","pluginRef","containerRef","ref","onMounted","viewportPlugin","container","provideRect","r","onScroll","resizeObserver","unsubscribeScrollRequest","x","behavior","onUnmounted","attrs","useAttrs","viewportProvides","viewportGap","watch","vp","viewportRef","_openBlock","_createElementBlock","_mergeProps","_unref","_renderSlot","_ctx"],"mappings":"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"}