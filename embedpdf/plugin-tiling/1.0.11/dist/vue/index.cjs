"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),d=require("../tiling-plugin-DX16Gr9b.cjs"),y=Symbol("pdfKey");function m(){const i=e.inject(y);if(!i)throw new Error("useRegistry must be used inside <EmbedPDF>");return i}function f(i){const{registry:n}=m(),o=e.shallowRef(null),r=e.ref(!0),l=e.ref(new Promise(()=>{})),t=()=>{var u;if(!n.value)return;const a=n.value.getPlugin(i);if(!a)throw new Error(`Plugin ${i} not found`);o.value=a,r.value=!1,l.value=((u=a.ready)==null?void 0:u.call(a))??Promise.resolve()};return e.onMounted(t),e.watch(n,t),{plugin:o,isLoading:r,ready:l}}function b(i){const{plugin:n,isLoading:o,ready:r}=f(i);return{provides:e.computed(()=>{if(!n.value)return null;if(!n.value.provides)throw new Error(`Plugin ${i} does not implement provides()`);return n.value.provides()}),isLoading:o,ready:r}}const k=()=>f(d.TilingPlugin.id),g=()=>b(d.TilingPlugin.id),P=["src"],v=e.defineComponent({__name:"tile-img",props:{pageIndex:{},tile:{},scale:{},dpr:{default:()=>window.devicePixelRatio},style:{type:[Boolean,null,String,Object,Array]}},setup(i){const n=i,{provides:o}=g(),r=e.ref();let l=null,t=null;function u(){l&&(URL.revokeObjectURL(l),l=null)}function a(){t&&!l&&t.abort({code:d.PdfErrorCode.Cancelled,message:"canceled tile render"})}e.onMounted(()=>{if(!o.value)return;const s=o.value.renderTile({pageIndex:n.pageIndex,tile:e.toRaw(n.tile),dpr:n.dpr});t=s,s.wait(p=>{l=URL.createObjectURL(p),r.value=l,t=null},d.ignore)}),e.onBeforeUnmount(()=>{a(),u()});const c=n.scale/n.tile.srcScale;return(s,p)=>r.value?(e.openBlock(),e.createElementBlock("img",{key:0,src:r.value,style:e.normalizeStyle([{position:"absolute",left:s.tile.screenRect.origin.x*c+"px",top:s.tile.screenRect.origin.y*c+"px",width:s.tile.screenRect.size.width*c+"px",height:s.tile.screenRect.size.height*c+"px",display:"block"},n.style]),onLoad:u},null,44,P)):e.createCommentVNode("",!0)}}),w=e.defineComponent({__name:"tiling-layer",props:{pageIndex:{},scale:{},style:{type:[Boolean,null,String,Object,Array]}},setup(i){const n=i,o=e.ref([]),{provides:r}=g();let l;return e.onMounted(()=>{r.value&&(l=r.value.onTileRendering(t=>{o.value=t[n.pageIndex]??[]}))}),e.onBeforeUnmount(()=>{l==null||l()}),(t,u)=>(e.openBlock(),e.createElementBlock("div",e.mergeProps({style:t.style},t.$attrs),[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,a=>(e.openBlock(),e.createBlock(v,{key:a.id,pageIndex:t.pageIndex,tile:a,scale:t.scale},null,8,["pageIndex","tile","scale"]))),128))],16))}});exports.TileImg=v;exports.TilingLayer=w;exports.useTilingCapability=g;exports.useTilingPlugin=k;
//# sourceMappingURL=index.cjs.map
