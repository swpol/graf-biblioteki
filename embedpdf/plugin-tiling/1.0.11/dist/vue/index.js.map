{"version":3,"file":"index.js","sources":["../../src/vue/hooks/use-tiling.ts","../../src/vue/components/tile-img.vue","../../src/vue/components/tiling-layer.vue"],"sourcesContent":["import { useCapability, usePlugin } from '@embedpdf/core/vue';\nimport { TilingPlugin } from '@embedpdf/plugin-tiling';\n\n/** Get the plugin instance itself (e.g. to read config) */\nexport const useTilingPlugin = () => usePlugin<TilingPlugin>(TilingPlugin.id);\n/** Get the *capability* the plugin exposes (renderTile, onTileRendering) */\nexport const useTilingCapability = () => useCapability<TilingPlugin>(TilingPlugin.id);\n","<script setup lang=\"ts\">\nimport { ref, onMounted, onBeforeUnmount, toRaw } from 'vue';\nimport { ignore, PdfErrorCode, PdfErrorReason, Task } from '@embedpdf/models';\nimport type { StyleValue } from 'vue';\n\nimport type { Tile } from '@embedpdf/plugin-tiling';\nimport { useTilingCapability } from '../hooks';\n\ninterface Props {\n  pageIndex: number;\n  tile: Tile;\n  scale: number;\n  dpr?: number;\n  style?: StyleValue;\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  dpr: () => window.devicePixelRatio,\n});\n\nconst { provides: tilingCapability } = useTilingCapability();\n\nconst url = ref<string>();\nlet blobUrl: string | null = null;\nlet renderTask: Task<Blob, PdfErrorReason> | null = null;\n\n/* -------------------------------------------------- */\n/* Helper functions                                   */\n/* -------------------------------------------------- */\nfunction revoke() {\n  if (blobUrl) {\n    URL.revokeObjectURL(blobUrl);\n    blobUrl = null;\n  }\n}\n\nfunction abortCurrentTask() {\n  if (renderTask && !blobUrl) {\n    renderTask.abort({\n      code: PdfErrorCode.Cancelled,\n      message: 'canceled tile render',\n    });\n  }\n}\n\n/* -------------------------------------------------- */\n/* start one render task when component mounts        */\n/* -------------------------------------------------- */\nonMounted(() => {\n  if (!tilingCapability.value) return;\n\n  const task = tilingCapability.value.renderTile({\n    pageIndex: props.pageIndex,\n    tile: toRaw(props.tile),\n    dpr: props.dpr,\n  });\n\n  renderTask = task;\n  task.wait((blob) => {\n    blobUrl = URL.createObjectURL(blob);\n    url.value = blobUrl;\n    renderTask = null; // Task completed\n  }, ignore);\n});\n\n/* -------------------------------------------------- */\n/* cleanup                                            */\n/* -------------------------------------------------- */\nonBeforeUnmount(() => {\n  abortCurrentTask();\n  revoke();\n});\n\n/* -------------------------------------------------- */\n/* helpers                                            */\n/* -------------------------------------------------- */\nconst relScale = props.scale / props.tile.srcScale;\n</script>\n\n<template>\n  <img\n    v-if=\"url\"\n    :src=\"url\"\n    :style=\"[\n      {\n        position: 'absolute',\n        left: tile.screenRect.origin.x * relScale + 'px',\n        top: tile.screenRect.origin.y * relScale + 'px',\n        width: tile.screenRect.size.width * relScale + 'px',\n        height: tile.screenRect.size.height * relScale + 'px',\n        display: 'block',\n      },\n      props.style,\n    ]\"\n    @load=\"revoke\"\n  />\n</template>\n","<script setup lang=\"ts\">\nimport type { Tile } from '@embedpdf/plugin-tiling';\nimport { ref, onMounted, onBeforeUnmount } from 'vue';\nimport type { StyleValue } from 'vue';\n\nimport { useTilingCapability } from '../hooks';\nimport TileImg from './tile-img.vue';\n\ninterface Props {\n  pageIndex: number;\n  scale: number;\n  style?: StyleValue;\n}\n\nconst props = defineProps<Props>();\n\nconst tiles = ref<Tile[]>([]);\nconst { provides: tilingProvides } = useTilingCapability();\n\nlet unsubscribe: (() => void) | undefined;\n\nonMounted(() => {\n  if (tilingProvides.value) {\n    unsubscribe = tilingProvides.value.onTileRendering((tilesMap) => {\n      tiles.value = tilesMap[props.pageIndex] ?? [];\n    });\n  }\n});\n\nonBeforeUnmount(() => {\n  unsubscribe?.();\n});\n</script>\n\n<template>\n  <div :style=\"style\" v-bind=\"$attrs\">\n    <TileImg\n      v-for=\"tile in tiles\"\n      :key=\"tile.id\"\n      :pageIndex=\"pageIndex\"\n      :tile=\"tile\"\n      :scale=\"scale\"\n    />\n  </div>\n</template>\n"],"names":["useTilingPlugin","usePlugin","TilingPlugin","useTilingCapability","useCapability","props","__props","tilingCapability","url","ref","blobUrl","renderTask","revoke","abortCurrentTask","PdfErrorCode","onMounted","task","toRaw","blob","ignore","onBeforeUnmount","relScale","_createElementBlock","_normalizeStyle","tile","tiles","tilingProvides","unsubscribe","tilesMap","_openBlock","_mergeProps","style","$attrs","_Fragment","_renderList","_createBlock","TileImg","pageIndex","scale"],"mappings":";;;;AAIO,MAAMA,IAAkB,MAAMC,EAAwBC,EAAa,EAAE,GAE/DC,IAAsB,MAAMC,EAA4BF,EAAa,EAAE;;;;;;;;;;ACUpF,UAAMG,IAAQC,GAIR,EAAE,UAAUC,EAAiB,IAAIJ,EAAoB,GAErDK,IAAMC,EAAY;AACxB,QAAIC,IAAyB,MACzBC,IAAgD;AAKpD,aAASC,IAAS;AAChB,MAAIF,MACF,IAAI,gBAAgBA,CAAO,GACjBA,IAAA;AAAA,IACZ;AAGF,aAASG,IAAmB;AACtB,MAAAF,KAAc,CAACD,KACjBC,EAAW,MAAM;AAAA,QACf,MAAMG,EAAa;AAAA,QACnB,SAAS;AAAA,MAAA,CACV;AAAA,IACH;AAMF,IAAAC,EAAU,MAAM;AACV,UAAA,CAACR,EAAiB,MAAO;AAEvB,YAAAS,IAAOT,EAAiB,MAAM,WAAW;AAAA,QAC7C,WAAWF,EAAM;AAAA,QACjB,MAAMY,EAAMZ,EAAM,IAAI;AAAA,QACtB,KAAKA,EAAM;AAAA,MAAA,CACZ;AAEY,MAAAM,IAAAK,GACRA,EAAA,KAAK,CAACE,MAAS;AACR,QAAAR,IAAA,IAAI,gBAAgBQ,CAAI,GAClCV,EAAI,QAAQE,GACCC,IAAA;AAAA,SACZQ,CAAM;AAAA,IAAA,CACV,GAKDC,EAAgB,MAAM;AACH,MAAAP,EAAA,GACVD,EAAA;AAAA,IAAA,CACR;AAKD,UAAMS,IAAWhB,EAAM,QAAQA,EAAM,KAAK;qBAKhCG,EAAG,cADXc,EAeE,OAAA;AAAA;MAbC,KAAKd,EAAG;AAAA,MACR,OAAKe,EAAA;AAAA;;UAAwDC,MAAAA,EAAAA,KAAK,WAAW,OAAO,IAAIH,IAAQ;AAAA,UAAsBG,KAAAA,EAAAA,KAAK,WAAW,OAAO,IAAIH,IAAQ;AAAA,UAAwBG,OAAAA,EAAAA,KAAK,WAAW,KAAK,QAAQH,IAAQ;AAAA,UAAyBG,QAAAA,EAAAA,KAAK,WAAW,KAAK,SAASH,IAAQ;AAAA;;QAAkDhB,EAAM;AAAA,MAAA;MAW7U,QAAMO;AAAA,IAAA;;;;;;;;;;AChFX,UAAMP,IAAQC,GAERmB,IAAQhB,EAAY,EAAE,GACtB,EAAE,UAAUiB,EAAe,IAAIvB,EAAoB;AAErD,QAAAwB;AAEJ,WAAAZ,EAAU,MAAM;AACd,MAAIW,EAAe,UACjBC,IAAcD,EAAe,MAAM,gBAAgB,CAACE,MAAa;AAC/D,QAAAH,EAAM,QAAQG,EAASvB,EAAM,SAAS,KAAK,CAAC;AAAA,MAAA,CAC7C;AAAA,IACH,CACD,GAEDe,EAAgB,MAAM;AACN,MAAAO,KAAA,QAAAA;AAAA,IAAA,CACf,cAICE,EAAA,GAAAP,EAQM,OARNQ,EAQM,EARA,OAAOC,EAAAA,SAAeC,EAAM,MAAA,GAAA;AAAA,cAChCV,EAMEW,GAAA,MAAAC,EALeT,EAAK,OAAA,CAAbD,YADTW,EAMEC,GAAA;AAAA,QAJC,KAAKZ,EAAK;AAAA,QACV,WAAWa,EAAS;AAAA,QACpB,MAAAb;AAAA,QACA,OAAOc,EAAK;AAAA,MAAA;;;;"}