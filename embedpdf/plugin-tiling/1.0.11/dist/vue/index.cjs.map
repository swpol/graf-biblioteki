{"version":3,"file":"index.cjs","sources":["../../src/vue/hooks/use-tiling.ts","../../src/vue/components/tile-img.vue","../../src/vue/components/tiling-layer.vue"],"sourcesContent":["import { useCapability, usePlugin } from '@embedpdf/core/vue';\nimport { TilingPlugin } from '@embedpdf/plugin-tiling';\n\n/** Get the plugin instance itself (e.g. to read config) */\nexport const useTilingPlugin = () => usePlugin<TilingPlugin>(TilingPlugin.id);\n/** Get the *capability* the plugin exposes (renderTile, onTileRendering) */\nexport const useTilingCapability = () => useCapability<TilingPlugin>(TilingPlugin.id);\n","<script setup lang=\"ts\">\nimport { ref, onMounted, onBeforeUnmount, toRaw } from 'vue';\nimport { ignore, PdfErrorCode, PdfErrorReason, Task } from '@embedpdf/models';\nimport type { StyleValue } from 'vue';\n\nimport type { Tile } from '@embedpdf/plugin-tiling';\nimport { useTilingCapability } from '../hooks';\n\ninterface Props {\n  pageIndex: number;\n  tile: Tile;\n  scale: number;\n  dpr?: number;\n  style?: StyleValue;\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  dpr: () => window.devicePixelRatio,\n});\n\nconst { provides: tilingCapability } = useTilingCapability();\n\nconst url = ref<string>();\nlet blobUrl: string | null = null;\nlet renderTask: Task<Blob, PdfErrorReason> | null = null;\n\n/* -------------------------------------------------- */\n/* Helper functions                                   */\n/* -------------------------------------------------- */\nfunction revoke() {\n  if (blobUrl) {\n    URL.revokeObjectURL(blobUrl);\n    blobUrl = null;\n  }\n}\n\nfunction abortCurrentTask() {\n  if (renderTask && !blobUrl) {\n    renderTask.abort({\n      code: PdfErrorCode.Cancelled,\n      message: 'canceled tile render',\n    });\n  }\n}\n\n/* -------------------------------------------------- */\n/* start one render task when component mounts        */\n/* -------------------------------------------------- */\nonMounted(() => {\n  if (!tilingCapability.value) return;\n\n  const task = tilingCapability.value.renderTile({\n    pageIndex: props.pageIndex,\n    tile: toRaw(props.tile),\n    dpr: props.dpr,\n  });\n\n  renderTask = task;\n  task.wait((blob) => {\n    blobUrl = URL.createObjectURL(blob);\n    url.value = blobUrl;\n    renderTask = null; // Task completed\n  }, ignore);\n});\n\n/* -------------------------------------------------- */\n/* cleanup                                            */\n/* -------------------------------------------------- */\nonBeforeUnmount(() => {\n  abortCurrentTask();\n  revoke();\n});\n\n/* -------------------------------------------------- */\n/* helpers                                            */\n/* -------------------------------------------------- */\nconst relScale = props.scale / props.tile.srcScale;\n</script>\n\n<template>\n  <img\n    v-if=\"url\"\n    :src=\"url\"\n    :style=\"[\n      {\n        position: 'absolute',\n        left: tile.screenRect.origin.x * relScale + 'px',\n        top: tile.screenRect.origin.y * relScale + 'px',\n        width: tile.screenRect.size.width * relScale + 'px',\n        height: tile.screenRect.size.height * relScale + 'px',\n        display: 'block',\n      },\n      props.style,\n    ]\"\n    @load=\"revoke\"\n  />\n</template>\n","<script setup lang=\"ts\">\nimport type { Tile } from '@embedpdf/plugin-tiling';\nimport { ref, onMounted, onBeforeUnmount } from 'vue';\nimport type { StyleValue } from 'vue';\n\nimport { useTilingCapability } from '../hooks';\nimport TileImg from './tile-img.vue';\n\ninterface Props {\n  pageIndex: number;\n  scale: number;\n  style?: StyleValue;\n}\n\nconst props = defineProps<Props>();\n\nconst tiles = ref<Tile[]>([]);\nconst { provides: tilingProvides } = useTilingCapability();\n\nlet unsubscribe: (() => void) | undefined;\n\nonMounted(() => {\n  if (tilingProvides.value) {\n    unsubscribe = tilingProvides.value.onTileRendering((tilesMap) => {\n      tiles.value = tilesMap[props.pageIndex] ?? [];\n    });\n  }\n});\n\nonBeforeUnmount(() => {\n  unsubscribe?.();\n});\n</script>\n\n<template>\n  <div :style=\"style\" v-bind=\"$attrs\">\n    <TileImg\n      v-for=\"tile in tiles\"\n      :key=\"tile.id\"\n      :pageIndex=\"pageIndex\"\n      :tile=\"tile\"\n      :scale=\"scale\"\n    />\n  </div>\n</template>\n"],"names":["useTilingPlugin","usePlugin","TilingPlugin","useTilingCapability","useCapability","props","__props","tilingCapability","url","ref","blobUrl","renderTask","revoke","abortCurrentTask","PdfErrorCode","onMounted","task","toRaw","blob","ignore","onBeforeUnmount","relScale","_createElementBlock","_normalizeStyle","tile","tiles","tilingProvides","unsubscribe","tilesMap","_openBlock","_mergeProps","style","$attrs","_Fragment","_renderList","_createBlock","TileImg","pageIndex","scale"],"mappings":"0MAIaA,EAAkB,IAAMC,YAAwBC,EAAAA,aAAa,EAAE,EAE/DC,EAAsB,IAAMC,gBAA4BF,EAAAA,aAAa,EAAE,4LCUpF,MAAMG,EAAQC,EAIR,CAAE,SAAUC,CAAiB,EAAIJ,EAAoB,EAErDK,EAAMC,EAAAA,IAAY,EACxB,IAAIC,EAAyB,KACzBC,EAAgD,KAKpD,SAASC,GAAS,CACZF,IACF,IAAI,gBAAgBA,CAAO,EACjBA,EAAA,KACZ,CAGF,SAASG,GAAmB,CACtBF,GAAc,CAACD,GACjBC,EAAW,MAAM,CACf,KAAMG,EAAa,aAAA,UACnB,QAAS,sBAAA,CACV,CACH,CAMFC,EAAAA,UAAU,IAAM,CACV,GAAA,CAACR,EAAiB,MAAO,OAEvB,MAAAS,EAAOT,EAAiB,MAAM,WAAW,CAC7C,UAAWF,EAAM,UACjB,KAAMY,EAAAA,MAAMZ,EAAM,IAAI,EACtB,IAAKA,EAAM,GAAA,CACZ,EAEYM,EAAAK,EACRA,EAAA,KAAME,GAAS,CACRR,EAAA,IAAI,gBAAgBQ,CAAI,EAClCV,EAAI,MAAQE,EACCC,EAAA,MACZQ,QAAM,CAAA,CACV,EAKDC,EAAAA,gBAAgB,IAAM,CACHP,EAAA,EACVD,EAAA,CAAA,CACR,EAKD,MAAMS,EAAWhB,EAAM,MAAQA,EAAM,KAAK,sBAKhCG,EAAG,qBADXc,EAAAA,mBAeE,MAAA,OAbC,IAAKd,EAAG,MACR,MAAKe,EAAAA,eAAA,sBAAwDC,KAAAA,EAAAA,KAAK,WAAW,OAAO,EAAIH,EAAQ,KAAsBG,IAAAA,EAAAA,KAAK,WAAW,OAAO,EAAIH,EAAQ,KAAwBG,MAAAA,EAAAA,KAAK,WAAW,KAAK,MAAQH,EAAQ,KAAyBG,OAAAA,EAAAA,KAAK,WAAW,KAAK,OAASH,EAAQ,sBAAkDhB,EAAM,KAAA,GAW7U,OAAMO,CAAA,+KChFX,MAAMP,EAAQC,EAERmB,EAAQhB,EAAY,IAAA,EAAE,EACtB,CAAE,SAAUiB,CAAe,EAAIvB,EAAoB,EAErD,IAAAwB,EAEJZ,OAAAA,EAAAA,UAAU,IAAM,CACVW,EAAe,QACjBC,EAAcD,EAAe,MAAM,gBAAiBE,GAAa,CAC/DH,EAAM,MAAQG,EAASvB,EAAM,SAAS,GAAK,CAAC,CAAA,CAC7C,EACH,CACD,EAEDe,EAAAA,gBAAgB,IAAM,CACNO,GAAA,MAAAA,GAAA,CACf,UAICE,YAAA,EAAAP,qBAQM,MARNQ,EAAAA,WAQM,CARA,MAAOC,EAAAA,OAAeC,EAAM,MAAA,EAAA,kBAChCV,EAAAA,mBAMEW,EAAA,SAAA,KAAAC,EAAAA,WALeT,EAAK,MAAbD,kBADTW,EAAA,YAMEC,EAAA,CAJC,IAAKZ,EAAK,GACV,UAAWa,EAAS,UACpB,KAAAb,EACA,MAAOc,EAAK,KAAA"}