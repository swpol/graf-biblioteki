"use strict";const v="LOAD_DOCUMENT",F="SET_DOCUMENT",D=()=>({type:v}),R=r=>({type:F,payload:r});var $="­",E="​",C="⁠",O="\uFEFF",L="￾",I="￿",P=Object.freeze([$,E,C,O,L,I]);new RegExp(`[${P.join("")}]`,"g");var p=Object.freeze([{id:0,label:"Normal",css:"normal"},{id:1,label:"Multiply",css:"multiply"},{id:2,label:"Screen",css:"screen"},{id:3,label:"Overlay",css:"overlay"},{id:4,label:"Darken",css:"darken"},{id:5,label:"Lighten",css:"lighten"},{id:6,label:"Color Dodge",css:"color-dodge"},{id:7,label:"Color Burn",css:"color-burn"},{id:8,label:"Hard Light",css:"hard-light"},{id:9,label:"Soft Light",css:"soft-light"},{id:10,label:"Difference",css:"difference"},{id:11,label:"Exclusion",css:"exclusion"},{id:12,label:"Hue",css:"hue"},{id:13,label:"Saturation",css:"saturation"},{id:14,label:"Color",css:"color"},{id:15,label:"Luminosity",css:"luminosity"}]);p.reduce((r,e)=>(r[e.id]=e,r),{});p.reduce((r,e)=>(r[e.css]=e.id,r),{});p.map(r=>({value:r.id,label:r.label}));var A=Object.freeze({1:"invisible",2:"hidden",4:"print",8:"noZoom",16:"noRotate",32:"noView",64:"readOnly",128:"locked",256:"toggleNoView"});Object.entries(A).reduce((r,[e,t])=>(r[t]=Number(e),r),{});function g(r,e,t){if(r===e)return!0;if(r==null||e==null)return r===e;const s=typeof r;if(s!==typeof e)return!1;if(s==="object"){t||(t=new Set);const o=T(r,e);if(t.has(o))return!0;t.add(o);const n=Array.isArray(r),l=Array.isArray(e);return n&&l?k(r,e,t):!n&&!l?U(r,e,t):!1}return!1}function T(r,e){return`${S(r)}__${S(e)}`}let H=0;const b=new WeakMap;function S(r){return b.has(r)||b.set(r,++H),b.get(r)}function k(r,e,t){if(r.length!==e.length)return!1;const s=new Array(e.length).fill(!1);e:for(let o=0;o<r.length;o++){const n=r[o];for(let l=0;l<e.length;l++)if(!s[l]&&g(n,e[l],t)){s[l]=!0;continue e}return!1}return!0}function U(r,e,t){const s=Object.keys(r).sort(),o=Object.keys(e).sort();if(s.length!==o.length)return!1;for(let n=0;n<s.length;n++)if(s[n]!==o[n])return!1;for(const n of s){const l=r[n],i=e[n];if(!g(l,i,t))return!1}return!0}class j{constructor(e,t){if(this.id=e,this.registry=t,this.debouncedActions={},this.unsubscribeFromState=null,this.unsubscribeFromCoreStore=null,e!==this.constructor.id)throw new Error(`Plugin ID mismatch: ${e} !== ${this.constructor.id}`);this.coreStore=this.registry.getStore(),this.pluginStore=this.coreStore.getPluginStore(this.id),this.unsubscribeFromState=this.pluginStore.subscribeToState((s,o,n)=>{this.onStoreUpdated(n,o)}),this.unsubscribeFromCoreStore=this.coreStore.subscribe((s,o,n)=>{this.onCoreStoreUpdated(n,o)}),this.readyPromise=new Promise(s=>{this.readyResolve=s}),this.readyResolve()}provides(){if(!this._capability){const e=this.buildCapability();this._capability=Object.freeze(e)}return this._capability}get state(){return this.pluginStore.getState()}get coreState(){return this.coreStore.getState()}getState(){return this.pluginStore.getState()}getCoreState(){return this.coreStore.getState()}dispatchCoreAction(e){return this.coreStore.dispatchToCore(e)}dispatchToAllPlugins(e){return this.coreStore.dispatch(e)}dispatch(e){return this.pluginStore.dispatch(e)}debouncedDispatch(e,t=100){const s=Date.now(),o=this.debouncedActions[e.type]||0;return s-o>=t?(this.debouncedActions[e.type]=s,this.dispatch(e),!0):!1}subscribe(e){return this.pluginStore.subscribeToState(e)}subscribeToCoreStore(e){return this.coreStore.subscribe(e)}onStoreUpdated(e,t){}onCoreStoreUpdated(e,t){}destroy(){this.unsubscribeFromState&&(this.unsubscribeFromState(),this.unsubscribeFromState=null),this.unsubscribeFromCoreStore&&(this.unsubscribeFromCoreStore(),this.unsubscribeFromCoreStore=null)}ready(){return this.readyPromise}markReady(){this.readyResolve()}resetReady(){this.readyPromise=new Promise(e=>{this.readyResolve=e})}}class M{constructor(e,t){this.handler=e,this.options=t,this.lastRun=0,this.handle=s=>{this.options.mode==="debounce"?this.debounce(s):this.throttle(s)}}debounce(e){this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.handler(e),this.timeoutId=void 0},this.options.wait)}throttle(e){if(this.options.mode==="debounce")return;const t=Date.now(),s=this.options.throttleMode||"leading-trailing";t-this.lastRun>=this.options.wait&&(s==="leading-trailing"&&this.handler(e),this.lastRun=t),this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.handler(e),this.lastRun=Date.now(),this.timeoutId=void 0},this.options.wait-(t-this.lastRun))}destroy(){this.timeoutId&&window.clearTimeout(this.timeoutId)}}function z(){const r=new Set;return{emit:(e=void 0)=>r.forEach(t=>t(e)),on:e=>(r.add(e),()=>r.delete(e)),off:e=>r.delete(e),clear:()=>r.clear()}}function w(r,e=g){const t=new Set,s=new Map;let o=r;const n=i=>t.forEach(a=>a(i)),l=(i,a)=>{let d=i,c=()=>{};if(a){const u=new M(i,a);d=u.handle,c=()=>u.destroy(),s.set(i,{wrapped:d,destroy:c})}return o!==void 0&&d(o),t.add(d),()=>{t.delete(d),c(),s.delete(i)}};return{get value(){return o},emit(i=void 0){(o===void 0||!e(o,i))&&(o=i,n(i))},on:l,off(i){const a=s.get(i);a?(t.delete(a.wrapped),a.destroy(),s.delete(i)):t.delete(i)},clear(){t.clear(),s.forEach(i=>i.destroy()),s.clear()},select(i,a=g){return(d,c)=>{let u;if(o!==void 0){const h=i(o);u=h,d(h)}return l(h=>{const f=i(h);(u===void 0||!a(u,f))&&(u=f,d(f))},c)}}}}class N{async load(e){const{pdfFile:t,options:s,engine:o}=e,n=o.openDocumentUrl(t,s);return new Promise((l,i)=>{n.wait(a=>l(a),a=>{a.type==="abort"?i(new Error(`PDF loading aborted: ${a.reason}`)):i(new Error(`PDF loading failed: ${a.reason}`))})})}}class _{async load(e){const{pdfFile:t,options:s,engine:o}=e,n=o.openDocumentFromBuffer(t,(s==null?void 0:s.password)||"");return new Promise((l,i)=>{n.wait(a=>l(a),a=>{a.type==="abort"?i(new Error(`PDF loading aborted: ${a.reason}`)):i(new Error(`PDF loading failed: ${a.reason}`))})})}}class q{constructor(){this.strategies=new Map,this.strategyResolvers=[];const e=new _;this.registerStrategy("url",new N),this.registerStrategy("buffer",e),this.addStrategyResolver(t=>x(t)?this.strategies.get("url"):this.strategies.get("buffer"))}registerStrategy(e,t){this.strategies.set(e,t)}getStrategy(e){return this.strategies.get(e)}addStrategyResolver(e){this.strategyResolvers.push(e)}async loadDocument(e){try{const t=this.resolveStrategy(e);if(!t)throw new Error("No suitable strategy found for the given options");return await t.load(e)}catch(t){throw console.error("Error loading document:",t),t}}resolveStrategy(e){for(const t of this.strategyResolvers){const s=t(e);if(s)return s}}}function x(r){return r.type==="url"}const m=class m extends j{constructor(e,t,s){super(e,t),this.id=e,this.engine=s,this.loaderHandlers$=w(),this.documentLoadedHandlers$=w(),this.openFileRequest$=z(),this.documentLoader=new q}buildCapability(){return{onLoaderEvent:this.loaderHandlers$.on,onDocumentLoaded:this.documentLoadedHandlers$.on,onOpenFileRequest:this.openFileRequest$.on,openFileDialog:()=>this.openFileRequest$.emit("open"),loadDocument:e=>this.loadDocument(e),registerStrategy:(e,t)=>this.documentLoader.registerStrategy(e,t),getDocument:()=>this.loadedDocument,addStrategyResolver:e=>this.documentLoader.addStrategyResolver(e)}}async initialize(e){e.defaultStrategies&&Object.entries(e.defaultStrategies).forEach(([t,s])=>{this.documentLoader.registerStrategy(t,s)}),e.loadingOptions&&(this.loadingOptions=e.loadingOptions)}async postInitialize(){this.loadingOptions&&await this.loadDocument(this.loadingOptions)}async loadDocument(e){try{this.loaderHandlers$.emit({type:"start",documentId:e.pdfFile.id}),this.dispatchCoreAction(D());const t=await this.documentLoader.loadDocument({...e,engine:this.engine});return this.dispatchCoreAction(R(t)),this.loadedDocument=t,this.loaderHandlers$.emit({type:"complete",documentId:e.pdfFile.id}),this.documentLoadedHandlers$.emit(t),t}catch(t){const s={type:"error",documentId:e.pdfFile.id,error:t instanceof Error?t:new Error(String(t))};throw this.loaderHandlers$.emit(s),t}}async destroy(){this.loaderHandlers$.clear(),this.documentLoadedHandlers$.clear(),this.openFileRequest$.clear(),super.destroy()}};m.id="loader";let y=m;exports.LoaderPlugin=y;
//# sourceMappingURL=loader-plugin-knutO_6_.cjs.map
