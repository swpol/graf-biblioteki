{"version":3,"file":"index.js","sources":["../../../core/dist/preact/index.js","../../src/preact/hooks/use-loader.ts","../../src/preact/components/file-picker.tsx"],"sourcesContent":["import { createContext as b } from \"preact\";\nimport { u as w } from \"../jsxRuntime.module-Bzuv3cXw.js\";\nimport { useState as a, useRef as m, useEffect as f, useContext as S } from \"preact/hooks\";\nimport { P as v, a as C } from \"../math-ChSRQF3r.js\";\nconst P = b({\n  registry: null,\n  isInitializing: !0,\n  pluginsReady: !1\n});\nfunction F({ engine: t, onInitialized: r, plugins: e, children: i }) {\n  const [o, s] = a(null), [u, c] = a(!0), [y, d] = a(!1), l = m(r);\n  return f(() => {\n    l.current = r;\n  }, [r]), f(() => {\n    const n = new v(t);\n    return n.registerPluginBatch(e), (async () => {\n      var p;\n      await n.initialize(), !n.isDestroyed() && (await ((p = l.current) == null ? void 0 : p.call(l, n)), !n.isDestroyed() && (n.pluginsReady().then(() => {\n        n.isDestroyed() || d(!0);\n      }), s(n), c(!1)));\n    })().catch(console.error), () => {\n      n.destroy(), s(null), c(!0), d(!1);\n    };\n  }, [t, e]), /* @__PURE__ */ w(P.Provider, { value: { registry: o, isInitializing: u, pluginsReady: y }, children: typeof i == \"function\" ? i({ registry: o, isInitializing: u, pluginsReady: y }) : i });\n}\nfunction g() {\n  const t = S(P);\n  if (t === void 0)\n    throw new Error(\"useCapability must be used within a PDFContext.Provider\");\n  const { registry: r, isInitializing: e } = t;\n  if (e)\n    return t;\n  if (r === null)\n    throw new Error(\"PDF registry failed to initialize properly\");\n  return t;\n}\nfunction h(t) {\n  const { registry: r } = g();\n  if (r === null)\n    return {\n      plugin: null,\n      isLoading: !0,\n      ready: new Promise(() => {\n      })\n    };\n  const e = r.getPlugin(t);\n  if (!e)\n    throw new Error(`Plugin ${t} not found`);\n  return {\n    plugin: e,\n    isLoading: !1,\n    ready: e.ready()\n  };\n}\nfunction L(t) {\n  const { plugin: r, isLoading: e, ready: i } = h(t);\n  if (!r)\n    return {\n      provides: null,\n      isLoading: e,\n      ready: i\n    };\n  if (!r.provides)\n    throw new Error(`Plugin ${t} does not provide a capability`);\n  return {\n    provides: r.provides(),\n    isLoading: e,\n    ready: i\n  };\n}\nfunction V() {\n  const { registry: t } = g(), [r, e] = a(null);\n  return f(() => {\n    if (!t) return;\n    e(t.getStore().getState());\n    const i = t.getStore().subscribe((o, s) => {\n      e(s);\n    });\n    return () => i();\n  }, [t]), r;\n}\nfunction $() {\n  const { registry: t } = g(), [r, e] = a(null);\n  return f(() => {\n    if (!t) return;\n    const i = t.getStore();\n    e(i.getState().core);\n    const o = i.subscribe((s, u, c) => {\n      i.isCoreAction(s) && !C(u.core, c.core) && e(u.core);\n    });\n    return () => o();\n  }, [t]), r;\n}\nexport {\n  F as EmbedPDF,\n  P as PDFContext,\n  L as useCapability,\n  $ as useCoreState,\n  h as usePlugin,\n  g as useRegistry,\n  V as useStoreState\n};\n//# sourceMappingURL=index.js.map\n","import { useCapability, usePlugin } from '@embedpdf/core/preact';\nimport { LoaderPlugin } from '@embedpdf/plugin-loader';\n\nexport const useLoaderPlugin = () => usePlugin<LoaderPlugin>(LoaderPlugin.id);\nexport const useLoaderCapability = () => useCapability<LoaderPlugin>(LoaderPlugin.id);\n","/** @jsxImportSource preact */\nimport { useEffect, useRef } from 'preact/hooks';\nimport { useLoaderCapability } from '../hooks';\n\n/** Wrap the viewer root */\nexport function FilePicker() {\n  const { provides: cap } = useLoaderCapability(); // capability\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  /* ─── listen for “open file” requests ─── */\n  useEffect(() => {\n    if (!cap) return;\n    const unsub = cap.onOpenFileRequest((req) => {\n      if (req === 'open' && inputRef.current) inputRef.current.click();\n    });\n    return unsub;\n  }, [cap]);\n\n  /* ─── handle actual file selection ─── */\n  const onChange = async (e: Event) => {\n    const file = (e.currentTarget as HTMLInputElement).files?.[0];\n    if (file && cap)\n      await cap.loadDocument({\n        type: 'buffer',\n        pdfFile: {\n          id: Math.random().toString(36).substring(2, 15),\n          content: await file.arrayBuffer(),\n        },\n      });\n  };\n\n  return (\n    <>\n      {/* Hidden picker */}\n      <input\n        ref={inputRef}\n        type=\"file\"\n        accept=\"application/pdf\"\n        style={{ display: 'none' }}\n        onChange={onChange}\n      />\n    </>\n  );\n}\n"],"names":["P","b","g","t","S","h","L","i","useLoaderPlugin","usePlugin","LoaderPlugin","useLoaderCapability","useCapability","FilePicker","cap","inputRef","useRef","useEffect","req","jsx","Fragment","e","file","_a"],"mappings":";;;;AAIA,MAAMA,IAAIC,EAAE;AAAA,EACV,UAAU;AAAA,EACV,gBAAgB;AAAA,EAChB,cAAc;AAChB,CAAC;AAiBD,SAASC,IAAI;AACX,QAAMC,IAAIC,EAAEJ,CAAC;AACb,MAAIG,MAAM;AACR,UAAM,IAAI,MAAM,yDAAyD;AAC3E,QAAM,EAAE,UAAU,GAAG,gBAAgB,EAAC,IAAKA;AAC3C,MAAI;AACF,WAAOA;AACT,MAAI,MAAM;AACR,UAAM,IAAI,MAAM,4CAA4C;AAC9D,SAAOA;AACT;AACA,SAASE,EAAEF,GAAG;AACZ,QAAM,EAAE,UAAU,EAAC,IAAKD,EAAC;AACzB,MAAI,MAAM;AACR,WAAO;AAAA,MACL,QAAQ;AAAA,MACR,WAAW;AAAA,MACX,OAAO,IAAI,QAAQ,MAAM;AAAA,MACzB,CAAC;AAAA,IACP;AACE,QAAM,IAAI,EAAE,UAAUC,CAAC;AACvB,MAAI,CAAC;AACH,UAAM,IAAI,MAAM,UAAUA,CAAC,YAAY;AACzC,SAAO;AAAA,IACL,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,OAAO,EAAE,MAAK;AAAA,EAClB;AACA;AACA,SAASG,EAAEH,GAAG;AACZ,QAAM,EAAE,QAAQ,GAAG,WAAW,GAAG,OAAOI,EAAC,IAAKF,EAAEF,CAAC;AACjD,MAAI,CAAC;AACH,WAAO;AAAA,MACL,UAAU;AAAA,MACV,WAAW;AAAA,MACX,OAAOI;AAAA,IACb;AACE,MAAI,CAAC,EAAE;AACL,UAAM,IAAI,MAAM,UAAUJ,CAAC,gCAAgC;AAC7D,SAAO;AAAA,IACL,UAAU,EAAE,SAAQ;AAAA,IACpB,WAAW;AAAA,IACX,OAAOI;AAAA,EACX;AACA;AClEO,MAAMC,IAAkB,MAAMC,EAAwBC,EAAa,EAAE,GAC/DC,IAAsB,MAAMC,EAA4BF,EAAa,EAAE;ACC7E,SAASG,IAAa;AAC3B,QAAM,EAAE,UAAUC,EAAA,IAAQH,EAAA,GACpBI,IAAWC,EAAyB,IAAI;AAG9C,SAAAC,EAAU,MACHH,IACSA,EAAI,kBAAkB,CAACI,MAAQ;AAC3C,IAAIA,MAAQ,UAAUH,EAAS,WAASA,EAAS,QAAQ,MAAA;AAAA,EAC3D,CAAC,IAHS,QAKT,CAACD,CAAG,CAAC,GAgBNK,kBAAAC,GAAA,EAEE,UAAAD;AAAAA,IAAC;AAAA,IAAA;AAAA,MACC,KAAKJ;AAAA,MACL,MAAK;AAAA,MACL,QAAO;AAAA,MACP,OAAO,EAAE,SAAS,OAAA;AAAA,MAClB,UApBW,OAAOM,MAAa;;AACnC,cAAMC,KAAQC,IAAAF,EAAE,cAAmC,UAArC,gBAAAE,EAA6C;AAC3D,QAAID,KAAQR,KACV,MAAMA,EAAI,aAAa;AAAA,UACrB,MAAM;AAAA,UACN,SAAS;AAAA,YACP,IAAI,KAAK,SAAS,SAAS,EAAE,EAAE,UAAU,GAAG,EAAE;AAAA,YAC9C,SAAS,MAAMQ,EAAK,YAAA;AAAA,UAAY;AAAA,QAClC,CACD;AAAA,MACL;AAAA,IAUM;AAAA,EAAA,GAEJ;AAEJ;"}