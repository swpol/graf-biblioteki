"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const r=require("./math-BJ_3g2sS.cjs"),g=s=>s.pages.map(t=>t.map(e=>({...e,rotatedSize:r.transformSize(e.size,s.rotation,1)})));function E(s,t){return{package:s,config:t}}class b{constructor(t,e){if(this.id=t,this.registry=e,this.debouncedActions={},this.unsubscribeFromState=null,this.unsubscribeFromCoreStore=null,t!==this.constructor.id)throw new Error(`Plugin ID mismatch: ${t} !== ${this.constructor.id}`);this.coreStore=this.registry.getStore(),this.pluginStore=this.coreStore.getPluginStore(this.id),this.unsubscribeFromState=this.pluginStore.subscribeToState((i,n,l)=>{this.onStoreUpdated(l,n)}),this.unsubscribeFromCoreStore=this.coreStore.subscribe((i,n,l)=>{this.onCoreStoreUpdated(l,n)}),this.readyPromise=new Promise(i=>{this.readyResolve=i}),this.readyResolve()}provides(){if(!this._capability){const t=this.buildCapability();this._capability=Object.freeze(t)}return this._capability}get state(){return this.pluginStore.getState()}get coreState(){return this.coreStore.getState()}getState(){return this.pluginStore.getState()}getCoreState(){return this.coreStore.getState()}dispatchCoreAction(t){return this.coreStore.dispatchToCore(t)}dispatchToAllPlugins(t){return this.coreStore.dispatch(t)}dispatch(t){return this.pluginStore.dispatch(t)}debouncedDispatch(t,e=100){const i=Date.now(),n=this.debouncedActions[t.type]||0;return i-n>=e?(this.debouncedActions[t.type]=i,this.dispatch(t),!0):!1}subscribe(t){return this.pluginStore.subscribeToState(t)}subscribeToCoreStore(t){return this.coreStore.subscribe(t)}onStoreUpdated(t,e){}onCoreStoreUpdated(t,e){}destroy(){this.unsubscribeFromState&&(this.unsubscribeFromState(),this.unsubscribeFromState=null),this.unsubscribeFromCoreStore&&(this.unsubscribeFromCoreStore(),this.unsubscribeFromCoreStore=null)}ready(){return this.readyPromise}markReady(){this.readyResolve()}resetReady(){this.readyPromise=new Promise(t=>{this.readyResolve=t})}}class m{constructor(t,e){this.handler=t,this.options=e,this.lastRun=0,this.handle=i=>{this.options.mode==="debounce"?this.debounce(i):this.throttle(i)}}debounce(t){this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.handler(t),this.timeoutId=void 0},this.options.wait)}throttle(t){if(this.options.mode==="debounce")return;const e=Date.now(),i=this.options.throttleMode||"leading-trailing";e-this.lastRun>=this.options.wait&&(i==="leading-trailing"&&this.handler(t),this.lastRun=e),this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.handler(t),this.lastRun=Date.now(),this.timeoutId=void 0},this.options.wait-(e-this.lastRun))}destroy(){this.timeoutId&&window.clearTimeout(this.timeoutId)}}function y(){const s=new Set;return{emit:(e=void 0)=>s.forEach(i=>i(e)),on:e=>(s.add(e),()=>s.delete(e)),off:e=>s.delete(e),clear:()=>s.clear()}}function f(s,t=r.arePropsEqual){const e=new Set,i=new Map;let n=s;const l=o=>e.forEach(a=>a(o)),p=(o,a)=>{let u=o,d=()=>{};if(a){const c=new m(o,a);u=c.handle,d=()=>c.destroy(),i.set(o,{wrapped:u,destroy:d})}return n!==void 0&&u(n),e.add(u),()=>{e.delete(u),d(),i.delete(o)}};return{get value(){return n},emit(o=void 0){(n===void 0||!t(n,o))&&(n=o,l(o))},on:p,off(o){const a=i.get(o);a?(e.delete(a.wrapped),a.destroy(),i.delete(o)):e.delete(o)},clear(){e.clear(),i.forEach(o=>o.destroy()),i.clear()},select(o,a=r.arePropsEqual){return(u,d)=>{let c;if(n!==void 0){const h=o(n);c=h,u(h)}return p(h=>{const S=o(h);(c===void 0||!a(c,S))&&(c=S,u(S))},d)}}}}function C(s){return Object.entries(s).map(([t,e])=>{const i=Number(t);return[Number.isFinite(i)&&t.trim()!==""?i:t,e]})}exports.CORE_ACTION_TYPES=r.CORE_ACTION_TYPES;exports.CapabilityConflictError=r.CapabilityConflictError;exports.CapabilityNotFoundError=r.CapabilityNotFoundError;exports.CircularDependencyError=r.CircularDependencyError;exports.DependencyResolver=r.DependencyResolver;exports.LOAD_DOCUMENT=r.LOAD_DOCUMENT;exports.PluginConfigurationError=r.PluginConfigurationError;exports.PluginInitializationError=r.PluginInitializationError;exports.PluginNotFoundError=r.PluginNotFoundError;exports.PluginRegistrationError=r.PluginRegistrationError;exports.PluginRegistry=r.PluginRegistry;exports.SET_DOCUMENT=r.SET_DOCUMENT;exports.SET_DOCUMENT_ERROR=r.SET_DOCUMENT_ERROR;exports.SET_PAGES=r.SET_PAGES;exports.SET_ROTATION=r.SET_ROTATION;exports.SET_SCALE=r.SET_SCALE;exports.arePropsEqual=r.arePropsEqual;exports.clamp=r.clamp;exports.initialCoreState=r.initialCoreState;exports.loadDocument=r.loadDocument;exports.setDocument=r.setDocument;exports.setDocumentError=r.setDocumentError;exports.setPages=r.setPages;exports.setRotation=r.setRotation;exports.setScale=r.setScale;exports.BasePlugin=b;exports.EventControl=m;exports.createBehaviorEmitter=f;exports.createEmitter=y;exports.createPluginRegistration=E;exports.enumEntries=C;exports.getPagesWithRotatedSize=g;
//# sourceMappingURL=index.cjs.map
