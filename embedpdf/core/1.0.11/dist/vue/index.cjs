"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("vue"),c=require("@embedpdf/core"),g=Symbol("pdfKey");function a(){const o=t.inject(g);if(!o)throw new Error("useRegistry must be used inside <EmbedPDF>");return o}function f(){const{registry:o}=a(),e=t.ref();return t.onMounted(()=>{const i=o.value.getStore();e.value=i.getState().core;const n=i.subscribe((s,r,u)=>{i.isCoreAction(s)&&!c.arePropsEqual(r.core,u.core)&&(e.value=r.core)});t.onBeforeUnmount(n)}),e}function d(o){const{registry:e}=a(),i=t.shallowRef(null),n=t.ref(!0),s=t.ref(new Promise(()=>{})),r=()=>{var l;if(!e.value)return;const u=e.value.getPlugin(o);if(!u)throw new Error(`Plugin ${o} not found`);i.value=u,n.value=!1,s.value=((l=u.ready)==null?void 0:l.call(u))??Promise.resolve()};return t.onMounted(r),t.watch(e,r),{plugin:i,isLoading:n,ready:s}}function v(o){const{plugin:e,isLoading:i,ready:n}=d(o);return{provides:t.computed(()=>{if(!e.value)return null;if(!e.value.provides)throw new Error(`Plugin ${o} does not implement provides()`);return e.value.provides()}),isLoading:i,ready:n}}function y(){const{registry:o}=a(),e=t.ref();function i(){return o.value?(e.value=o.value.getStore().getState(),o.value.getStore().subscribe((s,r)=>e.value=r)):()=>{}}let n=i();return t.watch(o,()=>{n==null||n(),n=i()}),t.onBeforeUnmount(()=>n==null?void 0:n()),e}const p=t.defineComponent({__name:"embed-pdf",props:{engine:{},plugins:{},onInitialized:{type:Function}},setup(o){const e=o,i=t.shallowRef(null),n=t.ref(!0),s=t.ref(!1);return t.provide(g,{registry:i,isInitializing:n,pluginsReady:s}),t.onMounted(async()=>{var u;const r=new c.PluginRegistry(e.engine);r.registerPluginBatch(e.plugins),await r.initialize(),await((u=e.onInitialized)==null?void 0:u.call(e,r)),i.value=r,n.value=!1,r.pluginsReady().then(()=>s.value=!0)}),t.onBeforeUnmount(()=>{var r;return(r=i.value)==null?void 0:r.destroy()}),(r,u)=>t.renderSlot(r.$slots,"default",{registry:i.value,isInitializing:n.value,pluginsReady:s.value})}});exports.EmbedPDF=p;exports.useCapability=v;exports.useCoreState=f;exports.usePlugin=d;exports.useRegistry=a;exports.useStoreState=y;
//# sourceMappingURL=index.cjs.map
