"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const b=require("preact"),w=require("../jsxRuntime.module-B3sGoTIU.cjs"),s=require("preact/hooks"),p=require("../math-BJ_3g2sS.cjs"),g=b.createContext({registry:null,isInitializing:!0,pluginsReady:!1});function C({engine:e,onInitialized:r,plugins:t,children:i}){const[o,u]=s.useState(null),[a,c]=s.useState(!0),[y,d]=s.useState(!1),l=s.useRef(r);return s.useEffect(()=>{l.current=r},[r]),s.useEffect(()=>{const n=new p.PluginRegistry(e);return n.registerPluginBatch(t),(async()=>{var S;await n.initialize(),!n.isDestroyed()&&(await((S=l.current)==null?void 0:S.call(l,n)),!n.isDestroyed()&&(n.pluginsReady().then(()=>{n.isDestroyed()||d(!0)}),u(n),c(!1)))})().catch(console.error),()=>{n.destroy(),u(null),c(!0),d(!1)}},[e,t]),w.u(g.Provider,{value:{registry:o,isInitializing:a,pluginsReady:y},children:typeof i=="function"?i({registry:o,isInitializing:a,pluginsReady:y}):i})}function f(){const e=s.useContext(g);if(e===void 0)throw new Error("useCapability must be used within a PDFContext.Provider");const{registry:r,isInitializing:t}=e;if(t)return e;if(r===null)throw new Error("PDF registry failed to initialize properly");return e}function P(e){const{registry:r}=f();if(r===null)return{plugin:null,isLoading:!0,ready:new Promise(()=>{})};const t=r.getPlugin(e);if(!t)throw new Error(`Plugin ${e} not found`);return{plugin:t,isLoading:!1,ready:t.ready()}}function E(e){const{plugin:r,isLoading:t,ready:i}=P(e);if(!r)return{provides:null,isLoading:t,ready:i};if(!r.provides)throw new Error(`Plugin ${e} does not provide a capability`);return{provides:r.provides(),isLoading:t,ready:i}}function v(){const{registry:e}=f(),[r,t]=s.useState(null);return s.useEffect(()=>{if(!e)return;t(e.getStore().getState());const i=e.getStore().subscribe((o,u)=>{t(u)});return()=>i()},[e]),r}function h(){const{registry:e}=f(),[r,t]=s.useState(null);return s.useEffect(()=>{if(!e)return;const i=e.getStore();t(i.getState().core);const o=i.subscribe((u,a,c)=>{i.isCoreAction(u)&&!p.arePropsEqual(a.core,c.core)&&t(a.core)});return()=>o()},[e]),r}exports.EmbedPDF=C;exports.PDFContext=g;exports.useCapability=E;exports.useCoreState=h;exports.usePlugin=P;exports.useRegistry=f;exports.useStoreState=v;
//# sourceMappingURL=index.cjs.map
