{"version":3,"file":"index.js","sources":["../../../core/dist/preact/index.js","../../src/preact/hooks/use-interaction-manager.ts","../../src/preact/components/global-pointer-provider.tsx","../../src/preact/components/page-pointer-provider.tsx"],"sourcesContent":["import { createContext as b } from \"preact\";\nimport { u as w } from \"../jsxRuntime.module-Bzuv3cXw.js\";\nimport { useState as a, useRef as m, useEffect as f, useContext as S } from \"preact/hooks\";\nimport { P as v, a as C } from \"../math-ChSRQF3r.js\";\nconst P = b({\n  registry: null,\n  isInitializing: !0,\n  pluginsReady: !1\n});\nfunction F({ engine: t, onInitialized: r, plugins: e, children: i }) {\n  const [o, s] = a(null), [u, c] = a(!0), [y, d] = a(!1), l = m(r);\n  return f(() => {\n    l.current = r;\n  }, [r]), f(() => {\n    const n = new v(t);\n    return n.registerPluginBatch(e), (async () => {\n      var p;\n      await n.initialize(), !n.isDestroyed() && (await ((p = l.current) == null ? void 0 : p.call(l, n)), !n.isDestroyed() && (n.pluginsReady().then(() => {\n        n.isDestroyed() || d(!0);\n      }), s(n), c(!1)));\n    })().catch(console.error), () => {\n      n.destroy(), s(null), c(!0), d(!1);\n    };\n  }, [t, e]), /* @__PURE__ */ w(P.Provider, { value: { registry: o, isInitializing: u, pluginsReady: y }, children: typeof i == \"function\" ? i({ registry: o, isInitializing: u, pluginsReady: y }) : i });\n}\nfunction g() {\n  const t = S(P);\n  if (t === void 0)\n    throw new Error(\"useCapability must be used within a PDFContext.Provider\");\n  const { registry: r, isInitializing: e } = t;\n  if (e)\n    return t;\n  if (r === null)\n    throw new Error(\"PDF registry failed to initialize properly\");\n  return t;\n}\nfunction h(t) {\n  const { registry: r } = g();\n  if (r === null)\n    return {\n      plugin: null,\n      isLoading: !0,\n      ready: new Promise(() => {\n      })\n    };\n  const e = r.getPlugin(t);\n  if (!e)\n    throw new Error(`Plugin ${t} not found`);\n  return {\n    plugin: e,\n    isLoading: !1,\n    ready: e.ready()\n  };\n}\nfunction L(t) {\n  const { plugin: r, isLoading: e, ready: i } = h(t);\n  if (!r)\n    return {\n      provides: null,\n      isLoading: e,\n      ready: i\n    };\n  if (!r.provides)\n    throw new Error(`Plugin ${t} does not provide a capability`);\n  return {\n    provides: r.provides(),\n    isLoading: e,\n    ready: i\n  };\n}\nfunction V() {\n  const { registry: t } = g(), [r, e] = a(null);\n  return f(() => {\n    if (!t) return;\n    e(t.getStore().getState());\n    const i = t.getStore().subscribe((o, s) => {\n      e(s);\n    });\n    return () => i();\n  }, [t]), r;\n}\nfunction $() {\n  const { registry: t } = g(), [r, e] = a(null);\n  return f(() => {\n    if (!t) return;\n    const i = t.getStore();\n    e(i.getState().core);\n    const o = i.subscribe((s, u, c) => {\n      i.isCoreAction(s) && !C(u.core, c.core) && e(u.core);\n    });\n    return () => o();\n  }, [t]), r;\n}\nexport {\n  F as EmbedPDF,\n  P as PDFContext,\n  L as useCapability,\n  $ as useCoreState,\n  h as usePlugin,\n  g as useRegistry,\n  V as useStoreState\n};\n//# sourceMappingURL=index.js.map\n","import { useCapability, usePlugin } from '@embedpdf/core/preact';\nimport {\n  initialState,\n  InteractionManagerPlugin,\n  InteractionManagerState,\n  PointerEventHandlers,\n  PointerEventHandlersWithLifecycle,\n} from '@embedpdf/plugin-interaction-manager';\nimport { useState, useEffect } from 'preact/hooks';\n\nexport const useInteractionManagerPlugin = () =>\n  usePlugin<InteractionManagerPlugin>(InteractionManagerPlugin.id);\nexport const useInteractionManagerCapability = () =>\n  useCapability<InteractionManagerPlugin>(InteractionManagerPlugin.id);\n\nexport function useInteractionManager() {\n  const { provides } = useInteractionManagerCapability();\n  const [state, setState] = useState<InteractionManagerState>(initialState);\n\n  useEffect(() => {\n    if (!provides) return;\n    return provides.onStateChange((state) => {\n      setState(state);\n    });\n  }, [provides]);\n\n  return {\n    provides,\n    state,\n  };\n}\n\nexport function useCursor() {\n  const { provides } = useInteractionManagerCapability();\n  return {\n    setCursor: (token: string, cursor: string, prio = 0) => {\n      provides?.setCursor(token, cursor, prio);\n    },\n    removeCursor: (token: string) => {\n      provides?.removeCursor(token);\n    },\n  };\n}\n\ninterface UsePointerHandlersOptions {\n  modeId?: string | string[];\n  pageIndex?: number;\n}\n\nexport function usePointerHandlers({ modeId, pageIndex }: UsePointerHandlersOptions) {\n  const { provides } = useInteractionManagerCapability();\n  return {\n    register: (\n      handlers: PointerEventHandlersWithLifecycle,\n      options?: { modeId?: string | string[]; pageIndex?: number },\n    ) => {\n      // Use provided options or fall back to hook-level options\n      const finalModeId = options?.modeId ?? modeId;\n      const finalPageIndex = options?.pageIndex ?? pageIndex;\n\n      return finalModeId\n        ? provides?.registerHandlers({\n            modeId: finalModeId,\n            handlers,\n            pageIndex: finalPageIndex,\n          })\n        : provides?.registerAlways({\n            scope:\n              finalPageIndex !== undefined\n                ? { type: 'page', pageIndex: finalPageIndex }\n                : { type: 'global' },\n            handlers,\n          });\n    },\n  };\n}\n\nexport function useIsPageExclusive() {\n  const { provides: cap } = useInteractionManagerCapability();\n\n  const [isPageExclusive, setIsPageExclusive] = useState<boolean>(() => {\n    const m = cap?.getActiveInteractionMode();\n    return m?.scope === 'page' && !!m.exclusive;\n  });\n\n  useEffect(() => {\n    if (!cap) return;\n\n    return cap.onModeChange(() => {\n      const mode = cap.getActiveInteractionMode();\n      setIsPageExclusive(mode?.scope === 'page' && !!mode?.exclusive);\n    });\n  }, [cap]);\n\n  return isPageExclusive;\n}\n","/** @jsxImportSource preact */\nimport { ComponentChildren, JSX } from 'preact';\nimport { useEffect, useRef } from 'preact/hooks';\nimport { createPointerProvider } from '../../shared/utils';\n\nimport { useInteractionManagerCapability } from '../hooks';\n\ninterface GlobalPointerProviderProps extends JSX.HTMLAttributes<HTMLDivElement> {\n  children: ComponentChildren;\n  style?: JSX.CSSProperties;\n}\n\nexport const GlobalPointerProvider = ({\n  children,\n  style,\n  ...props\n}: GlobalPointerProviderProps) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const { provides: cap } = useInteractionManagerCapability();\n\n  useEffect(() => {\n    if (!cap || !ref.current) return;\n\n    return createPointerProvider(cap, { type: 'global' }, ref.current);\n  }, [cap]);\n\n  return (\n    <div\n      ref={ref}\n      style={{\n        width: '100%',\n        height: '100%',\n        ...style,\n      }}\n      {...props}\n    >\n      {children}\n    </div>\n  );\n};\n","/** @jsxImportSource preact */\nimport { ComponentChildren, JSX } from 'preact';\nimport { useCallback, useEffect, useRef } from 'preact/hooks';\nimport { Position, restorePosition } from '@embedpdf/models';\nimport { createPointerProvider } from '../../shared/utils';\n\nimport { useInteractionManagerCapability, useIsPageExclusive } from '../hooks';\n\ninterface PagePointerProviderProps extends JSX.HTMLAttributes<HTMLDivElement> {\n  children: ComponentChildren;\n  pageIndex: number;\n  pageWidth: number;\n  pageHeight: number;\n  rotation: number;\n  scale: number;\n  style?: JSX.CSSProperties;\n  convertEventToPoint?: (event: PointerEvent, element: HTMLElement) => Position;\n}\n\nexport const PagePointerProvider = ({\n  pageIndex,\n  children,\n  pageWidth,\n  pageHeight,\n  rotation,\n  scale,\n  convertEventToPoint,\n  style,\n  ...props\n}: PagePointerProviderProps) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const { provides: cap } = useInteractionManagerCapability();\n  const isPageExclusive = useIsPageExclusive();\n\n  const defaultConvertEventToPoint = useCallback(\n    (event: PointerEvent, element: HTMLElement): Position => {\n      const rect = element.getBoundingClientRect();\n      const displayPoint = {\n        x: event.clientX - rect.left,\n        y: event.clientY - rect.top,\n      };\n      return restorePosition(\n        { width: pageWidth, height: pageHeight },\n        displayPoint,\n        rotation,\n        scale,\n      );\n    },\n    [pageWidth, pageHeight, rotation, scale],\n  );\n\n  useEffect(() => {\n    if (!cap || !ref.current) return;\n\n    return createPointerProvider(\n      cap,\n      { type: 'page', pageIndex },\n      ref.current,\n      convertEventToPoint || defaultConvertEventToPoint,\n    );\n  }, [cap, pageIndex, convertEventToPoint, defaultConvertEventToPoint]);\n\n  return (\n    <div\n      ref={ref}\n      style={{\n        ...style,\n      }}\n      {...props}\n    >\n      {children}\n      {isPageExclusive && (\n        <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, zIndex: 10 }} />\n      )}\n    </div>\n  );\n};\n"],"names":["P","b","g","t","S","r","e","h","L","i","useInteractionManagerPlugin","usePlugin","InteractionManagerPlugin","useInteractionManagerCapability","useCapability","useInteractionManager","provides","state","setState","useState","initialState","useEffect","useCursor","token","cursor","prio","usePointerHandlers","modeId","pageIndex","handlers","options","finalModeId","finalPageIndex","useIsPageExclusive","cap","isPageExclusive","setIsPageExclusive","m","mode","GlobalPointerProvider","children","style","props","ref","useRef","createPointerProvider","jsx","PagePointerProvider","pageWidth","pageHeight","rotation","scale","convertEventToPoint","defaultConvertEventToPoint","useCallback","event","element","rect","displayPoint","restorePosition","jsxs"],"mappings":"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"}