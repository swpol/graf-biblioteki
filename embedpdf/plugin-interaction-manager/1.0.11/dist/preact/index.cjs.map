{"version":3,"file":"index.cjs","sources":["../../../core/dist/preact/index.js","../../src/preact/hooks/use-interaction-manager.ts","../../src/preact/components/global-pointer-provider.tsx","../../src/preact/components/page-pointer-provider.tsx"],"sourcesContent":["import { createContext as b } from \"preact\";\nimport { u as w } from \"../jsxRuntime.module-Bzuv3cXw.js\";\nimport { useState as a, useRef as m, useEffect as f, useContext as S } from \"preact/hooks\";\nimport { P as v, a as C } from \"../math-ChSRQF3r.js\";\nconst P = b({\n  registry: null,\n  isInitializing: !0,\n  pluginsReady: !1\n});\nfunction F({ engine: t, onInitialized: r, plugins: e, children: i }) {\n  const [o, s] = a(null), [u, c] = a(!0), [y, d] = a(!1), l = m(r);\n  return f(() => {\n    l.current = r;\n  }, [r]), f(() => {\n    const n = new v(t);\n    return n.registerPluginBatch(e), (async () => {\n      var p;\n      await n.initialize(), !n.isDestroyed() && (await ((p = l.current) == null ? void 0 : p.call(l, n)), !n.isDestroyed() && (n.pluginsReady().then(() => {\n        n.isDestroyed() || d(!0);\n      }), s(n), c(!1)));\n    })().catch(console.error), () => {\n      n.destroy(), s(null), c(!0), d(!1);\n    };\n  }, [t, e]), /* @__PURE__ */ w(P.Provider, { value: { registry: o, isInitializing: u, pluginsReady: y }, children: typeof i == \"function\" ? i({ registry: o, isInitializing: u, pluginsReady: y }) : i });\n}\nfunction g() {\n  const t = S(P);\n  if (t === void 0)\n    throw new Error(\"useCapability must be used within a PDFContext.Provider\");\n  const { registry: r, isInitializing: e } = t;\n  if (e)\n    return t;\n  if (r === null)\n    throw new Error(\"PDF registry failed to initialize properly\");\n  return t;\n}\nfunction h(t) {\n  const { registry: r } = g();\n  if (r === null)\n    return {\n      plugin: null,\n      isLoading: !0,\n      ready: new Promise(() => {\n      })\n    };\n  const e = r.getPlugin(t);\n  if (!e)\n    throw new Error(`Plugin ${t} not found`);\n  return {\n    plugin: e,\n    isLoading: !1,\n    ready: e.ready()\n  };\n}\nfunction L(t) {\n  const { plugin: r, isLoading: e, ready: i } = h(t);\n  if (!r)\n    return {\n      provides: null,\n      isLoading: e,\n      ready: i\n    };\n  if (!r.provides)\n    throw new Error(`Plugin ${t} does not provide a capability`);\n  return {\n    provides: r.provides(),\n    isLoading: e,\n    ready: i\n  };\n}\nfunction V() {\n  const { registry: t } = g(), [r, e] = a(null);\n  return f(() => {\n    if (!t) return;\n    e(t.getStore().getState());\n    const i = t.getStore().subscribe((o, s) => {\n      e(s);\n    });\n    return () => i();\n  }, [t]), r;\n}\nfunction $() {\n  const { registry: t } = g(), [r, e] = a(null);\n  return f(() => {\n    if (!t) return;\n    const i = t.getStore();\n    e(i.getState().core);\n    const o = i.subscribe((s, u, c) => {\n      i.isCoreAction(s) && !C(u.core, c.core) && e(u.core);\n    });\n    return () => o();\n  }, [t]), r;\n}\nexport {\n  F as EmbedPDF,\n  P as PDFContext,\n  L as useCapability,\n  $ as useCoreState,\n  h as usePlugin,\n  g as useRegistry,\n  V as useStoreState\n};\n//# sourceMappingURL=index.js.map\n","import { useCapability, usePlugin } from '@embedpdf/core/preact';\nimport {\n  initialState,\n  InteractionManagerPlugin,\n  InteractionManagerState,\n  PointerEventHandlers,\n  PointerEventHandlersWithLifecycle,\n} from '@embedpdf/plugin-interaction-manager';\nimport { useState, useEffect } from 'preact/hooks';\n\nexport const useInteractionManagerPlugin = () =>\n  usePlugin<InteractionManagerPlugin>(InteractionManagerPlugin.id);\nexport const useInteractionManagerCapability = () =>\n  useCapability<InteractionManagerPlugin>(InteractionManagerPlugin.id);\n\nexport function useInteractionManager() {\n  const { provides } = useInteractionManagerCapability();\n  const [state, setState] = useState<InteractionManagerState>(initialState);\n\n  useEffect(() => {\n    if (!provides) return;\n    return provides.onStateChange((state) => {\n      setState(state);\n    });\n  }, [provides]);\n\n  return {\n    provides,\n    state,\n  };\n}\n\nexport function useCursor() {\n  const { provides } = useInteractionManagerCapability();\n  return {\n    setCursor: (token: string, cursor: string, prio = 0) => {\n      provides?.setCursor(token, cursor, prio);\n    },\n    removeCursor: (token: string) => {\n      provides?.removeCursor(token);\n    },\n  };\n}\n\ninterface UsePointerHandlersOptions {\n  modeId?: string | string[];\n  pageIndex?: number;\n}\n\nexport function usePointerHandlers({ modeId, pageIndex }: UsePointerHandlersOptions) {\n  const { provides } = useInteractionManagerCapability();\n  return {\n    register: (\n      handlers: PointerEventHandlersWithLifecycle,\n      options?: { modeId?: string | string[]; pageIndex?: number },\n    ) => {\n      // Use provided options or fall back to hook-level options\n      const finalModeId = options?.modeId ?? modeId;\n      const finalPageIndex = options?.pageIndex ?? pageIndex;\n\n      return finalModeId\n        ? provides?.registerHandlers({\n            modeId: finalModeId,\n            handlers,\n            pageIndex: finalPageIndex,\n          })\n        : provides?.registerAlways({\n            scope:\n              finalPageIndex !== undefined\n                ? { type: 'page', pageIndex: finalPageIndex }\n                : { type: 'global' },\n            handlers,\n          });\n    },\n  };\n}\n\nexport function useIsPageExclusive() {\n  const { provides: cap } = useInteractionManagerCapability();\n\n  const [isPageExclusive, setIsPageExclusive] = useState<boolean>(() => {\n    const m = cap?.getActiveInteractionMode();\n    return m?.scope === 'page' && !!m.exclusive;\n  });\n\n  useEffect(() => {\n    if (!cap) return;\n\n    return cap.onModeChange(() => {\n      const mode = cap.getActiveInteractionMode();\n      setIsPageExclusive(mode?.scope === 'page' && !!mode?.exclusive);\n    });\n  }, [cap]);\n\n  return isPageExclusive;\n}\n","/** @jsxImportSource preact */\nimport { ComponentChildren, JSX } from 'preact';\nimport { useEffect, useRef } from 'preact/hooks';\nimport { createPointerProvider } from '../../shared/utils';\n\nimport { useInteractionManagerCapability } from '../hooks';\n\ninterface GlobalPointerProviderProps extends JSX.HTMLAttributes<HTMLDivElement> {\n  children: ComponentChildren;\n  style?: JSX.CSSProperties;\n}\n\nexport const GlobalPointerProvider = ({\n  children,\n  style,\n  ...props\n}: GlobalPointerProviderProps) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const { provides: cap } = useInteractionManagerCapability();\n\n  useEffect(() => {\n    if (!cap || !ref.current) return;\n\n    return createPointerProvider(cap, { type: 'global' }, ref.current);\n  }, [cap]);\n\n  return (\n    <div\n      ref={ref}\n      style={{\n        width: '100%',\n        height: '100%',\n        ...style,\n      }}\n      {...props}\n    >\n      {children}\n    </div>\n  );\n};\n","/** @jsxImportSource preact */\nimport { ComponentChildren, JSX } from 'preact';\nimport { useCallback, useEffect, useRef } from 'preact/hooks';\nimport { Position, restorePosition } from '@embedpdf/models';\nimport { createPointerProvider } from '../../shared/utils';\n\nimport { useInteractionManagerCapability, useIsPageExclusive } from '../hooks';\n\ninterface PagePointerProviderProps extends JSX.HTMLAttributes<HTMLDivElement> {\n  children: ComponentChildren;\n  pageIndex: number;\n  pageWidth: number;\n  pageHeight: number;\n  rotation: number;\n  scale: number;\n  style?: JSX.CSSProperties;\n  convertEventToPoint?: (event: PointerEvent, element: HTMLElement) => Position;\n}\n\nexport const PagePointerProvider = ({\n  pageIndex,\n  children,\n  pageWidth,\n  pageHeight,\n  rotation,\n  scale,\n  convertEventToPoint,\n  style,\n  ...props\n}: PagePointerProviderProps) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const { provides: cap } = useInteractionManagerCapability();\n  const isPageExclusive = useIsPageExclusive();\n\n  const defaultConvertEventToPoint = useCallback(\n    (event: PointerEvent, element: HTMLElement): Position => {\n      const rect = element.getBoundingClientRect();\n      const displayPoint = {\n        x: event.clientX - rect.left,\n        y: event.clientY - rect.top,\n      };\n      return restorePosition(\n        { width: pageWidth, height: pageHeight },\n        displayPoint,\n        rotation,\n        scale,\n      );\n    },\n    [pageWidth, pageHeight, rotation, scale],\n  );\n\n  useEffect(() => {\n    if (!cap || !ref.current) return;\n\n    return createPointerProvider(\n      cap,\n      { type: 'page', pageIndex },\n      ref.current,\n      convertEventToPoint || defaultConvertEventToPoint,\n    );\n  }, [cap, pageIndex, convertEventToPoint, defaultConvertEventToPoint]);\n\n  return (\n    <div\n      ref={ref}\n      style={{\n        ...style,\n      }}\n      {...props}\n    >\n      {children}\n      {isPageExclusive && (\n        <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, zIndex: 10 }} />\n      )}\n    </div>\n  );\n};\n"],"names":["P","b","g","t","S","r","e","h","L","i","useInteractionManagerPlugin","usePlugin","InteractionManagerPlugin","useInteractionManagerCapability","useCapability","useInteractionManager","provides","state","setState","useState","initialState","useEffect","useCursor","token","cursor","prio","usePointerHandlers","modeId","pageIndex","handlers","options","finalModeId","finalPageIndex","useIsPageExclusive","cap","isPageExclusive","setIsPageExclusive","m","mode","GlobalPointerProvider","children","style","props","ref","useRef","createPointerProvider","jsx","PagePointerProvider","pageWidth","pageHeight","rotation","scale","convertEventToPoint","defaultConvertEventToPoint","useCallback","event","element","rect","displayPoint","restorePosition","jsxs"],"mappings":"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"}