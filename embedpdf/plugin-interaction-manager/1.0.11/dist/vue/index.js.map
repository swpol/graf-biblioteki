{"version":3,"file":"index.js","sources":["../../../core/dist/vue/index.js","../../src/vue/hooks/use-interaction-manager.ts","../../src/vue/components/global-pointer-provider.vue","../../src/vue/components/page-pointer-provider.vue"],"sourcesContent":["import { inject as p, ref as u, onMounted as a, onBeforeUnmount as l, shallowRef as d, watch as v, computed as y, defineComponent as m, provide as P, renderSlot as w } from \"vue\";\nimport { a as h, P as S } from \"../math-ChSRQF3r.js\";\nconst f = Symbol(\"pdfKey\");\nfunction c() {\n  const r = p(f);\n  if (!r) throw new Error(\"useRegistry must be used inside <EmbedPDF>\");\n  return r;\n}\nfunction b() {\n  const { registry: r } = c(), e = u();\n  return a(() => {\n    const o = r.value.getStore();\n    e.value = o.getState().core;\n    const t = o.subscribe((s, n, i) => {\n      o.isCoreAction(s) && !h(n.core, i.core) && (e.value = n.core);\n    });\n    l(t);\n  }), e;\n}\nfunction R(r) {\n  const { registry: e } = c(), o = d(null), t = u(!0), s = u(new Promise(() => {\n  })), n = () => {\n    var g;\n    if (!e.value) return;\n    const i = e.value.getPlugin(r);\n    if (!i) throw new Error(`Plugin ${r} not found`);\n    o.value = i, t.value = !1, s.value = ((g = i.ready) == null ? void 0 : g.call(i)) ?? Promise.resolve();\n  };\n  return a(n), v(e, n), { plugin: o, isLoading: t, ready: s };\n}\nfunction z(r) {\n  const { plugin: e, isLoading: o, ready: t } = R(r);\n  return { provides: y(() => {\n    if (!e.value) return null;\n    if (!e.value.provides)\n      throw new Error(`Plugin ${r} does not implement provides()`);\n    return e.value.provides();\n  }), isLoading: o, ready: t };\n}\nfunction C() {\n  const { registry: r } = c(), e = u();\n  function o() {\n    return r.value ? (e.value = r.value.getStore().getState(), r.value.getStore().subscribe((s, n) => e.value = n)) : () => {\n    };\n  }\n  let t = o();\n  return v(r, () => {\n    t == null || t(), t = o();\n  }), l(() => t == null ? void 0 : t()), e;\n}\nconst F = /* @__PURE__ */ m({\n  __name: \"embed-pdf\",\n  props: {\n    engine: {},\n    plugins: {},\n    onInitialized: { type: Function }\n  },\n  setup(r) {\n    const e = r, o = d(null), t = u(!0), s = u(!1);\n    return P(f, { registry: o, isInitializing: t, pluginsReady: s }), a(async () => {\n      var i;\n      const n = new S(e.engine);\n      n.registerPluginBatch(e.plugins), await n.initialize(), await ((i = e.onInitialized) == null ? void 0 : i.call(e, n)), o.value = n, t.value = !1, n.pluginsReady().then(() => s.value = !0);\n    }), l(() => {\n      var n;\n      return (n = o.value) == null ? void 0 : n.destroy();\n    }), (n, i) => w(n.$slots, \"default\", {\n      registry: o.value,\n      isInitializing: t.value,\n      pluginsReady: s.value\n    });\n  }\n});\nexport {\n  F as EmbedPDF,\n  z as useCapability,\n  b as useCoreState,\n  R as usePlugin,\n  c as useRegistry,\n  C as useStoreState\n};\n//# sourceMappingURL=index.js.map\n","import { useCapability, usePlugin } from '@embedpdf/core/vue';\nimport {\n  initialState,\n  InteractionManagerPlugin,\n  InteractionManagerState,\n  PointerEventHandlersWithLifecycle,\n} from '@embedpdf/plugin-interaction-manager';\nimport { ref, watchEffect, readonly } from 'vue';\n\nexport const useInteractionManagerPlugin = () =>\n  usePlugin<InteractionManagerPlugin>(InteractionManagerPlugin.id);\nexport const useInteractionManagerCapability = () =>\n  useCapability<InteractionManagerPlugin>(InteractionManagerPlugin.id);\n\nexport function useInteractionManager() {\n  const { provides } = useInteractionManagerCapability();\n  const state = ref<InteractionManagerState>(initialState);\n\n  watchEffect((onCleanup) => {\n    if (provides.value) {\n      // onStateChange is a BehaviorEmitter, so it emits the current state upon subscription\n      const unsubscribe = provides.value.onStateChange((newState) => {\n        state.value = newState;\n      });\n      onCleanup(unsubscribe);\n    }\n  });\n\n  return {\n    provides,\n    state: readonly(state),\n  };\n}\n\nexport function useCursor() {\n  const { provides } = useInteractionManagerCapability();\n  return {\n    setCursor: (token: string, cursor: string, prio = 0) => {\n      provides.value?.setCursor(token, cursor, prio);\n    },\n    removeCursor: (token: string) => {\n      provides.value?.removeCursor(token);\n    },\n  };\n}\n\ninterface UsePointerHandlersOptions {\n  modeId?: string | string[];\n  pageIndex?: number;\n}\n\nexport function usePointerHandlers({ modeId, pageIndex }: UsePointerHandlersOptions) {\n  const { provides } = useInteractionManagerCapability();\n  return {\n    register: (\n      handlers: PointerEventHandlersWithLifecycle,\n      options?: { modeId?: string | string[]; pageIndex?: number },\n    ) => {\n      // Use provided options or fall back to hook-level options\n      const finalModeId = options?.modeId ?? modeId;\n      const finalPageIndex = options?.pageIndex ?? pageIndex;\n\n      if (!provides.value) return;\n\n      return finalModeId\n        ? provides.value.registerHandlers({\n            modeId: finalModeId,\n            handlers,\n            pageIndex: finalPageIndex,\n          })\n        : provides.value.registerAlways({\n            scope:\n              finalPageIndex !== undefined\n                ? { type: 'page', pageIndex: finalPageIndex }\n                : { type: 'global' },\n            handlers,\n          });\n    },\n  };\n}\n\nexport function useIsPageExclusive() {\n  const { provides: cap } = useInteractionManagerCapability();\n  const isPageExclusive = ref<boolean>(false);\n\n  watchEffect((onCleanup) => {\n    if (cap.value) {\n      const mode = cap.value.getActiveInteractionMode();\n      isPageExclusive.value = mode?.scope === 'page' && !!mode?.exclusive;\n\n      const unsubscribe = cap.value.onModeChange(() => {\n        if (!cap.value) return;\n        const newMode = cap.value.getActiveInteractionMode();\n        isPageExclusive.value = newMode?.scope === 'page' && !!newMode?.exclusive;\n      });\n      onCleanup(unsubscribe);\n    }\n  });\n\n  return readonly(isPageExclusive);\n}\n","<script setup lang=\"ts\">\nimport { ref, watchEffect } from 'vue';\nimport { createPointerProvider } from '../../shared/utils';\nimport { useInteractionManagerCapability } from '../hooks';\n\nconst divRef = ref<HTMLDivElement | null>(null);\nconst { provides: cap } = useInteractionManagerCapability();\n\n// watchEffect automatically handles setup and teardown when capability or element is ready\nwatchEffect((onCleanup) => {\n  if (cap.value && divRef.value) {\n    const cleanup = createPointerProvider(cap.value, { type: 'global' }, divRef.value);\n    onCleanup(cleanup);\n  }\n});\n</script>\n\n<template>\n  <div\n    ref=\"divRef\"\n    :style=\"{\n      width: '100%',\n      height: '100%',\n    }\"\n  >\n    <slot />\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { ref, watchEffect, computed, StyleValue } from 'vue';\nimport { Position, restorePosition } from '@embedpdf/models';\nimport { createPointerProvider } from '../../shared/utils';\nimport { useInteractionManagerCapability, useIsPageExclusive } from '../hooks';\n\ninterface Props {\n  pageIndex: number;\n  pageWidth: number;\n  pageHeight: number;\n  rotation: number;\n  scale: number;\n  convertEventToPoint?: (event: PointerEvent, element: HTMLElement) => Position;\n}\n\nconst props = defineProps<Props>();\n\nconst divRef = ref<HTMLDivElement | null>(null);\nconst { provides: cap } = useInteractionManagerCapability();\nconst isPageExclusive = useIsPageExclusive();\n\nconst defaultConvertEventToPoint = computed(() => {\n  return (event: PointerEvent, element: HTMLElement): Position => {\n    const rect = element.getBoundingClientRect();\n    const displayPoint = {\n      x: event.clientX - rect.left,\n      y: event.clientY - rect.top,\n    };\n    return restorePosition(\n      { width: props.pageWidth, height: props.pageHeight },\n      displayPoint,\n      props.rotation,\n      props.scale,\n    );\n  };\n});\n\nwatchEffect((onCleanup) => {\n  if (cap.value && divRef.value) {\n    const cleanup = createPointerProvider(\n      cap.value,\n      { type: 'page', pageIndex: props.pageIndex },\n      divRef.value,\n      props.convertEventToPoint || defaultConvertEventToPoint.value,\n    );\n    onCleanup(cleanup);\n  }\n});\n</script>\n\n<template>\n  <div ref=\"divRef\">\n    <slot />\n    <div\n      v-if=\"isPageExclusive\"\n      :style=\"{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, zIndex: 10 }\"\n    />\n  </div>\n</template>\n"],"names":["f","c","r","p","R","o","d","t","u","s","n","g","i","a","v","z","y","useInteractionManagerPlugin","usePlugin","InteractionManagerPlugin","useInteractionManagerCapability","useCapability","useInteractionManager","provides","state","ref","initialState","watchEffect","onCleanup","unsubscribe","newState","readonly","useCursor","token","cursor","prio","_a","usePointerHandlers","modeId","pageIndex","handlers","options","finalModeId","finalPageIndex","useIsPageExclusive","cap","isPageExclusive","mode","newMode","divRef","cleanup","createPointerProvider","_createElementBlock","_renderSlot","_ctx","props","__props","defaultConvertEventToPoint","computed","event","element","rect","displayPoint","restorePosition","_unref","_openBlock","_hoisted_1"],"mappings":"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"}