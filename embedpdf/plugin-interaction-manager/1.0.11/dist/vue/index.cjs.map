{"version":3,"file":"index.cjs","sources":["../../../core/dist/vue/index.js","../../src/vue/hooks/use-interaction-manager.ts","../../src/vue/components/global-pointer-provider.vue","../../src/vue/components/page-pointer-provider.vue"],"sourcesContent":["import { inject as p, ref as u, onMounted as a, onBeforeUnmount as l, shallowRef as d, watch as v, computed as y, defineComponent as m, provide as P, renderSlot as w } from \"vue\";\nimport { a as h, P as S } from \"../math-ChSRQF3r.js\";\nconst f = Symbol(\"pdfKey\");\nfunction c() {\n  const r = p(f);\n  if (!r) throw new Error(\"useRegistry must be used inside <EmbedPDF>\");\n  return r;\n}\nfunction b() {\n  const { registry: r } = c(), e = u();\n  return a(() => {\n    const o = r.value.getStore();\n    e.value = o.getState().core;\n    const t = o.subscribe((s, n, i) => {\n      o.isCoreAction(s) && !h(n.core, i.core) && (e.value = n.core);\n    });\n    l(t);\n  }), e;\n}\nfunction R(r) {\n  const { registry: e } = c(), o = d(null), t = u(!0), s = u(new Promise(() => {\n  })), n = () => {\n    var g;\n    if (!e.value) return;\n    const i = e.value.getPlugin(r);\n    if (!i) throw new Error(`Plugin ${r} not found`);\n    o.value = i, t.value = !1, s.value = ((g = i.ready) == null ? void 0 : g.call(i)) ?? Promise.resolve();\n  };\n  return a(n), v(e, n), { plugin: o, isLoading: t, ready: s };\n}\nfunction z(r) {\n  const { plugin: e, isLoading: o, ready: t } = R(r);\n  return { provides: y(() => {\n    if (!e.value) return null;\n    if (!e.value.provides)\n      throw new Error(`Plugin ${r} does not implement provides()`);\n    return e.value.provides();\n  }), isLoading: o, ready: t };\n}\nfunction C() {\n  const { registry: r } = c(), e = u();\n  function o() {\n    return r.value ? (e.value = r.value.getStore().getState(), r.value.getStore().subscribe((s, n) => e.value = n)) : () => {\n    };\n  }\n  let t = o();\n  return v(r, () => {\n    t == null || t(), t = o();\n  }), l(() => t == null ? void 0 : t()), e;\n}\nconst F = /* @__PURE__ */ m({\n  __name: \"embed-pdf\",\n  props: {\n    engine: {},\n    plugins: {},\n    onInitialized: { type: Function }\n  },\n  setup(r) {\n    const e = r, o = d(null), t = u(!0), s = u(!1);\n    return P(f, { registry: o, isInitializing: t, pluginsReady: s }), a(async () => {\n      var i;\n      const n = new S(e.engine);\n      n.registerPluginBatch(e.plugins), await n.initialize(), await ((i = e.onInitialized) == null ? void 0 : i.call(e, n)), o.value = n, t.value = !1, n.pluginsReady().then(() => s.value = !0);\n    }), l(() => {\n      var n;\n      return (n = o.value) == null ? void 0 : n.destroy();\n    }), (n, i) => w(n.$slots, \"default\", {\n      registry: o.value,\n      isInitializing: t.value,\n      pluginsReady: s.value\n    });\n  }\n});\nexport {\n  F as EmbedPDF,\n  z as useCapability,\n  b as useCoreState,\n  R as usePlugin,\n  c as useRegistry,\n  C as useStoreState\n};\n//# sourceMappingURL=index.js.map\n","import { useCapability, usePlugin } from '@embedpdf/core/vue';\nimport {\n  initialState,\n  InteractionManagerPlugin,\n  InteractionManagerState,\n  PointerEventHandlersWithLifecycle,\n} from '@embedpdf/plugin-interaction-manager';\nimport { ref, watchEffect, readonly } from 'vue';\n\nexport const useInteractionManagerPlugin = () =>\n  usePlugin<InteractionManagerPlugin>(InteractionManagerPlugin.id);\nexport const useInteractionManagerCapability = () =>\n  useCapability<InteractionManagerPlugin>(InteractionManagerPlugin.id);\n\nexport function useInteractionManager() {\n  const { provides } = useInteractionManagerCapability();\n  const state = ref<InteractionManagerState>(initialState);\n\n  watchEffect((onCleanup) => {\n    if (provides.value) {\n      // onStateChange is a BehaviorEmitter, so it emits the current state upon subscription\n      const unsubscribe = provides.value.onStateChange((newState) => {\n        state.value = newState;\n      });\n      onCleanup(unsubscribe);\n    }\n  });\n\n  return {\n    provides,\n    state: readonly(state),\n  };\n}\n\nexport function useCursor() {\n  const { provides } = useInteractionManagerCapability();\n  return {\n    setCursor: (token: string, cursor: string, prio = 0) => {\n      provides.value?.setCursor(token, cursor, prio);\n    },\n    removeCursor: (token: string) => {\n      provides.value?.removeCursor(token);\n    },\n  };\n}\n\ninterface UsePointerHandlersOptions {\n  modeId?: string | string[];\n  pageIndex?: number;\n}\n\nexport function usePointerHandlers({ modeId, pageIndex }: UsePointerHandlersOptions) {\n  const { provides } = useInteractionManagerCapability();\n  return {\n    register: (\n      handlers: PointerEventHandlersWithLifecycle,\n      options?: { modeId?: string | string[]; pageIndex?: number },\n    ) => {\n      // Use provided options or fall back to hook-level options\n      const finalModeId = options?.modeId ?? modeId;\n      const finalPageIndex = options?.pageIndex ?? pageIndex;\n\n      if (!provides.value) return;\n\n      return finalModeId\n        ? provides.value.registerHandlers({\n            modeId: finalModeId,\n            handlers,\n            pageIndex: finalPageIndex,\n          })\n        : provides.value.registerAlways({\n            scope:\n              finalPageIndex !== undefined\n                ? { type: 'page', pageIndex: finalPageIndex }\n                : { type: 'global' },\n            handlers,\n          });\n    },\n  };\n}\n\nexport function useIsPageExclusive() {\n  const { provides: cap } = useInteractionManagerCapability();\n  const isPageExclusive = ref<boolean>(false);\n\n  watchEffect((onCleanup) => {\n    if (cap.value) {\n      const mode = cap.value.getActiveInteractionMode();\n      isPageExclusive.value = mode?.scope === 'page' && !!mode?.exclusive;\n\n      const unsubscribe = cap.value.onModeChange(() => {\n        if (!cap.value) return;\n        const newMode = cap.value.getActiveInteractionMode();\n        isPageExclusive.value = newMode?.scope === 'page' && !!newMode?.exclusive;\n      });\n      onCleanup(unsubscribe);\n    }\n  });\n\n  return readonly(isPageExclusive);\n}\n","<script setup lang=\"ts\">\nimport { ref, watchEffect } from 'vue';\nimport { createPointerProvider } from '../../shared/utils';\nimport { useInteractionManagerCapability } from '../hooks';\n\nconst divRef = ref<HTMLDivElement | null>(null);\nconst { provides: cap } = useInteractionManagerCapability();\n\n// watchEffect automatically handles setup and teardown when capability or element is ready\nwatchEffect((onCleanup) => {\n  if (cap.value && divRef.value) {\n    const cleanup = createPointerProvider(cap.value, { type: 'global' }, divRef.value);\n    onCleanup(cleanup);\n  }\n});\n</script>\n\n<template>\n  <div\n    ref=\"divRef\"\n    :style=\"{\n      width: '100%',\n      height: '100%',\n    }\"\n  >\n    <slot />\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { ref, watchEffect, computed, StyleValue } from 'vue';\nimport { Position, restorePosition } from '@embedpdf/models';\nimport { createPointerProvider } from '../../shared/utils';\nimport { useInteractionManagerCapability, useIsPageExclusive } from '../hooks';\n\ninterface Props {\n  pageIndex: number;\n  pageWidth: number;\n  pageHeight: number;\n  rotation: number;\n  scale: number;\n  convertEventToPoint?: (event: PointerEvent, element: HTMLElement) => Position;\n}\n\nconst props = defineProps<Props>();\n\nconst divRef = ref<HTMLDivElement | null>(null);\nconst { provides: cap } = useInteractionManagerCapability();\nconst isPageExclusive = useIsPageExclusive();\n\nconst defaultConvertEventToPoint = computed(() => {\n  return (event: PointerEvent, element: HTMLElement): Position => {\n    const rect = element.getBoundingClientRect();\n    const displayPoint = {\n      x: event.clientX - rect.left,\n      y: event.clientY - rect.top,\n    };\n    return restorePosition(\n      { width: props.pageWidth, height: props.pageHeight },\n      displayPoint,\n      props.rotation,\n      props.scale,\n    );\n  };\n});\n\nwatchEffect((onCleanup) => {\n  if (cap.value && divRef.value) {\n    const cleanup = createPointerProvider(\n      cap.value,\n      { type: 'page', pageIndex: props.pageIndex },\n      divRef.value,\n      props.convertEventToPoint || defaultConvertEventToPoint.value,\n    );\n    onCleanup(cleanup);\n  }\n});\n</script>\n\n<template>\n  <div ref=\"divRef\">\n    <slot />\n    <div\n      v-if=\"isPageExclusive\"\n      :style=\"{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, zIndex: 10 }\"\n    />\n  </div>\n</template>\n"],"names":["f","c","r","p","R","d","t","u","s","n","g","i","a","v","z","y","useInteractionManagerPlugin","usePlugin","InteractionManagerPlugin","useInteractionManagerCapability","useCapability","useInteractionManager","provides","state","ref","initialState","watchEffect","onCleanup","unsubscribe","newState","readonly","useCursor","token","cursor","prio","_a","usePointerHandlers","modeId","pageIndex","handlers","options","finalModeId","finalPageIndex","useIsPageExclusive","cap","isPageExclusive","mode","newMode","divRef","cleanup","createPointerProvider","_createElementBlock","_renderSlot","_ctx","props","__props","defaultConvertEventToPoint","computed","event","element","rect","displayPoint","restorePosition","_unref","_openBlock","_hoisted_1"],"mappings":"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"}