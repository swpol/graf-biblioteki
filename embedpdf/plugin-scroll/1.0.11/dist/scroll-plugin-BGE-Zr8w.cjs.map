{"version":3,"file":"scroll-plugin-BGE-Zr8w.cjs","sources":["../../core/dist/math-ChSRQF3r.js","../../core/dist/index.js","../../models/dist/index.js","../src/lib/types.ts","../src/lib/strategies/base-strategy.ts","../src/lib/strategies/vertical-strategy.ts","../src/lib/strategies/horizontal-strategy.ts","../src/lib/actions.ts","../src/lib/selectors.ts","../src/lib/scroll-plugin.ts"],"sourcesContent":["class b {\n  constructor() {\n    this.dependencyGraph = /* @__PURE__ */ new Map();\n  }\n  addNode(e, t = []) {\n    this.dependencyGraph.set(e, new Set(t));\n  }\n  hasCircularDependencies() {\n    const e = /* @__PURE__ */ new Set(), t = /* @__PURE__ */ new Set(), r = (s) => {\n      e.add(s), t.add(s);\n      const n = this.dependencyGraph.get(s) || /* @__PURE__ */ new Set();\n      for (const a of n)\n        if (e.has(a)) {\n          if (t.has(a))\n            return !0;\n        } else if (r(a)) return !0;\n      return t.delete(s), !1;\n    };\n    for (const s of this.dependencyGraph.keys())\n      if (!e.has(s) && r(s))\n        return !0;\n    return !1;\n  }\n  resolveLoadOrder() {\n    if (this.hasCircularDependencies())\n      throw new Error(\"Circular dependencies detected\");\n    const e = [], t = /* @__PURE__ */ new Set(), r = /* @__PURE__ */ new Set(), s = (n) => {\n      if (r.has(n)) throw new Error(\"Circular dependency\");\n      if (t.has(n)) return;\n      r.add(n);\n      const a = this.dependencyGraph.get(n) || /* @__PURE__ */ new Set();\n      for (const o of a)\n        s(o);\n      r.delete(n), t.add(n), e.push(n);\n    };\n    for (const n of this.dependencyGraph.keys())\n      t.has(n) || s(n);\n    return e;\n  }\n}\nclass l extends Error {\n  constructor(e) {\n    super(e), this.name = \"PluginRegistrationError\";\n  }\n}\nclass u extends Error {\n  constructor(e) {\n    super(e), this.name = \"PluginNotFoundError\";\n  }\n}\nclass m extends Error {\n  constructor(e) {\n    super(e), this.name = \"CircularDependencyError\";\n  }\n}\nclass K extends Error {\n  constructor(e) {\n    super(e), this.name = \"CapabilityNotFoundError\";\n  }\n}\nclass H extends Error {\n  constructor(e) {\n    super(e), this.name = \"CapabilityConflictError\";\n  }\n}\nclass W extends Error {\n  constructor(e) {\n    super(e), this.name = \"PluginInitializationError\";\n  }\n}\nclass R extends Error {\n  constructor(e) {\n    super(e), this.name = \"PluginConfigurationError\";\n  }\n}\nclass D {\n  /**\n   * Initializes the PluginStore with the main store and plugin ID.\n   * @param store The main store instance.\n   * @param pluginId The unique identifier for the plugin.\n   */\n  constructor(e, t) {\n    this.store = e, this.pluginId = t;\n  }\n  /**\n   * Gets the current state of the plugin.\n   * @returns The plugin's state.\n   */\n  getState() {\n    return this.store.getState().plugins[this.pluginId];\n  }\n  /**\n   * Dispatches an action for the plugin and returns the *new* global state.\n   * If you only need the plugin’s updated state, call `getState()` afterward.\n   * @param action The action to dispatch.\n   * @returns The updated global store state (after plugin reducer).\n   */\n  dispatch(e) {\n    return this.store.dispatchToPlugin(this.pluginId, e);\n  }\n  /**\n   * Subscribes to state changes only for this specific plugin.\n   * You now receive (action, newPluginState, oldPluginState) in the callback.\n   *\n   * @param listener The callback to invoke when plugin state changes.\n   * @returns A function to unsubscribe the listener.\n   */\n  subscribeToState(e) {\n    return this.store.subscribeToPlugin(this.pluginId, (t, r, s) => {\n      e(\n        t,\n        r,\n        s\n      );\n    });\n  }\n  /**\n   * Subscribes to a specific action type for the plugin.\n   * This still uses the main store's `onAction`, so you get the *global*\n   * old/new store states there. If you specifically want old/new plugin state,\n   * use `subscribeToState` instead.\n   *\n   * @param type The action type to listen for.\n   * @param handler The callback to invoke when the action occurs.\n   * @returns A function to unsubscribe the handler.\n   */\n  onAction(e, t) {\n    return this.store.onAction(e, (r, s, n) => {\n      t(\n        r,\n        s.plugins[this.pluginId],\n        n.plugins[this.pluginId]\n      );\n    });\n  }\n}\nconst g = \"LOAD_DOCUMENT\", f = \"SET_DOCUMENT\", p = \"SET_DOCUMENT_ERROR\", y = \"SET_SCALE\", w = \"SET_ROTATION\", E = \"SET_PAGES\", O = [\n  g,\n  f,\n  p,\n  y,\n  w,\n  E\n], Z = () => ({ type: g }), I = (i) => ({\n  type: f,\n  payload: i\n}), V = (i) => ({\n  type: p,\n  payload: i\n}), J = (i) => ({ type: y, payload: i }), Y = (i) => ({\n  type: w,\n  payload: i\n}), Q = (i) => ({\n  type: E,\n  payload: i\n});\nclass A {\n  /**\n   * Initializes the store with the provided core state.\n   * @param reducer          The core reducer function\n   * @param initialCoreState The initial core state\n   */\n  constructor(e, t) {\n    this.initialCoreState = t, this.pluginReducers = {}, this.listeners = [], this.pluginListeners = {}, this.state = { core: t, plugins: {} }, this.coreReducer = e;\n  }\n  /**\n   * Adds a reducer for a plugin-specific state.\n   * @param pluginId The unique identifier for the plugin.\n   * @param reducer The reducer function for the plugin state.\n   * @param initialState The initial state for the plugin.\n   */\n  addPluginReducer(e, t, r) {\n    this.state.plugins[e] = r, this.pluginReducers[e] = t;\n  }\n  /**\n   * Dispatches an action *only* to the core reducer.\n   * Notifies the global store listeners with (action, newState, oldState).\n   *\n   * @param action The action to dispatch, typed as CoreAction\n   * @returns The updated *global* store state\n   */\n  dispatchToCore(e) {\n    if (!this.coreReducer)\n      return this.getState();\n    const t = this.getState();\n    this.state.core = this.coreReducer(this.state.core, e);\n    const r = this.getState();\n    return this.listeners.forEach((s) => s(e, r, t)), r;\n  }\n  /**\n   * Dispatches an action *only* to a specific plugin.\n   * Optionally notifies global store listeners if `notifyGlobal` is true.\n   * Always notifies plugin-specific listeners with (action, newPluginState, oldPluginState).\n   *\n   * @param pluginId   The plugin identifier\n   * @param action     The plugin action to dispatch\n   * @param notifyGlobal Whether to also notify global store listeners\n   * @returns The updated *global* store state\n   */\n  dispatchToPlugin(e, t, r = !0) {\n    const s = this.getState(), n = this.pluginReducers[e];\n    if (!n)\n      return s;\n    const a = s.plugins[e], o = n(a, t);\n    this.state.plugins[e] = o;\n    const c = this.getState();\n    return r && this.listeners.forEach((h) => h(t, c, s)), this.pluginListeners[e] && this.pluginListeners[e].forEach((h) => {\n      h(t, o, a);\n    }), o;\n  }\n  /**\n   * Dispatches an action to update the state using:\n   * - the core reducer (if it's a CoreAction)\n   * - *all* plugin reducers (regardless of action type), with no global notify for each plugin\n   *\n   * Returns the new *global* store state after all reducers have processed the action.\n   *\n   * @param action The action to dispatch (can be CoreAction or any Action).\n   */\n  dispatch(e) {\n    const t = this.getState();\n    this.isCoreAction(e) && (this.state.core = this.coreReducer(this.state.core, e));\n    for (const s in this.pluginReducers) {\n      const n = this.pluginReducers[s], a = t.plugins[s];\n      n && (this.state.plugins[s] = n(a, e));\n    }\n    const r = this.getState();\n    return this.listeners.forEach((s) => s(e, r, t)), r;\n  }\n  /**\n   * Returns a shallow copy of the current state.\n   * @returns The current store state.\n   */\n  getState() {\n    return {\n      core: { ...this.state.core },\n      plugins: { ...this.state.plugins }\n    };\n  }\n  /**\n   * Subscribes a listener to *global* state changes.\n   * The callback signature is now (action, newState, oldState).\n   *\n   * @param listener The callback to invoke on state changes\n   * @returns A function to unsubscribe the listener\n   */\n  subscribe(e) {\n    return this.listeners.push(e), () => {\n      this.listeners = this.listeners.filter((t) => t !== e);\n    };\n  }\n  /**\n   * Subscribes a listener to *plugin-specific* state changes.\n   * The callback signature is now (action, newPluginState, oldPluginState).\n   *\n   * @param pluginId The unique identifier for the plugin.\n   * @param listener The callback to invoke on plugin state changes.\n   * @returns A function to unsubscribe the listener.\n   */\n  subscribeToPlugin(e, t) {\n    if (!(e in this.state.plugins))\n      throw new Error(\n        `Plugin state not found for plugin \"${e}\". Did you forget to call addPluginReducer?`\n      );\n    return this.pluginListeners[e] || (this.pluginListeners[e] = []), this.pluginListeners[e].push(t), () => {\n      this.pluginListeners[e] = this.pluginListeners[e].filter((r) => r !== t), this.pluginListeners[e].length === 0 && delete this.pluginListeners[e];\n    };\n  }\n  /**\n   * Subscribes to a specific action type (only from the core's action union).\n   * The callback signature is (action, newState, oldState).\n   *\n   * @param type The action type to listen for.\n   * @param handler The callback to invoke when the action occurs.\n   * @returns A function to unsubscribe the handler.\n   */\n  onAction(e, t) {\n    return this.subscribe((r, s, n) => {\n      r.type === e && t(r, s, n);\n    });\n  }\n  /**\n   * Gets a PluginStore handle for a specific plugin.\n   * @param pluginId The unique identifier for the plugin.\n   * @returns A PluginStore instance for the plugin.\n   */\n  getPluginStore(e) {\n    if (!(e in this.state.plugins))\n      throw new Error(\n        `Plugin state not found for plugin \"${e}\". Did you forget to call addPluginReducer?`\n      );\n    return new D(this, e);\n  }\n  /**\n   * Helper method to check if an action is a CoreAction.\n   * Adjust if you have a more refined way to differentiate CoreAction vs. any other Action.\n   */\n  isCoreAction(e) {\n    return O.includes(e.type);\n  }\n  /**\n   * Destroy the store: drop every listener and plugin reducer\n   */\n  destroy() {\n    var e, t;\n    this.listeners.length = 0;\n    for (const r in this.pluginListeners)\n      (t = (e = this.pluginListeners[r]) == null ? void 0 : e.splice) == null || t.call(e, 0);\n    this.pluginListeners = {}, this.pluginReducers = {}, this.state.plugins = {}, this.state.core = { ...this.initialCoreState };\n  }\n}\nvar C = /* @__PURE__ */ ((i) => (i[i.Degree0 = 0] = \"Degree0\", i[i.Degree90 = 1] = \"Degree90\", i[i.Degree180 = 2] = \"Degree180\", i[i.Degree270 = 3] = \"Degree270\", i))(C || {});\nfunction T(i) {\n  const { width: e, height: t } = i;\n  return {\n    width: t,\n    height: e\n  };\n}\nfunction X(i, e, t) {\n  return i = e % 2 === 0 ? i : T(i), {\n    width: i.width * t,\n    height: i.height * t\n  };\n}\nvar z = \"­\", M = \"​\", L = \"⁠\", $ = \"\\uFEFF\", F = \"￾\", N = \"￿\", k = Object.freeze([\n  z,\n  M,\n  L,\n  $,\n  F,\n  N\n]);\nnew RegExp(`[${k.join(\"\")}]`, \"g\");\nvar P = Object.freeze([\n  { id: 0, label: \"Normal\", css: \"normal\" },\n  { id: 1, label: \"Multiply\", css: \"multiply\" },\n  { id: 2, label: \"Screen\", css: \"screen\" },\n  { id: 3, label: \"Overlay\", css: \"overlay\" },\n  { id: 4, label: \"Darken\", css: \"darken\" },\n  { id: 5, label: \"Lighten\", css: \"lighten\" },\n  { id: 6, label: \"Color Dodge\", css: \"color-dodge\" },\n  { id: 7, label: \"Color Burn\", css: \"color-burn\" },\n  { id: 8, label: \"Hard Light\", css: \"hard-light\" },\n  { id: 9, label: \"Soft Light\", css: \"soft-light\" },\n  { id: 10, label: \"Difference\", css: \"difference\" },\n  { id: 11, label: \"Exclusion\", css: \"exclusion\" },\n  { id: 12, label: \"Hue\", css: \"hue\" },\n  { id: 13, label: \"Saturation\", css: \"saturation\" },\n  { id: 14, label: \"Color\", css: \"color\" },\n  { id: 15, label: \"Luminosity\", css: \"luminosity\" }\n]);\nP.reduce(\n  (i, e) => (i[e.id] = e, i),\n  {}\n);\nP.reduce((i, e) => (i[e.css] = e.id, i), {});\nP.map((i) => ({\n  value: i.id,\n  label: i.label\n}));\nvar _ = Object.freeze({\n  1: \"invisible\",\n  2: \"hidden\",\n  4: \"print\",\n  8: \"noZoom\",\n  16: \"noRotate\",\n  32: \"noView\",\n  64: \"readOnly\",\n  128: \"locked\",\n  256: \"toggleNoView\"\n});\nObject.entries(\n  _\n).reduce(\n  (i, [e, t]) => (i[t] = Number(e), i),\n  {}\n);\nconst j = (i) => ({\n  scale: (i == null ? void 0 : i.scale) ?? 1,\n  rotation: (i == null ? void 0 : i.rotation) ?? C.Degree0,\n  document: null,\n  pages: [],\n  loading: !1,\n  error: null\n}), q = (i, e) => {\n  switch (e.type) {\n    case g:\n      return {\n        ...i,\n        loading: !0,\n        error: null\n      };\n    case f:\n      return {\n        ...i,\n        document: e.payload,\n        pages: e.payload.pages.map((t) => [t]),\n        loading: !1,\n        error: null\n      };\n    case w:\n      return {\n        ...i,\n        rotation: e.payload\n      };\n    case E:\n      return {\n        ...i,\n        pages: e.payload\n      };\n    case p:\n      return {\n        ...i,\n        loading: !1,\n        error: e.payload\n      };\n    case y:\n      return {\n        ...i,\n        scale: e.payload\n      };\n    default:\n      return i;\n  }\n};\nclass ee {\n  constructor(e, t) {\n    this.plugins = /* @__PURE__ */ new Map(), this.manifests = /* @__PURE__ */ new Map(), this.capabilities = /* @__PURE__ */ new Map(), this.status = /* @__PURE__ */ new Map(), this.configurations = /* @__PURE__ */ new Map(), this.engineInitialized = !1, this.initPromise = null, this.pendingRegistrations = [], this.processingRegistrations = [], this.initialized = !1, this.isInitializing = !1, this.pluginsReadyPromise = null, this.destroyed = !1, this.resolver = new b(), this.engine = e, this.initialCoreState = j(t), this.store = new A(q, this.initialCoreState);\n  }\n  /**\n   * Ensure engine is initialized before proceeding\n   */\n  async ensureEngineInitialized() {\n    this.engineInitialized || (this.engine.initialize ? (await this.engine.initialize().toPromise(), this.engineInitialized = !0) : this.engineInitialized = !0);\n  }\n  /**\n   * Register a plugin without initializing it\n   */\n  registerPlugin(e, t) {\n    if (this.initialized && !this.isInitializing)\n      throw new l(\"Cannot register plugins after initialization\");\n    this.validateManifest(e.manifest), this.store.addPluginReducer(\n      e.manifest.id,\n      // We need one type assertion here since we can't fully reconcile TAction with Action\n      // due to TypeScript's type system limitations with generic variance\n      e.reducer,\n      typeof e.initialState == \"function\" ? e.initialState(\n        this.initialCoreState,\n        {\n          ...e.manifest.defaultConfig,\n          ...t\n        }\n      ) : e.initialState\n    ), this.pendingRegistrations.push({\n      package: e,\n      config: t\n    });\n  }\n  /**\n   * Get the central store instance\n   */\n  getStore() {\n    return this.store;\n  }\n  /**\n   * Get the engine instance\n   */\n  getEngine() {\n    return this.engine;\n  }\n  /**\n   * Get a promise that resolves when all plugins are ready\n   */\n  pluginsReady() {\n    return this.pluginsReadyPromise ? this.pluginsReadyPromise : (this.pluginsReadyPromise = (async () => {\n      this.initialized || await this.initialize();\n      const e = Array.from(this.plugins.values()).map(\n        (t) => typeof t.ready == \"function\" ? t.ready() : Promise.resolve()\n      );\n      await Promise.all(e);\n    })(), this.pluginsReadyPromise);\n  }\n  /**\n   * INITIALISE THE REGISTRY – runs once no-matter-how-many calls   *\n   */\n  async initialize() {\n    if (this.destroyed)\n      throw new l(\"Registry has been destroyed\");\n    return this.initPromise ? this.initPromise : (this.initPromise = (async () => {\n      var e;\n      if (this.initialized)\n        throw new l(\"Registry is already initialized\");\n      this.isInitializing = !0;\n      try {\n        if (await this.ensureEngineInitialized(), this.destroyed)\n          return;\n        for (; this.pendingRegistrations.length > 0; ) {\n          if (this.destroyed)\n            return;\n          this.processingRegistrations = [...this.pendingRegistrations], this.pendingRegistrations = [];\n          for (const r of this.processingRegistrations) {\n            const s = /* @__PURE__ */ new Set(), n = [...r.package.manifest.requires, ...r.package.manifest.optional];\n            for (const a of n) {\n              const o = this.processingRegistrations.find(\n                (c) => c.package.manifest.provides.includes(a)\n              );\n              o && s.add(o.package.manifest.id);\n            }\n            this.resolver.addNode(r.package.manifest.id, [...s]);\n          }\n          const t = this.resolver.resolveLoadOrder();\n          for (const r of t) {\n            const s = this.processingRegistrations.find((n) => n.package.manifest.id === r);\n            await this.initializePlugin(s.package.manifest, s.package.create, s.config);\n          }\n          this.processingRegistrations = [], this.resolver = new b();\n        }\n        for (const t of this.plugins.values())\n          await ((e = t.postInitialize) == null ? void 0 : e.call(t).catch((r) => {\n            console.error(`Error in postInitialize for plugin ${t.id}`, r), this.status.set(t.id, \"error\");\n          }));\n        this.initialized = !0;\n      } catch (t) {\n        throw t instanceof Error ? new m(\n          `Failed to resolve plugin dependencies: ${t.message}`\n        ) : t;\n      } finally {\n        this.isInitializing = !1;\n      }\n    })(), this.initPromise);\n  }\n  /**\n   * Initialize a single plugin with all necessary checks\n   */\n  async initializePlugin(e, t, r) {\n    const s = {\n      ...e.defaultConfig,\n      ...r\n    };\n    this.validateConfig(e.id, s, e.defaultConfig);\n    const n = t(this, this.engine, s);\n    this.validatePlugin(n);\n    for (const a of e.requires)\n      if (!this.capabilities.has(a))\n        throw new l(\n          `Missing required capability: ${a} for plugin ${e.id}`\n        );\n    for (const a of e.optional)\n      this.capabilities.has(a) && console.debug(`Optional capability ${a} is available for plugin ${e.id}`);\n    console.log(\"initializePlugin\", e.id, e.provides);\n    for (const a of e.provides) {\n      if (this.capabilities.has(a))\n        throw new l(\n          `Capability ${a} is already provided by plugin ${this.capabilities.get(a)}`\n        );\n      this.capabilities.set(a, e.id);\n    }\n    this.plugins.set(e.id, n), this.manifests.set(e.id, e), this.status.set(e.id, \"registered\"), this.configurations.set(e.id, s);\n    try {\n      n.initialize && await n.initialize(s), this.status.set(e.id, \"active\");\n    } catch (a) {\n      throw this.plugins.delete(e.id), this.manifests.delete(e.id), console.log(\"initializePlugin failed\", e.id, e.provides), e.provides.forEach((o) => this.capabilities.delete(o)), a;\n    }\n  }\n  getPluginConfig(e) {\n    const t = this.configurations.get(e);\n    if (!t)\n      throw new u(`Configuration for plugin ${e} not found`);\n    return t;\n  }\n  validateConfig(e, t, r) {\n    const n = Object.keys(r).filter((a) => !t.hasOwnProperty(a));\n    if (n.length > 0)\n      throw new R(\n        `Missing required configuration keys for plugin ${e}: ${n.join(\", \")}`\n      );\n  }\n  async updatePluginConfig(e, t) {\n    const r = this.getPlugin(e);\n    if (!r)\n      throw new u(`Plugin ${e} not found`);\n    const s = this.manifests.get(e), n = this.configurations.get(e);\n    if (!s || !n)\n      throw new u(`Plugin ${e} not found`);\n    const a = {\n      ...n,\n      ...t\n    };\n    this.validateConfig(e, a, s.defaultConfig), this.configurations.set(e, a), r.initialize && await r.initialize(a);\n  }\n  /**\n   * Register multiple plugins at once\n   */\n  registerPluginBatch(e) {\n    for (const t of e)\n      this.registerPlugin(t.package, t.config);\n  }\n  /**\n   * Unregister a plugin\n   */\n  async unregisterPlugin(e) {\n    const t = this.plugins.get(e);\n    if (!t)\n      throw new u(`Plugin ${e} is not registered`);\n    const r = this.manifests.get(e);\n    if (!r)\n      throw new u(`Manifest for plugin ${e} not found`);\n    for (const [s, n] of this.manifests.entries()) {\n      if (s === e) continue;\n      if ([...n.requires, ...n.optional].some(\n        (o) => r.provides.includes(o)\n      ))\n        throw new l(\n          `Cannot unregister plugin ${e}: plugin ${s} depends on it`\n        );\n    }\n    try {\n      t.destroy && await t.destroy();\n      for (const s of r.provides)\n        this.capabilities.delete(s);\n      this.plugins.delete(e), this.manifests.delete(e), this.status.delete(e);\n    } catch (s) {\n      throw s instanceof Error ? new Error(`Failed to unregister plugin ${e}: ${s.message}`) : s;\n    }\n  }\n  /**\n   * Get a plugin instance\n   * @param pluginId The ID of the plugin to get\n   * @returns The plugin instance or null if not found\n   */\n  getPlugin(e) {\n    const t = this.plugins.get(e);\n    return t || null;\n  }\n  /**\n   * Get a plugin that provides a specific capability\n   * @param capability The capability to get a provider for\n   * @returns The plugin providing the capability or null if not found\n   */\n  getCapabilityProvider(e) {\n    const t = this.capabilities.get(e);\n    return t ? this.getPlugin(t) : null;\n  }\n  /**\n   * Check if a capability is available\n   */\n  hasCapability(e) {\n    return this.capabilities.has(e);\n  }\n  /**\n   * Get all registered plugins\n   */\n  getAllPlugins() {\n    return Array.from(this.plugins.values());\n  }\n  /**\n   * Get plugin status\n   */\n  getPluginStatus(e) {\n    const t = this.status.get(e);\n    if (!t)\n      throw new u(`Plugin ${e} not found`);\n    return t;\n  }\n  /**\n   * Validate plugin object\n   */\n  validatePlugin(e) {\n    if (!e.id)\n      throw new l(\"Plugin must have an id\");\n  }\n  /**\n   * Validate plugin manifest\n   */\n  validateManifest(e) {\n    if (!e.id)\n      throw new l(\"Manifest must have an id\");\n    if (!e.name)\n      throw new l(\"Manifest must have a name\");\n    if (!e.version)\n      throw new l(\"Manifest must have a version\");\n    if (!Array.isArray(e.provides))\n      throw new l(\"Manifest must have a provides array\");\n    if (!Array.isArray(e.requires))\n      throw new l(\"Manifest must have a requires array\");\n    if (!Array.isArray(e.optional))\n      throw new l(\"Manifest must have an optional array\");\n  }\n  isDestroyed() {\n    return this.destroyed;\n  }\n  /**\n   * DESTROY EVERYTHING – waits for any ongoing initialise(), once  *\n   */\n  async destroy() {\n    var e;\n    if (this.destroyed) throw new l(\"Registry has already been destroyed\");\n    this.destroyed = !0;\n    try {\n      await this.initPromise;\n    } catch {\n    }\n    for (const t of Array.from(this.plugins.values()).reverse())\n      await ((e = t.destroy) == null ? void 0 : e.call(t));\n    this.store.destroy(), this.plugins.clear(), this.manifests.clear(), this.capabilities.clear(), this.status.clear(), this.pendingRegistrations.length = 0, this.processingRegistrations.length = 0;\n  }\n}\nfunction te(i, e, t) {\n  return i < e ? e : i > t ? t : i;\n}\nfunction v(i, e, t) {\n  if (i === e)\n    return !0;\n  if (i == null || e == null)\n    return i === e;\n  const r = typeof i;\n  if (r !== typeof e) return !1;\n  if (r === \"object\") {\n    t || (t = /* @__PURE__ */ new Set());\n    const n = x(i, e);\n    if (t.has(n))\n      return !0;\n    t.add(n);\n    const a = Array.isArray(i), o = Array.isArray(e);\n    return a && o ? U(i, e, t) : !a && !o ? B(i, e, t) : !1;\n  }\n  return !1;\n}\nfunction x(i, e) {\n  return `${S(i)}__${S(e)}`;\n}\nlet G = 0;\nconst d = /* @__PURE__ */ new WeakMap();\nfunction S(i) {\n  return d.has(i) || d.set(i, ++G), d.get(i);\n}\nfunction U(i, e, t) {\n  if (i.length !== e.length) return !1;\n  const r = new Array(e.length).fill(!1);\n  e: for (let s = 0; s < i.length; s++) {\n    const n = i[s];\n    for (let a = 0; a < e.length; a++)\n      if (!r[a] && v(n, e[a], t)) {\n        r[a] = !0;\n        continue e;\n      }\n    return !1;\n  }\n  return !0;\n}\nfunction B(i, e, t) {\n  const r = Object.keys(i).sort(), s = Object.keys(e).sort();\n  if (r.length !== s.length) return !1;\n  for (let n = 0; n < r.length; n++)\n    if (r[n] !== s[n]) return !1;\n  for (const n of r) {\n    const a = i[n], o = e[n];\n    if (!v(a, o, t))\n      return !1;\n  }\n  return !0;\n}\nexport {\n  m as C,\n  b as D,\n  g as L,\n  ee as P,\n  f as S,\n  v as a,\n  l as b,\n  u as c,\n  K as d,\n  H as e,\n  W as f,\n  R as g,\n  p as h,\n  y as i,\n  w as j,\n  E as k,\n  O as l,\n  Z as m,\n  V as n,\n  J as o,\n  Y as p,\n  Q as q,\n  j as r,\n  I as s,\n  X as t,\n  te as u\n};\n//# sourceMappingURL=math-ChSRQF3r.js.map\n","import { t as S, a as m } from \"./math-ChSRQF3r.js\";\nimport { l as v, e as D, d as I, C as F, D as _, L as O, g as A, f as N, c as M, b as U, P as z, S as x, h as L, k as j, j as q, i as B, u as K, r as $, m as k, s as G, n as W, q as Y, p as H, o as J } from \"./math-ChSRQF3r.js\";\nconst f = (o) => o.pages.map(\n  (t) => t.map((e) => ({\n    ...e,\n    rotatedSize: S(e.size, o.rotation, 1)\n  }))\n);\nfunction y(o, t) {\n  return {\n    package: o,\n    config: t\n  };\n}\nclass w {\n  constructor(t, e) {\n    if (this.id = t, this.registry = e, this.debouncedActions = {}, this.unsubscribeFromState = null, this.unsubscribeFromCoreStore = null, t !== this.constructor.id)\n      throw new Error(\n        `Plugin ID mismatch: ${t} !== ${this.constructor.id}`\n      );\n    this.coreStore = this.registry.getStore(), this.pluginStore = this.coreStore.getPluginStore(this.id), this.unsubscribeFromState = this.pluginStore.subscribeToState((i, s, c) => {\n      this.onStoreUpdated(c, s);\n    }), this.unsubscribeFromCoreStore = this.coreStore.subscribe((i, s, c) => {\n      this.onCoreStoreUpdated(c, s);\n    }), this.readyPromise = new Promise((i) => {\n      this.readyResolve = i;\n    }), this.readyResolve();\n  }\n  provides() {\n    if (!this._capability) {\n      const t = this.buildCapability();\n      this._capability = Object.freeze(t);\n    }\n    return this._capability;\n  }\n  /**\n   *  Get a copy of the current state\n   */\n  get state() {\n    return this.pluginStore.getState();\n  }\n  /**\n   *  Get a copy of the current core state\n   */\n  get coreState() {\n    return this.coreStore.getState();\n  }\n  /**\n   * @deprecated  use `this.state` Get a copy of the current state\n   */\n  getState() {\n    return this.pluginStore.getState();\n  }\n  /**\n   * @deprecated  use `this.coreState` Get a copy of the current core state\n   */\n  getCoreState() {\n    return this.coreStore.getState();\n  }\n  /**\n   * Core Dispatch\n   */\n  dispatchCoreAction(t) {\n    return this.coreStore.dispatchToCore(t);\n  }\n  /**\n   * Dispatch an action to all plugins\n   */\n  dispatchToAllPlugins(t) {\n    return this.coreStore.dispatch(t);\n  }\n  /**\n   * Dispatch an action\n   */\n  dispatch(t) {\n    return this.pluginStore.dispatch(t);\n  }\n  /**\n   * Dispatch an action with debouncing to prevent rapid repeated calls\n   * @param action The action to dispatch\n   * @param debounceTime Time in ms to debounce (default: 100ms)\n   * @returns boolean indicating whether the action was dispatched or debounced\n   */\n  debouncedDispatch(t, e = 100) {\n    const i = Date.now(), s = this.debouncedActions[t.type] || 0;\n    return i - s >= e ? (this.debouncedActions[t.type] = i, this.dispatch(t), !0) : !1;\n  }\n  /**\n   * Subscribe to state changes\n   */\n  subscribe(t) {\n    return this.pluginStore.subscribeToState(t);\n  }\n  /**\n   * Subscribe to core store changes\n   */\n  subscribeToCoreStore(t) {\n    return this.coreStore.subscribe(t);\n  }\n  /**\n   * Called when the plugin store state is updated\n   * @param oldState Previous state\n   * @param newState New state\n   */\n  onStoreUpdated(t, e) {\n  }\n  /**\n   * Called when the core store state is updated\n   * @param oldState Previous state\n   * @param newState New state\n   */\n  onCoreStoreUpdated(t, e) {\n  }\n  /**\n   * Cleanup method to be called when plugin is being destroyed\n   */\n  destroy() {\n    this.unsubscribeFromState && (this.unsubscribeFromState(), this.unsubscribeFromState = null), this.unsubscribeFromCoreStore && (this.unsubscribeFromCoreStore(), this.unsubscribeFromCoreStore = null);\n  }\n  /**\n   * Returns a promise that resolves when the plugin is ready\n   */\n  ready() {\n    return this.readyPromise;\n  }\n  /**\n   * Mark the plugin as ready\n   */\n  markReady() {\n    this.readyResolve();\n  }\n  /**\n   * Reset the ready state (useful for plugins that need to reinitialize)\n   */\n  resetReady() {\n    this.readyPromise = new Promise((t) => {\n      this.readyResolve = t;\n    });\n  }\n}\nclass b {\n  constructor(t, e) {\n    this.handler = t, this.options = e, this.lastRun = 0, this.handle = (i) => {\n      this.options.mode === \"debounce\" ? this.debounce(i) : this.throttle(i);\n    };\n  }\n  debounce(t) {\n    this.timeoutId && window.clearTimeout(this.timeoutId), this.timeoutId = window.setTimeout(() => {\n      this.handler(t), this.timeoutId = void 0;\n    }, this.options.wait);\n  }\n  throttle(t) {\n    if (this.options.mode === \"debounce\") return;\n    const e = Date.now(), i = this.options.throttleMode || \"leading-trailing\";\n    e - this.lastRun >= this.options.wait && (i === \"leading-trailing\" && this.handler(t), this.lastRun = e), this.timeoutId && window.clearTimeout(this.timeoutId), this.timeoutId = window.setTimeout(\n      () => {\n        this.handler(t), this.lastRun = Date.now(), this.timeoutId = void 0;\n      },\n      this.options.wait - (e - this.lastRun)\n    );\n  }\n  destroy() {\n    this.timeoutId && window.clearTimeout(this.timeoutId);\n  }\n}\nfunction E() {\n  const o = /* @__PURE__ */ new Set();\n  return {\n    emit: (e = void 0) => o.forEach((i) => i(e)),\n    on: (e) => (o.add(e), () => o.delete(e)),\n    off: (e) => o.delete(e),\n    clear: () => o.clear()\n  };\n}\nfunction C(o, t = m) {\n  const e = /* @__PURE__ */ new Set(), i = /* @__PURE__ */ new Map();\n  let s = o;\n  const c = (r) => e.forEach((n) => n(r)), p = (r, n) => {\n    let a = r, d = () => {\n    };\n    if (n) {\n      const u = new b(r, n);\n      a = u.handle, d = () => u.destroy(), i.set(r, { wrapped: a, destroy: d });\n    }\n    return s !== void 0 && a(s), e.add(a), () => {\n      e.delete(a), d(), i.delete(r);\n    };\n  };\n  return {\n    /* emitter behaviour ---------------------------------------- */\n    get value() {\n      return s;\n    },\n    emit(r = void 0) {\n      (s === void 0 || !t(s, r)) && (s = r, c(r));\n    },\n    on: p,\n    off(r) {\n      const n = i.get(r);\n      n ? (e.delete(n.wrapped), n.destroy(), i.delete(r)) : e.delete(r);\n    },\n    clear() {\n      e.clear(), i.forEach((r) => r.destroy()), i.clear();\n    },\n    /* derived hook --------------------------------------------- */\n    select(r, n = m) {\n      return (a, d) => {\n        let u;\n        if (s !== void 0) {\n          const h = r(s);\n          u = h, a(h);\n        }\n        return p(\n          (h) => {\n            const l = r(h);\n            (u === void 0 || !n(u, l)) && (u = l, a(l));\n          },\n          d\n        );\n      };\n    }\n  };\n}\nfunction T(o) {\n  return Object.entries(o).map(([t, e]) => {\n    const i = Number(t);\n    return [Number.isFinite(i) && t.trim() !== \"\" ? i : t, e];\n  });\n}\nexport {\n  w as BasePlugin,\n  v as CORE_ACTION_TYPES,\n  D as CapabilityConflictError,\n  I as CapabilityNotFoundError,\n  F as CircularDependencyError,\n  _ as DependencyResolver,\n  b as EventControl,\n  O as LOAD_DOCUMENT,\n  A as PluginConfigurationError,\n  N as PluginInitializationError,\n  M as PluginNotFoundError,\n  U as PluginRegistrationError,\n  z as PluginRegistry,\n  x as SET_DOCUMENT,\n  L as SET_DOCUMENT_ERROR,\n  j as SET_PAGES,\n  q as SET_ROTATION,\n  B as SET_SCALE,\n  m as arePropsEqual,\n  K as clamp,\n  C as createBehaviorEmitter,\n  E as createEmitter,\n  y as createPluginRegistration,\n  T as enumEntries,\n  f as getPagesWithRotatedSize,\n  $ as initialCoreState,\n  k as loadDocument,\n  G as setDocument,\n  W as setDocumentError,\n  Y as setPages,\n  H as setRotation,\n  J as setScale\n};\n//# sourceMappingURL=index.js.map\n","// src/geometry.ts\nvar Rotation = /* @__PURE__ */ ((Rotation2) => {\n  Rotation2[Rotation2[\"Degree0\"] = 0] = \"Degree0\";\n  Rotation2[Rotation2[\"Degree90\"] = 1] = \"Degree90\";\n  Rotation2[Rotation2[\"Degree180\"] = 2] = \"Degree180\";\n  Rotation2[Rotation2[\"Degree270\"] = 3] = \"Degree270\";\n  return Rotation2;\n})(Rotation || {});\nfunction toIntPos(p) {\n  return { x: Math.floor(p.x), y: Math.floor(p.y) };\n}\nfunction toIntSize(s) {\n  return { width: Math.ceil(s.width), height: Math.ceil(s.height) };\n}\nfunction toIntRect(r) {\n  return {\n    origin: toIntPos(r.origin),\n    size: toIntSize(r.size)\n  };\n}\nfunction calculateDegree(rotation) {\n  switch (rotation) {\n    case 0 /* Degree0 */:\n      return 0;\n    case 1 /* Degree90 */:\n      return 90;\n    case 2 /* Degree180 */:\n      return 180;\n    case 3 /* Degree270 */:\n      return 270;\n  }\n}\nfunction calculateAngle(rotation) {\n  return calculateDegree(rotation) * Math.PI / 180;\n}\nfunction swap(size) {\n  const { width, height } = size;\n  return {\n    width: height,\n    height: width\n  };\n}\nfunction transformSize(size, rotation, scaleFactor) {\n  size = rotation % 2 === 0 ? size : swap(size);\n  return {\n    width: size.width * scaleFactor,\n    height: size.height * scaleFactor\n  };\n}\nfunction quadToRect(q) {\n  const xs = [q.p1.x, q.p2.x, q.p3.x, q.p4.x];\n  const ys = [q.p1.y, q.p2.y, q.p3.y, q.p4.y];\n  return {\n    origin: { x: Math.min(...xs), y: Math.min(...ys) },\n    size: {\n      width: Math.max(...xs) - Math.min(...xs),\n      height: Math.max(...ys) - Math.min(...ys)\n    }\n  };\n}\nfunction rectToQuad(r) {\n  return {\n    p1: { x: r.origin.x, y: r.origin.y },\n    p2: { x: r.origin.x + r.size.width, y: r.origin.y },\n    p3: { x: r.origin.x + r.size.width, y: r.origin.y + r.size.height },\n    p4: { x: r.origin.x, y: r.origin.y + r.size.height }\n  };\n}\nfunction rotatePosition(containerSize, position, rotation) {\n  let x = position.x;\n  let y = position.y;\n  switch (rotation) {\n    case 0 /* Degree0 */:\n      x = position.x;\n      y = position.y;\n      break;\n    case 1 /* Degree90 */:\n      x = containerSize.height - position.y;\n      y = position.x;\n      break;\n    case 2 /* Degree180 */:\n      x = containerSize.width - position.x;\n      y = containerSize.height - position.y;\n      break;\n    case 3 /* Degree270 */:\n      x = position.y;\n      y = containerSize.width - position.x;\n      break;\n  }\n  return {\n    x,\n    y\n  };\n}\nfunction scalePosition(position, scaleFactor) {\n  return {\n    x: position.x * scaleFactor,\n    y: position.y * scaleFactor\n  };\n}\nfunction transformPosition(containerSize, position, rotation, scaleFactor) {\n  return scalePosition(rotatePosition(containerSize, position, rotation), scaleFactor);\n}\nfunction restorePosition(containerSize, position, rotation, scaleFactor) {\n  return scalePosition(\n    rotatePosition(containerSize, position, (4 - rotation) % 4),\n    1 / scaleFactor\n  );\n}\nfunction rotateRect(containerSize, rect, rotation) {\n  let x = rect.origin.x;\n  let y = rect.origin.y;\n  let size = rect.size;\n  switch (rotation) {\n    case 0 /* Degree0 */:\n      break;\n    case 1 /* Degree90 */:\n      x = containerSize.height - rect.origin.y - rect.size.height;\n      y = rect.origin.x;\n      size = swap(rect.size);\n      break;\n    case 2 /* Degree180 */:\n      x = containerSize.width - rect.origin.x - rect.size.width;\n      y = containerSize.height - rect.origin.y - rect.size.height;\n      break;\n    case 3 /* Degree270 */:\n      x = rect.origin.y;\n      y = containerSize.width - rect.origin.x - rect.size.width;\n      size = swap(rect.size);\n      break;\n  }\n  return {\n    origin: {\n      x,\n      y\n    },\n    size: {\n      width: size.width,\n      height: size.height\n    }\n  };\n}\nfunction scaleRect(rect, scaleFactor) {\n  return {\n    origin: {\n      x: rect.origin.x * scaleFactor,\n      y: rect.origin.y * scaleFactor\n    },\n    size: {\n      width: rect.size.width * scaleFactor,\n      height: rect.size.height * scaleFactor\n    }\n  };\n}\nfunction transformRect(containerSize, rect, rotation, scaleFactor) {\n  return scaleRect(rotateRect(containerSize, rect, rotation), scaleFactor);\n}\nfunction restoreRect(containerSize, rect, rotation, scaleFactor) {\n  return scaleRect(rotateRect(containerSize, rect, (4 - rotation) % 4), 1 / scaleFactor);\n}\nfunction restoreOffset(offset, rotation, scaleFactor) {\n  let offsetX = offset.x;\n  let offsetY = offset.y;\n  switch (rotation) {\n    case 0 /* Degree0 */:\n      offsetX = offset.x / scaleFactor;\n      offsetY = offset.y / scaleFactor;\n      break;\n    case 1 /* Degree90 */:\n      offsetX = offset.y / scaleFactor;\n      offsetY = -offset.x / scaleFactor;\n      break;\n    case 2 /* Degree180 */:\n      offsetX = -offset.x / scaleFactor;\n      offsetY = -offset.y / scaleFactor;\n      break;\n    case 3 /* Degree270 */:\n      offsetX = -offset.y / scaleFactor;\n      offsetY = offset.x / scaleFactor;\n      break;\n  }\n  return {\n    x: offsetX,\n    y: offsetY\n  };\n}\nfunction boundingRect(rects) {\n  if (rects.length === 0) return null;\n  let minX = rects[0].origin.x, minY = rects[0].origin.y, maxX = rects[0].origin.x + rects[0].size.width, maxY = rects[0].origin.y + rects[0].size.height;\n  for (const r of rects) {\n    minX = Math.min(minX, r.origin.x);\n    minY = Math.min(minY, r.origin.y);\n    maxX = Math.max(maxX, r.origin.x + r.size.width);\n    maxY = Math.max(maxY, r.origin.y + r.size.height);\n  }\n  return {\n    origin: {\n      x: minX,\n      y: minY\n    },\n    size: {\n      width: maxX - minX,\n      height: maxY - minY\n    }\n  };\n}\nvar makeMatrix = (rectangle, rotation, scaleFactor) => {\n  const { width, height } = rectangle.size;\n  switch (rotation) {\n    case 0 /* Degree0 */:\n      return {\n        a: scaleFactor,\n        b: 0,\n        c: 0,\n        d: -scaleFactor,\n        e: 0,\n        f: height * scaleFactor\n      };\n    case 1 /* Degree90 */:\n      return {\n        a: 0,\n        b: scaleFactor,\n        c: scaleFactor,\n        d: 0,\n        e: 0,\n        f: 0\n      };\n    case 2 /* Degree180 */:\n      return {\n        a: -scaleFactor,\n        b: 0,\n        c: 0,\n        d: scaleFactor,\n        e: width * scaleFactor,\n        f: 0\n      };\n    case 3 /* Degree270 */:\n      return {\n        a: 0,\n        b: -scaleFactor,\n        c: -scaleFactor,\n        d: 0,\n        e: height * scaleFactor,\n        f: width * scaleFactor\n      };\n  }\n};\n\n// src/logger.ts\nvar NoopLogger = class {\n  /** {@inheritDoc Logger.debug} */\n  debug() {\n  }\n  /** {@inheritDoc Logger.info} */\n  info() {\n  }\n  /** {@inheritDoc Logger.warn} */\n  warn() {\n  }\n  /** {@inheritDoc Logger.error} */\n  error() {\n  }\n  /** {@inheritDoc Logger.perf} */\n  perf() {\n  }\n};\nvar ConsoleLogger = class {\n  /** {@inheritDoc Logger.debug} */\n  debug(source, category, ...args) {\n    console.debug(`${source}.${category}`, ...args);\n  }\n  /** {@inheritDoc Logger.info} */\n  info(source, category, ...args) {\n    console.info(`${source}.${category}`, ...args);\n  }\n  /** {@inheritDoc Logger.warn} */\n  warn(source, category, ...args) {\n    console.warn(`${source}.${category}`, ...args);\n  }\n  /** {@inheritDoc Logger.error} */\n  error(source, category, ...args) {\n    console.error(`${source}.${category}`, ...args);\n  }\n  /** {@inheritDoc Logger.perf} */\n  perf(source, category, event, phase, ...args) {\n    console.info(`${source}.${category}.${event}.${phase}`, ...args);\n  }\n};\nvar LogLevel = /* @__PURE__ */ ((LogLevel2) => {\n  LogLevel2[LogLevel2[\"Debug\"] = 0] = \"Debug\";\n  LogLevel2[LogLevel2[\"Info\"] = 1] = \"Info\";\n  LogLevel2[LogLevel2[\"Warn\"] = 2] = \"Warn\";\n  LogLevel2[LogLevel2[\"Error\"] = 3] = \"Error\";\n  return LogLevel2;\n})(LogLevel || {});\nvar LevelLogger = class {\n  /**\n   * create new LevelLogger\n   * @param logger - the original logger\n   * @param level - log level that used for filtering, all logs lower than this level will be filtered out\n   */\n  constructor(logger, level) {\n    this.logger = logger;\n    this.level = level;\n  }\n  /** {@inheritDoc Logger.debug} */\n  debug(source, category, ...args) {\n    if (this.level <= 0 /* Debug */) {\n      this.logger.debug(source, category, ...args);\n    }\n  }\n  /** {@inheritDoc Logger.info} */\n  info(source, category, ...args) {\n    if (this.level <= 1 /* Info */) {\n      this.logger.info(source, category, ...args);\n    }\n  }\n  /** {@inheritDoc Logger.warn} */\n  warn(source, category, ...args) {\n    if (this.level <= 2 /* Warn */) {\n      this.logger.warn(source, category, ...args);\n    }\n  }\n  /** {@inheritDoc Logger.error} */\n  error(source, category, ...args) {\n    if (this.level <= 3 /* Error */) {\n      this.logger.error(source, category, ...args);\n    }\n  }\n  /** {@inheritDoc Logger.perf} */\n  perf(source, category, event, phase, ...args) {\n    this.logger.perf(source, category, event, phase, ...args);\n  }\n};\nvar PerfLogger = class {\n  /**\n   * create new PerfLogger\n   */\n  constructor() {\n  }\n  /** {@inheritDoc Logger.debug} */\n  debug(source, category, ...args) {\n  }\n  /** {@inheritDoc Logger.info} */\n  info(source, category, ...args) {\n  }\n  /** {@inheritDoc Logger.warn} */\n  warn(source, category, ...args) {\n  }\n  /** {@inheritDoc Logger.error} */\n  error(source, category, ...args) {\n  }\n  /** {@inheritDoc Logger.perf} */\n  perf(source, category, event, phase, identifier, ...args) {\n    switch (phase) {\n      case \"Begin\":\n        window.performance.mark(`${source}.${category}.${event}.${phase}.${identifier}`, {\n          detail: args\n        });\n        break;\n      case \"End\":\n        window.performance.mark(`${source}.${category}.${event}.${phase}.${identifier}`, {\n          detail: args\n        });\n        window.performance.measure(\n          `${source}.${category}.${event}.Measure.${identifier}`,\n          `${source}.${category}.${event}.Begin.${identifier}`,\n          `${source}.${category}.${event}.End.${identifier}`\n        );\n        break;\n    }\n  }\n};\nvar AllLogger = class {\n  /**\n   * create new PerfLogger\n   */\n  constructor(loggers) {\n    this.loggers = loggers;\n  }\n  /** {@inheritDoc Logger.debug} */\n  debug(source, category, ...args) {\n    for (const logger of this.loggers) {\n      logger.debug(source, category, ...args);\n    }\n  }\n  /** {@inheritDoc Logger.info} */\n  info(source, category, ...args) {\n    for (const logger of this.loggers) {\n      logger.info(source, category, ...args);\n    }\n  }\n  /** {@inheritDoc Logger.warn} */\n  warn(source, category, ...args) {\n    for (const logger of this.loggers) {\n      logger.warn(source, category, ...args);\n    }\n  }\n  /** {@inheritDoc Logger.error} */\n  error(source, category, ...args) {\n    for (const logger of this.loggers) {\n      logger.error(source, category, ...args);\n    }\n  }\n  /** {@inheritDoc Logger.perf} */\n  perf(source, category, event, phase, ...args) {\n    for (const logger of this.loggers) {\n      logger.perf(source, category, event, phase, ...args);\n    }\n  }\n};\n\n// src/task.ts\nvar TaskStage = /* @__PURE__ */ ((TaskStage2) => {\n  TaskStage2[TaskStage2[\"Pending\"] = 0] = \"Pending\";\n  TaskStage2[TaskStage2[\"Resolved\"] = 1] = \"Resolved\";\n  TaskStage2[TaskStage2[\"Rejected\"] = 2] = \"Rejected\";\n  TaskStage2[TaskStage2[\"Aborted\"] = 3] = \"Aborted\";\n  return TaskStage2;\n})(TaskStage || {});\nvar TaskAbortedError = class extends Error {\n  constructor(reason) {\n    super(`Task aborted: ${JSON.stringify(reason)}`);\n    this.name = \"TaskAbortedError\";\n  }\n};\nvar TaskRejectedError = class extends Error {\n  constructor(reason) {\n    super(`Task rejected: ${JSON.stringify(reason)}`);\n    this.name = \"TaskRejectedError\";\n  }\n};\nvar Task = class _Task {\n  constructor() {\n    this.state = {\n      stage: 0 /* Pending */\n    };\n    /**\n     * callbacks that will be executed when task is resolved\n     */\n    this.resolvedCallbacks = [];\n    /**\n     * callbacks that will be executed when task is rejected\n     */\n    this.rejectedCallbacks = [];\n    /**\n     * Promise that will be resolved when task is settled\n     */\n    this._promise = null;\n  }\n  /**\n   * Convert task to promise\n   * @returns promise that will be resolved when task is settled\n   */\n  toPromise() {\n    if (!this._promise) {\n      this._promise = new Promise((resolve, reject) => {\n        this.wait(\n          (result) => resolve(result),\n          (error) => {\n            if (error.type === \"abort\") {\n              reject(new TaskAbortedError(error.reason));\n            } else {\n              reject(new TaskRejectedError(error.reason));\n            }\n          }\n        );\n      });\n    }\n    return this._promise;\n  }\n  /**\n   * wait for task to be settled\n   * @param resolvedCallback - callback for resolved value\n   * @param rejectedCallback - callback for rejected value\n   */\n  wait(resolvedCallback, rejectedCallback) {\n    switch (this.state.stage) {\n      case 0 /* Pending */:\n        this.resolvedCallbacks.push(resolvedCallback);\n        this.rejectedCallbacks.push(rejectedCallback);\n        break;\n      case 1 /* Resolved */:\n        resolvedCallback(this.state.result);\n        break;\n      case 2 /* Rejected */:\n        rejectedCallback({\n          type: \"reject\",\n          reason: this.state.reason\n        });\n        break;\n      case 3 /* Aborted */:\n        rejectedCallback({\n          type: \"abort\",\n          reason: this.state.reason\n        });\n        break;\n    }\n  }\n  /**\n   * resolve task with specific result\n   * @param result - result value\n   */\n  resolve(result) {\n    if (this.state.stage === 0 /* Pending */) {\n      this.state = {\n        stage: 1 /* Resolved */,\n        result\n      };\n      for (const resolvedCallback of this.resolvedCallbacks) {\n        try {\n          resolvedCallback(result);\n        } catch (e) {\n        }\n      }\n      this.resolvedCallbacks = [];\n      this.rejectedCallbacks = [];\n    }\n  }\n  /**\n   * reject task with specific reason\n   * @param reason - abort reason\n   *\n   */\n  reject(reason) {\n    if (this.state.stage === 0 /* Pending */) {\n      this.state = {\n        stage: 2 /* Rejected */,\n        reason\n      };\n      for (const rejectedCallback of this.rejectedCallbacks) {\n        try {\n          rejectedCallback({\n            type: \"reject\",\n            reason\n          });\n        } catch (e) {\n        }\n      }\n      this.resolvedCallbacks = [];\n      this.rejectedCallbacks = [];\n    }\n  }\n  /**\n   * abort task with specific reason\n   * @param reason - abort reason\n   */\n  abort(reason) {\n    if (this.state.stage === 0 /* Pending */) {\n      this.state = {\n        stage: 3 /* Aborted */,\n        reason\n      };\n      for (const rejectedCallback of this.rejectedCallbacks) {\n        try {\n          rejectedCallback({\n            type: \"abort\",\n            reason\n          });\n        } catch (e) {\n        }\n      }\n      this.resolvedCallbacks = [];\n      this.rejectedCallbacks = [];\n    }\n  }\n  /**\n   * fail task with a TaskError from another task\n   * This is a convenience method for error propagation between tasks\n   * @param error - TaskError from another task\n   */\n  fail(error) {\n    if (error.type === \"abort\") {\n      this.abort(error.reason);\n    } else {\n      this.reject(error.reason);\n    }\n  }\n  /**\n   * Static method to wait for all tasks to resolve\n   * Returns a new task that resolves with an array of all results\n   * Rejects immediately if any task fails\n   *\n   * @param tasks - array of tasks to wait for\n   * @returns new task that resolves when all input tasks resolve\n   * @public\n   */\n  static all(tasks) {\n    const combinedTask = new _Task();\n    if (tasks.length === 0) {\n      combinedTask.resolve([]);\n      return combinedTask;\n    }\n    const results = new Array(tasks.length);\n    let resolvedCount = 0;\n    let isSettled = false;\n    tasks.forEach((task, index) => {\n      task.wait(\n        (result) => {\n          if (isSettled) return;\n          results[index] = result;\n          resolvedCount++;\n          if (resolvedCount === tasks.length) {\n            isSettled = true;\n            combinedTask.resolve(results);\n          }\n        },\n        (error) => {\n          if (isSettled) return;\n          isSettled = true;\n          if (error.type === \"abort\") {\n            combinedTask.abort(error.reason);\n          } else {\n            combinedTask.reject(error.reason);\n          }\n        }\n      );\n    });\n    return combinedTask;\n  }\n  /**\n   * Static method to wait for all tasks to settle (resolve, reject, or abort)\n   * Always resolves with an array of settlement results\n   *\n   * @param tasks - array of tasks to wait for\n   * @returns new task that resolves when all input tasks settle\n   * @public\n   */\n  static allSettled(tasks) {\n    const combinedTask = new _Task();\n    if (tasks.length === 0) {\n      combinedTask.resolve([]);\n      return combinedTask;\n    }\n    const results = new Array(tasks.length);\n    let settledCount = 0;\n    tasks.forEach((task, index) => {\n      task.wait(\n        (result) => {\n          results[index] = { status: \"resolved\", value: result };\n          settledCount++;\n          if (settledCount === tasks.length) {\n            combinedTask.resolve(results);\n          }\n        },\n        (error) => {\n          results[index] = {\n            status: error.type === \"abort\" ? \"aborted\" : \"rejected\",\n            reason: error.reason\n          };\n          settledCount++;\n          if (settledCount === tasks.length) {\n            combinedTask.resolve(results);\n          }\n        }\n      );\n    });\n    return combinedTask;\n  }\n  /**\n   * Static method that resolves/rejects with the first task that settles\n   *\n   * @param tasks - array of tasks to race\n   * @returns new task that settles with the first input task that settles\n   * @public\n   */\n  static race(tasks) {\n    const combinedTask = new _Task();\n    if (tasks.length === 0) {\n      combinedTask.reject(\"No tasks provided\");\n      return combinedTask;\n    }\n    let isSettled = false;\n    tasks.forEach((task) => {\n      task.wait(\n        (result) => {\n          if (isSettled) return;\n          isSettled = true;\n          combinedTask.resolve(result);\n        },\n        (error) => {\n          if (isSettled) return;\n          isSettled = true;\n          if (error.type === \"abort\") {\n            combinedTask.abort(error.reason);\n          } else {\n            combinedTask.reject(error.reason);\n          }\n        }\n      );\n    });\n    return combinedTask;\n  }\n  /**\n   * Utility to track progress of multiple tasks\n   *\n   * @param tasks - array of tasks to track\n   * @param onProgress - callback called when any task completes\n   * @returns new task that resolves when all input tasks resolve\n   * @public\n   */\n  static withProgress(tasks, onProgress) {\n    const combinedTask = _Task.all(tasks);\n    if (onProgress) {\n      let completedCount = 0;\n      tasks.forEach((task) => {\n        task.wait(\n          () => {\n            completedCount++;\n            onProgress(completedCount, tasks.length);\n          },\n          () => {\n            completedCount++;\n            onProgress(completedCount, tasks.length);\n          }\n        );\n      });\n    }\n    return combinedTask;\n  }\n};\n\n// src/pdf.ts\nvar PdfSoftHyphenMarker = \"\\xAD\";\nvar PdfZeroWidthSpace = \"\\u200B\";\nvar PdfWordJoiner = \"\\u2060\";\nvar PdfBomOrZwnbsp = \"\\uFEFF\";\nvar PdfNonCharacterFFFE = \"\\uFFFE\";\nvar PdfNonCharacterFFFF = \"\\uFFFF\";\nvar PdfUnwantedTextMarkers = Object.freeze([\n  PdfSoftHyphenMarker,\n  PdfZeroWidthSpace,\n  PdfWordJoiner,\n  PdfBomOrZwnbsp,\n  PdfNonCharacterFFFE,\n  PdfNonCharacterFFFF\n]);\nvar PdfUnwantedTextRegex = new RegExp(`[${PdfUnwantedTextMarkers.join(\"\")}]`, \"g\");\nfunction stripPdfUnwantedMarkers(text) {\n  return text.replace(PdfUnwantedTextRegex, \"\");\n}\nvar PdfZoomMode = /* @__PURE__ */ ((PdfZoomMode2) => {\n  PdfZoomMode2[PdfZoomMode2[\"Unknown\"] = 0] = \"Unknown\";\n  PdfZoomMode2[PdfZoomMode2[\"XYZ\"] = 1] = \"XYZ\";\n  PdfZoomMode2[PdfZoomMode2[\"FitPage\"] = 2] = \"FitPage\";\n  PdfZoomMode2[PdfZoomMode2[\"FitHorizontal\"] = 3] = \"FitHorizontal\";\n  PdfZoomMode2[PdfZoomMode2[\"FitVertical\"] = 4] = \"FitVertical\";\n  PdfZoomMode2[PdfZoomMode2[\"FitRectangle\"] = 5] = \"FitRectangle\";\n  return PdfZoomMode2;\n})(PdfZoomMode || {});\nvar PdfBlendMode = /* @__PURE__ */ ((PdfBlendMode2) => {\n  PdfBlendMode2[PdfBlendMode2[\"Normal\"] = 0] = \"Normal\";\n  PdfBlendMode2[PdfBlendMode2[\"Multiply\"] = 1] = \"Multiply\";\n  PdfBlendMode2[PdfBlendMode2[\"Screen\"] = 2] = \"Screen\";\n  PdfBlendMode2[PdfBlendMode2[\"Overlay\"] = 3] = \"Overlay\";\n  PdfBlendMode2[PdfBlendMode2[\"Darken\"] = 4] = \"Darken\";\n  PdfBlendMode2[PdfBlendMode2[\"Lighten\"] = 5] = \"Lighten\";\n  PdfBlendMode2[PdfBlendMode2[\"ColorDodge\"] = 6] = \"ColorDodge\";\n  PdfBlendMode2[PdfBlendMode2[\"ColorBurn\"] = 7] = \"ColorBurn\";\n  PdfBlendMode2[PdfBlendMode2[\"HardLight\"] = 8] = \"HardLight\";\n  PdfBlendMode2[PdfBlendMode2[\"SoftLight\"] = 9] = \"SoftLight\";\n  PdfBlendMode2[PdfBlendMode2[\"Difference\"] = 10] = \"Difference\";\n  PdfBlendMode2[PdfBlendMode2[\"Exclusion\"] = 11] = \"Exclusion\";\n  PdfBlendMode2[PdfBlendMode2[\"Hue\"] = 12] = \"Hue\";\n  PdfBlendMode2[PdfBlendMode2[\"Saturation\"] = 13] = \"Saturation\";\n  PdfBlendMode2[PdfBlendMode2[\"Color\"] = 14] = \"Color\";\n  PdfBlendMode2[PdfBlendMode2[\"Luminosity\"] = 15] = \"Luminosity\";\n  return PdfBlendMode2;\n})(PdfBlendMode || {});\nvar MixedBlendMode = Symbol(\"mixed\");\nvar BLEND_MODE_INFOS = Object.freeze([\n  { id: 0 /* Normal */, label: \"Normal\", css: \"normal\" },\n  { id: 1 /* Multiply */, label: \"Multiply\", css: \"multiply\" },\n  { id: 2 /* Screen */, label: \"Screen\", css: \"screen\" },\n  { id: 3 /* Overlay */, label: \"Overlay\", css: \"overlay\" },\n  { id: 4 /* Darken */, label: \"Darken\", css: \"darken\" },\n  { id: 5 /* Lighten */, label: \"Lighten\", css: \"lighten\" },\n  { id: 6 /* ColorDodge */, label: \"Color Dodge\", css: \"color-dodge\" },\n  { id: 7 /* ColorBurn */, label: \"Color Burn\", css: \"color-burn\" },\n  { id: 8 /* HardLight */, label: \"Hard Light\", css: \"hard-light\" },\n  { id: 9 /* SoftLight */, label: \"Soft Light\", css: \"soft-light\" },\n  { id: 10 /* Difference */, label: \"Difference\", css: \"difference\" },\n  { id: 11 /* Exclusion */, label: \"Exclusion\", css: \"exclusion\" },\n  { id: 12 /* Hue */, label: \"Hue\", css: \"hue\" },\n  { id: 13 /* Saturation */, label: \"Saturation\", css: \"saturation\" },\n  { id: 14 /* Color */, label: \"Color\", css: \"color\" },\n  { id: 15 /* Luminosity */, label: \"Luminosity\", css: \"luminosity\" }\n]);\nvar enumToInfo = BLEND_MODE_INFOS.reduce(\n  (m, info) => {\n    m[info.id] = info;\n    return m;\n  },\n  {}\n);\nvar cssToEnum = BLEND_MODE_INFOS.reduce((m, info) => {\n  m[info.css] = info.id;\n  return m;\n}, {});\nfunction getBlendModeInfo(mode) {\n  return enumToInfo[mode] ?? enumToInfo[0 /* Normal */];\n}\nfunction blendModeToCss(mode) {\n  return getBlendModeInfo(mode).css;\n}\nfunction cssToBlendMode(value) {\n  return cssToEnum[value];\n}\nfunction blendModeLabel(mode) {\n  return getBlendModeInfo(mode).label;\n}\nfunction reduceBlendModes(modes) {\n  if (!modes.length) return 0 /* Normal */;\n  const first = modes[0];\n  return modes.every((m) => m === first) ? first : MixedBlendMode;\n}\nvar blendModeSelectOptions = BLEND_MODE_INFOS.map((info) => ({\n  value: info.id,\n  label: info.label\n}));\nfunction uiBlendModeDisplay(value) {\n  return value === MixedBlendMode ? \"(mixed)\" : blendModeLabel(value);\n}\nvar PdfActionType = /* @__PURE__ */ ((PdfActionType2) => {\n  PdfActionType2[PdfActionType2[\"Unsupported\"] = 0] = \"Unsupported\";\n  PdfActionType2[PdfActionType2[\"Goto\"] = 1] = \"Goto\";\n  PdfActionType2[PdfActionType2[\"RemoteGoto\"] = 2] = \"RemoteGoto\";\n  PdfActionType2[PdfActionType2[\"URI\"] = 3] = \"URI\";\n  PdfActionType2[PdfActionType2[\"LaunchAppOrOpenFile\"] = 4] = \"LaunchAppOrOpenFile\";\n  return PdfActionType2;\n})(PdfActionType || {});\nvar PdfAnnotationSubtype = /* @__PURE__ */ ((PdfAnnotationSubtype2) => {\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"UNKNOWN\"] = 0] = \"UNKNOWN\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"TEXT\"] = 1] = \"TEXT\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"LINK\"] = 2] = \"LINK\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"FREETEXT\"] = 3] = \"FREETEXT\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"LINE\"] = 4] = \"LINE\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"SQUARE\"] = 5] = \"SQUARE\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"CIRCLE\"] = 6] = \"CIRCLE\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"POLYGON\"] = 7] = \"POLYGON\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"POLYLINE\"] = 8] = \"POLYLINE\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"HIGHLIGHT\"] = 9] = \"HIGHLIGHT\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"UNDERLINE\"] = 10] = \"UNDERLINE\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"SQUIGGLY\"] = 11] = \"SQUIGGLY\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"STRIKEOUT\"] = 12] = \"STRIKEOUT\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"STAMP\"] = 13] = \"STAMP\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"CARET\"] = 14] = \"CARET\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"INK\"] = 15] = \"INK\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"POPUP\"] = 16] = \"POPUP\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"FILEATTACHMENT\"] = 17] = \"FILEATTACHMENT\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"SOUND\"] = 18] = \"SOUND\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"MOVIE\"] = 19] = \"MOVIE\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"WIDGET\"] = 20] = \"WIDGET\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"SCREEN\"] = 21] = \"SCREEN\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"PRINTERMARK\"] = 22] = \"PRINTERMARK\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"TRAPNET\"] = 23] = \"TRAPNET\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"WATERMARK\"] = 24] = \"WATERMARK\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"THREED\"] = 25] = \"THREED\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"RICHMEDIA\"] = 26] = \"RICHMEDIA\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"XFAWIDGET\"] = 27] = \"XFAWIDGET\";\n  PdfAnnotationSubtype2[PdfAnnotationSubtype2[\"REDACT\"] = 28] = \"REDACT\";\n  return PdfAnnotationSubtype2;\n})(PdfAnnotationSubtype || {});\nvar PdfAnnotationSubtypeName = {\n  [0 /* UNKNOWN */]: \"unknow\",\n  [1 /* TEXT */]: \"text\",\n  [2 /* LINK */]: \"link\",\n  [3 /* FREETEXT */]: \"freetext\",\n  [4 /* LINE */]: \"line\",\n  [5 /* SQUARE */]: \"square\",\n  [6 /* CIRCLE */]: \"circle\",\n  [7 /* POLYGON */]: \"polygon\",\n  [8 /* POLYLINE */]: \"polyline\",\n  [9 /* HIGHLIGHT */]: \"highlight\",\n  [10 /* UNDERLINE */]: \"underline\",\n  [11 /* SQUIGGLY */]: \"squiggly\",\n  [12 /* STRIKEOUT */]: \"strikeout\",\n  [13 /* STAMP */]: \"stamp\",\n  [14 /* CARET */]: \"caret\",\n  [15 /* INK */]: \"ink\",\n  [16 /* POPUP */]: \"popup\",\n  [17 /* FILEATTACHMENT */]: \"fileattachment\",\n  [18 /* SOUND */]: \"sound\",\n  [19 /* MOVIE */]: \"movie\",\n  [20 /* WIDGET */]: \"widget\",\n  [21 /* SCREEN */]: \"screen\",\n  [22 /* PRINTERMARK */]: \"printermark\",\n  [23 /* TRAPNET */]: \"trapnet\",\n  [24 /* WATERMARK */]: \"watermark\",\n  [25 /* THREED */]: \"threed\",\n  [26 /* RICHMEDIA */]: \"richmedia\",\n  [27 /* XFAWIDGET */]: \"xfawidget\",\n  [28 /* REDACT */]: \"redact\"\n};\nvar PdfAnnotationObjectStatus = /* @__PURE__ */ ((PdfAnnotationObjectStatus2) => {\n  PdfAnnotationObjectStatus2[PdfAnnotationObjectStatus2[\"Created\"] = 0] = \"Created\";\n  PdfAnnotationObjectStatus2[PdfAnnotationObjectStatus2[\"Committed\"] = 1] = \"Committed\";\n  return PdfAnnotationObjectStatus2;\n})(PdfAnnotationObjectStatus || {});\nvar AppearanceMode = /* @__PURE__ */ ((AppearanceMode2) => {\n  AppearanceMode2[AppearanceMode2[\"Normal\"] = 0] = \"Normal\";\n  AppearanceMode2[AppearanceMode2[\"Rollover\"] = 1] = \"Rollover\";\n  AppearanceMode2[AppearanceMode2[\"Down\"] = 2] = \"Down\";\n  return AppearanceMode2;\n})(AppearanceMode || {});\nvar PdfAnnotationState = /* @__PURE__ */ ((PdfAnnotationState2) => {\n  PdfAnnotationState2[\"Marked\"] = \"Marked\";\n  PdfAnnotationState2[\"Unmarked\"] = \"Unmarked\";\n  PdfAnnotationState2[\"Accepted\"] = \"Accepted\";\n  PdfAnnotationState2[\"Rejected\"] = \"Rejected\";\n  PdfAnnotationState2[\"Complete\"] = \"Complete\";\n  PdfAnnotationState2[\"Cancelled\"] = \"Cancelled\";\n  PdfAnnotationState2[\"None\"] = \"None\";\n  return PdfAnnotationState2;\n})(PdfAnnotationState || {});\nvar PdfAnnotationStateModel = /* @__PURE__ */ ((PdfAnnotationStateModel2) => {\n  PdfAnnotationStateModel2[\"Marked\"] = \"Marked\";\n  PdfAnnotationStateModel2[\"Reviewed\"] = \"Reviewed\";\n  return PdfAnnotationStateModel2;\n})(PdfAnnotationStateModel || {});\nvar PDF_FORM_FIELD_TYPE = /* @__PURE__ */ ((PDF_FORM_FIELD_TYPE2) => {\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"UNKNOWN\"] = 0] = \"UNKNOWN\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"PUSHBUTTON\"] = 1] = \"PUSHBUTTON\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"CHECKBOX\"] = 2] = \"CHECKBOX\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"RADIOBUTTON\"] = 3] = \"RADIOBUTTON\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"COMBOBOX\"] = 4] = \"COMBOBOX\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"LISTBOX\"] = 5] = \"LISTBOX\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"TEXTFIELD\"] = 6] = \"TEXTFIELD\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"SIGNATURE\"] = 7] = \"SIGNATURE\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"XFA\"] = 8] = \"XFA\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"XFA_CHECKBOX\"] = 9] = \"XFA_CHECKBOX\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"XFA_COMBOBOX\"] = 10] = \"XFA_COMBOBOX\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"XFA_IMAGEFIELD\"] = 11] = \"XFA_IMAGEFIELD\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"XFA_LISTBOX\"] = 12] = \"XFA_LISTBOX\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"XFA_PUSHBUTTON\"] = 13] = \"XFA_PUSHBUTTON\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"XFA_SIGNATURE\"] = 14] = \"XFA_SIGNATURE\";\n  PDF_FORM_FIELD_TYPE2[PDF_FORM_FIELD_TYPE2[\"XFA_TEXTFIELD\"] = 15] = \"XFA_TEXTFIELD\";\n  return PDF_FORM_FIELD_TYPE2;\n})(PDF_FORM_FIELD_TYPE || {});\nvar PdfAnnotationColorType = /* @__PURE__ */ ((PdfAnnotationColorType2) => {\n  PdfAnnotationColorType2[PdfAnnotationColorType2[\"Color\"] = 0] = \"Color\";\n  PdfAnnotationColorType2[PdfAnnotationColorType2[\"InteriorColor\"] = 1] = \"InteriorColor\";\n  return PdfAnnotationColorType2;\n})(PdfAnnotationColorType || {});\nvar PdfAnnotationBorderStyle = /* @__PURE__ */ ((PdfAnnotationBorderStyle2) => {\n  PdfAnnotationBorderStyle2[PdfAnnotationBorderStyle2[\"UNKNOWN\"] = 0] = \"UNKNOWN\";\n  PdfAnnotationBorderStyle2[PdfAnnotationBorderStyle2[\"SOLID\"] = 1] = \"SOLID\";\n  PdfAnnotationBorderStyle2[PdfAnnotationBorderStyle2[\"DASHED\"] = 2] = \"DASHED\";\n  PdfAnnotationBorderStyle2[PdfAnnotationBorderStyle2[\"BEVELED\"] = 3] = \"BEVELED\";\n  PdfAnnotationBorderStyle2[PdfAnnotationBorderStyle2[\"INSET\"] = 4] = \"INSET\";\n  PdfAnnotationBorderStyle2[PdfAnnotationBorderStyle2[\"UNDERLINE\"] = 5] = \"UNDERLINE\";\n  PdfAnnotationBorderStyle2[PdfAnnotationBorderStyle2[\"CLOUDY\"] = 6] = \"CLOUDY\";\n  return PdfAnnotationBorderStyle2;\n})(PdfAnnotationBorderStyle || {});\nvar PdfAnnotationFlags = /* @__PURE__ */ ((PdfAnnotationFlags2) => {\n  PdfAnnotationFlags2[PdfAnnotationFlags2[\"NONE\"] = 0] = \"NONE\";\n  PdfAnnotationFlags2[PdfAnnotationFlags2[\"INVISIBLE\"] = 1] = \"INVISIBLE\";\n  PdfAnnotationFlags2[PdfAnnotationFlags2[\"HIDDEN\"] = 2] = \"HIDDEN\";\n  PdfAnnotationFlags2[PdfAnnotationFlags2[\"PRINT\"] = 4] = \"PRINT\";\n  PdfAnnotationFlags2[PdfAnnotationFlags2[\"NO_ZOOM\"] = 8] = \"NO_ZOOM\";\n  PdfAnnotationFlags2[PdfAnnotationFlags2[\"NO_ROTATE\"] = 16] = \"NO_ROTATE\";\n  PdfAnnotationFlags2[PdfAnnotationFlags2[\"NO_VIEW\"] = 32] = \"NO_VIEW\";\n  PdfAnnotationFlags2[PdfAnnotationFlags2[\"READ_ONLY\"] = 64] = \"READ_ONLY\";\n  PdfAnnotationFlags2[PdfAnnotationFlags2[\"LOCKED\"] = 128] = \"LOCKED\";\n  PdfAnnotationFlags2[PdfAnnotationFlags2[\"TOGGLE_NOVIEW\"] = 256] = \"TOGGLE_NOVIEW\";\n  return PdfAnnotationFlags2;\n})(PdfAnnotationFlags || {});\nvar PDF_FORM_FIELD_FLAG = /* @__PURE__ */ ((PDF_FORM_FIELD_FLAG2) => {\n  PDF_FORM_FIELD_FLAG2[PDF_FORM_FIELD_FLAG2[\"NONE\"] = 0] = \"NONE\";\n  PDF_FORM_FIELD_FLAG2[PDF_FORM_FIELD_FLAG2[\"READONLY\"] = 1] = \"READONLY\";\n  PDF_FORM_FIELD_FLAG2[PDF_FORM_FIELD_FLAG2[\"REQUIRED\"] = 2] = \"REQUIRED\";\n  PDF_FORM_FIELD_FLAG2[PDF_FORM_FIELD_FLAG2[\"NOEXPORT\"] = 4] = \"NOEXPORT\";\n  PDF_FORM_FIELD_FLAG2[PDF_FORM_FIELD_FLAG2[\"TEXT_MULTIPLINE\"] = 4096] = \"TEXT_MULTIPLINE\";\n  PDF_FORM_FIELD_FLAG2[PDF_FORM_FIELD_FLAG2[\"TEXT_PASSWORD\"] = 8192] = \"TEXT_PASSWORD\";\n  PDF_FORM_FIELD_FLAG2[PDF_FORM_FIELD_FLAG2[\"CHOICE_COMBO\"] = 131072] = \"CHOICE_COMBO\";\n  PDF_FORM_FIELD_FLAG2[PDF_FORM_FIELD_FLAG2[\"CHOICE_EDIT\"] = 262144] = \"CHOICE_EDIT\";\n  PDF_FORM_FIELD_FLAG2[PDF_FORM_FIELD_FLAG2[\"CHOICE_MULTL_SELECT\"] = 2097152] = \"CHOICE_MULTL_SELECT\";\n  return PDF_FORM_FIELD_FLAG2;\n})(PDF_FORM_FIELD_FLAG || {});\nvar PdfPageObjectType = /* @__PURE__ */ ((PdfPageObjectType2) => {\n  PdfPageObjectType2[PdfPageObjectType2[\"UNKNOWN\"] = 0] = \"UNKNOWN\";\n  PdfPageObjectType2[PdfPageObjectType2[\"TEXT\"] = 1] = \"TEXT\";\n  PdfPageObjectType2[PdfPageObjectType2[\"PATH\"] = 2] = \"PATH\";\n  PdfPageObjectType2[PdfPageObjectType2[\"IMAGE\"] = 3] = \"IMAGE\";\n  PdfPageObjectType2[PdfPageObjectType2[\"SHADING\"] = 4] = \"SHADING\";\n  PdfPageObjectType2[PdfPageObjectType2[\"FORM\"] = 5] = \"FORM\";\n  return PdfPageObjectType2;\n})(PdfPageObjectType || {});\nvar PdfAnnotationFlagName = Object.freeze({\n  [1 /* INVISIBLE */]: \"invisible\",\n  [2 /* HIDDEN */]: \"hidden\",\n  [4 /* PRINT */]: \"print\",\n  [8 /* NO_ZOOM */]: \"noZoom\",\n  [16 /* NO_ROTATE */]: \"noRotate\",\n  [32 /* NO_VIEW */]: \"noView\",\n  [64 /* READ_ONLY */]: \"readOnly\",\n  [128 /* LOCKED */]: \"locked\",\n  [256 /* TOGGLE_NOVIEW */]: \"toggleNoView\"\n});\nvar PdfAnnotationFlagValue = Object.entries(\n  PdfAnnotationFlagName\n).reduce(\n  (acc, [bit, name]) => {\n    acc[name] = Number(bit);\n    return acc;\n  },\n  {}\n);\nfunction flagsToNames(raw) {\n  return Object.keys(PdfAnnotationFlagName).filter((flag) => (raw & flag) !== 0).map((flag) => PdfAnnotationFlagName[flag]);\n}\nfunction namesToFlags(names) {\n  return names.reduce(\n    (mask, name) => mask | PdfAnnotationFlagValue[name],\n    0 /* NONE */\n  );\n}\nvar PdfSegmentObjectType = /* @__PURE__ */ ((PdfSegmentObjectType2) => {\n  PdfSegmentObjectType2[PdfSegmentObjectType2[\"UNKNOWN\"] = -1] = \"UNKNOWN\";\n  PdfSegmentObjectType2[PdfSegmentObjectType2[\"LINETO\"] = 0] = \"LINETO\";\n  PdfSegmentObjectType2[PdfSegmentObjectType2[\"BEZIERTO\"] = 1] = \"BEZIERTO\";\n  PdfSegmentObjectType2[PdfSegmentObjectType2[\"MOVETO\"] = 2] = \"MOVETO\";\n  return PdfSegmentObjectType2;\n})(PdfSegmentObjectType || {});\nvar PdfEngineFeature = /* @__PURE__ */ ((PdfEngineFeature2) => {\n  PdfEngineFeature2[PdfEngineFeature2[\"RenderPage\"] = 0] = \"RenderPage\";\n  PdfEngineFeature2[PdfEngineFeature2[\"RenderPageRect\"] = 1] = \"RenderPageRect\";\n  PdfEngineFeature2[PdfEngineFeature2[\"Thumbnails\"] = 2] = \"Thumbnails\";\n  PdfEngineFeature2[PdfEngineFeature2[\"Bookmarks\"] = 3] = \"Bookmarks\";\n  PdfEngineFeature2[PdfEngineFeature2[\"Annotations\"] = 4] = \"Annotations\";\n  return PdfEngineFeature2;\n})(PdfEngineFeature || {});\nvar PdfEngineOperation = /* @__PURE__ */ ((PdfEngineOperation2) => {\n  PdfEngineOperation2[PdfEngineOperation2[\"Create\"] = 0] = \"Create\";\n  PdfEngineOperation2[PdfEngineOperation2[\"Read\"] = 1] = \"Read\";\n  PdfEngineOperation2[PdfEngineOperation2[\"Update\"] = 2] = \"Update\";\n  PdfEngineOperation2[PdfEngineOperation2[\"Delete\"] = 3] = \"Delete\";\n  return PdfEngineOperation2;\n})(PdfEngineOperation || {});\nvar MatchFlag = /* @__PURE__ */ ((MatchFlag2) => {\n  MatchFlag2[MatchFlag2[\"None\"] = 0] = \"None\";\n  MatchFlag2[MatchFlag2[\"MatchCase\"] = 1] = \"MatchCase\";\n  MatchFlag2[MatchFlag2[\"MatchWholeWord\"] = 2] = \"MatchWholeWord\";\n  MatchFlag2[MatchFlag2[\"MatchConsecutive\"] = 4] = \"MatchConsecutive\";\n  return MatchFlag2;\n})(MatchFlag || {});\nfunction unionFlags(flags) {\n  return flags.reduce((flag, currFlag) => {\n    return flag | currFlag;\n  }, 0 /* None */);\n}\nfunction compareSearchTarget(targetA, targetB) {\n  const flagA = unionFlags(targetA.flags);\n  const flagB = unionFlags(targetB.flags);\n  return flagA === flagB && targetA.keyword === targetB.keyword;\n}\nvar PdfPermission = /* @__PURE__ */ ((PdfPermission2) => {\n  PdfPermission2[PdfPermission2[\"PrintDocument\"] = 8] = \"PrintDocument\";\n  PdfPermission2[PdfPermission2[\"ModifyContent\"] = 16] = \"ModifyContent\";\n  PdfPermission2[PdfPermission2[\"CopyOrExtract\"] = 32] = \"CopyOrExtract\";\n  PdfPermission2[PdfPermission2[\"AddOrModifyTextAnnot\"] = 64] = \"AddOrModifyTextAnnot\";\n  PdfPermission2[PdfPermission2[\"FillInExistingForm\"] = 512] = \"FillInExistingForm\";\n  PdfPermission2[PdfPermission2[\"ExtractTextOrGraphics\"] = 1024] = \"ExtractTextOrGraphics\";\n  PdfPermission2[PdfPermission2[\"AssembleDocument\"] = 2048] = \"AssembleDocument\";\n  PdfPermission2[PdfPermission2[\"PrintHighQuality\"] = 4096] = \"PrintHighQuality\";\n  return PdfPermission2;\n})(PdfPermission || {});\nvar PdfPageFlattenFlag = /* @__PURE__ */ ((PdfPageFlattenFlag2) => {\n  PdfPageFlattenFlag2[PdfPageFlattenFlag2[\"Display\"] = 0] = \"Display\";\n  PdfPageFlattenFlag2[PdfPageFlattenFlag2[\"Print\"] = 1] = \"Print\";\n  return PdfPageFlattenFlag2;\n})(PdfPageFlattenFlag || {});\nvar PdfPageFlattenResult = /* @__PURE__ */ ((PdfPageFlattenResult2) => {\n  PdfPageFlattenResult2[PdfPageFlattenResult2[\"Fail\"] = 0] = \"Fail\";\n  PdfPageFlattenResult2[PdfPageFlattenResult2[\"Success\"] = 1] = \"Success\";\n  PdfPageFlattenResult2[PdfPageFlattenResult2[\"NothingToDo\"] = 2] = \"NothingToDo\";\n  return PdfPageFlattenResult2;\n})(PdfPageFlattenResult || {});\nvar PdfErrorCode = /* @__PURE__ */ ((PdfErrorCode2) => {\n  PdfErrorCode2[PdfErrorCode2[\"Ok\"] = 0] = \"Ok\";\n  PdfErrorCode2[PdfErrorCode2[\"Unknown\"] = 1] = \"Unknown\";\n  PdfErrorCode2[PdfErrorCode2[\"NotFound\"] = 2] = \"NotFound\";\n  PdfErrorCode2[PdfErrorCode2[\"WrongFormat\"] = 3] = \"WrongFormat\";\n  PdfErrorCode2[PdfErrorCode2[\"Password\"] = 4] = \"Password\";\n  PdfErrorCode2[PdfErrorCode2[\"Security\"] = 5] = \"Security\";\n  PdfErrorCode2[PdfErrorCode2[\"PageError\"] = 6] = \"PageError\";\n  PdfErrorCode2[PdfErrorCode2[\"XFALoad\"] = 7] = \"XFALoad\";\n  PdfErrorCode2[PdfErrorCode2[\"XFALayout\"] = 8] = \"XFALayout\";\n  PdfErrorCode2[PdfErrorCode2[\"Cancelled\"] = 9] = \"Cancelled\";\n  PdfErrorCode2[PdfErrorCode2[\"Initialization\"] = 10] = \"Initialization\";\n  PdfErrorCode2[PdfErrorCode2[\"NotReady\"] = 11] = \"NotReady\";\n  PdfErrorCode2[PdfErrorCode2[\"NotSupport\"] = 12] = \"NotSupport\";\n  PdfErrorCode2[PdfErrorCode2[\"LoadDoc\"] = 13] = \"LoadDoc\";\n  PdfErrorCode2[PdfErrorCode2[\"DocNotOpen\"] = 14] = \"DocNotOpen\";\n  PdfErrorCode2[PdfErrorCode2[\"CantCloseDoc\"] = 15] = \"CantCloseDoc\";\n  PdfErrorCode2[PdfErrorCode2[\"CantCreateNewDoc\"] = 16] = \"CantCreateNewDoc\";\n  PdfErrorCode2[PdfErrorCode2[\"CantImportPages\"] = 17] = \"CantImportPages\";\n  PdfErrorCode2[PdfErrorCode2[\"CantCreateAnnot\"] = 18] = \"CantCreateAnnot\";\n  PdfErrorCode2[PdfErrorCode2[\"CantSetAnnotRect\"] = 19] = \"CantSetAnnotRect\";\n  PdfErrorCode2[PdfErrorCode2[\"CantSetAnnotContent\"] = 20] = \"CantSetAnnotContent\";\n  PdfErrorCode2[PdfErrorCode2[\"CantRemoveInkList\"] = 21] = \"CantRemoveInkList\";\n  PdfErrorCode2[PdfErrorCode2[\"CantAddInkStoke\"] = 22] = \"CantAddInkStoke\";\n  PdfErrorCode2[PdfErrorCode2[\"CantReadAttachmentSize\"] = 23] = \"CantReadAttachmentSize\";\n  PdfErrorCode2[PdfErrorCode2[\"CantReadAttachmentContent\"] = 24] = \"CantReadAttachmentContent\";\n  PdfErrorCode2[PdfErrorCode2[\"CantFocusAnnot\"] = 25] = \"CantFocusAnnot\";\n  PdfErrorCode2[PdfErrorCode2[\"CantSelectText\"] = 26] = \"CantSelectText\";\n  PdfErrorCode2[PdfErrorCode2[\"CantSelectOption\"] = 27] = \"CantSelectOption\";\n  PdfErrorCode2[PdfErrorCode2[\"CantCheckField\"] = 28] = \"CantCheckField\";\n  return PdfErrorCode2;\n})(PdfErrorCode || {});\nvar PdfTaskHelper = class {\n  /**\n   * Create a task\n   * @returns new task\n   */\n  static create() {\n    return new Task();\n  }\n  /**\n   * Create a task that has been resolved with value\n   * @param result - resolved value\n   * @returns resolved task\n   */\n  static resolve(result) {\n    const task = new Task();\n    task.resolve(result);\n    return task;\n  }\n  /**\n   * Create a task that has been rejected with error\n   * @param reason - rejected error\n   * @returns rejected task\n   */\n  static reject(reason) {\n    const task = new Task();\n    task.reject(reason);\n    return task;\n  }\n  /**\n   * Create a task that has been aborted with error\n   * @param reason - aborted error\n   * @returns aborted task\n   */\n  static abort(reason) {\n    const task = new Task();\n    task.reject(reason);\n    return task;\n  }\n};\n\n// src/color.ts\nfunction pdfAlphaColorToWebAlphaColor(c) {\n  const clamp = (n) => Math.max(0, Math.min(255, n));\n  const toHex = (n) => clamp(n).toString(16).padStart(2, \"0\");\n  const color = `#${toHex(c.red)}${toHex(c.green)}${toHex(c.blue)}`;\n  const opacity = clamp(c.alpha) / 255;\n  return { color, opacity };\n}\nfunction webAlphaColorToPdfAlphaColor({ color, opacity }) {\n  if (/^#?[0-9a-f]{3}$/i.test(color)) {\n    color = color.replace(/^#?([0-9a-f])([0-9a-f])([0-9a-f])$/i, \"#$1$1$2$2$3$3\").toLowerCase();\n  }\n  const [, r, g, b] = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(color) ?? (() => {\n    throw new Error(`Invalid hex colour: \\u201C${color}\\u201D`);\n  })();\n  const clamp = (n, hi = 255) => Math.max(0, Math.min(hi, n));\n  return {\n    red: parseInt(r, 16),\n    green: parseInt(g, 16),\n    blue: parseInt(b, 16),\n    alpha: clamp(Math.round(opacity * 255))\n  };\n}\n\n// src/date.ts\nfunction pdfDateToDate(pdf) {\n  if (!pdf?.startsWith(\"D:\") || pdf.length < 16) return;\n  const y = +pdf.slice(2, 6);\n  const mo = +pdf.slice(6, 8) - 1;\n  const d = +pdf.slice(8, 10);\n  const H = +pdf.slice(10, 12);\n  const M = +pdf.slice(12, 14);\n  const S = +pdf.slice(14, 16);\n  return new Date(Date.UTC(y, mo, d, H, M, S));\n}\nfunction dateToPdfDate(date = /* @__PURE__ */ new Date()) {\n  const z = (n, len = 2) => n.toString().padStart(len, \"0\");\n  const YYYY = date.getUTCFullYear();\n  const MM = z(date.getUTCMonth() + 1);\n  const DD = z(date.getUTCDate());\n  const HH = z(date.getUTCHours());\n  const mm = z(date.getUTCMinutes());\n  const SS = z(date.getUTCSeconds());\n  return `D:${YYYY}${MM}${DD}${HH}${mm}${SS}`;\n}\n\n// src/index.ts\nfunction ignore() {\n}\nexport {\n  AllLogger,\n  AppearanceMode,\n  ConsoleLogger,\n  LevelLogger,\n  LogLevel,\n  MatchFlag,\n  MixedBlendMode,\n  NoopLogger,\n  PDF_FORM_FIELD_FLAG,\n  PDF_FORM_FIELD_TYPE,\n  PdfActionType,\n  PdfAnnotationBorderStyle,\n  PdfAnnotationColorType,\n  PdfAnnotationFlagName,\n  PdfAnnotationFlags,\n  PdfAnnotationObjectStatus,\n  PdfAnnotationState,\n  PdfAnnotationStateModel,\n  PdfAnnotationSubtype,\n  PdfAnnotationSubtypeName,\n  PdfBlendMode,\n  PdfBomOrZwnbsp,\n  PdfEngineFeature,\n  PdfEngineOperation,\n  PdfErrorCode,\n  PdfNonCharacterFFFE,\n  PdfNonCharacterFFFF,\n  PdfPageFlattenFlag,\n  PdfPageFlattenResult,\n  PdfPageObjectType,\n  PdfPermission,\n  PdfSegmentObjectType,\n  PdfSoftHyphenMarker,\n  PdfTaskHelper,\n  PdfUnwantedTextMarkers,\n  PdfUnwantedTextRegex,\n  PdfWordJoiner,\n  PdfZeroWidthSpace,\n  PdfZoomMode,\n  PerfLogger,\n  Rotation,\n  Task,\n  TaskAbortedError,\n  TaskRejectedError,\n  TaskStage,\n  blendModeLabel,\n  blendModeSelectOptions,\n  blendModeToCss,\n  boundingRect,\n  calculateAngle,\n  calculateDegree,\n  compareSearchTarget,\n  cssToBlendMode,\n  dateToPdfDate,\n  flagsToNames,\n  getBlendModeInfo,\n  ignore,\n  makeMatrix,\n  namesToFlags,\n  pdfAlphaColorToWebAlphaColor,\n  pdfDateToDate,\n  quadToRect,\n  rectToQuad,\n  reduceBlendModes,\n  restoreOffset,\n  restorePosition,\n  restoreRect,\n  rotatePosition,\n  rotateRect,\n  scalePosition,\n  scaleRect,\n  stripPdfUnwantedMarkers,\n  swap,\n  toIntPos,\n  toIntRect,\n  toIntSize,\n  transformPosition,\n  transformRect,\n  transformSize,\n  uiBlendModeDisplay,\n  unionFlags,\n  webAlphaColorToPdfAlphaColor\n};\n//# sourceMappingURL=index.js.map","import { BasePluginConfig, Emitter, EventHook } from '@embedpdf/core';\nimport { PdfPageObject, Rect, Rotation } from '@embedpdf/models';\nimport { ViewportMetrics } from '@embedpdf/plugin-viewport';\nimport { VirtualItem } from './types/virtual-item';\n\nexport interface ScrollState extends ScrollMetrics {\n  virtualItems: VirtualItem[];\n  totalPages: number;\n  totalContentSize: { width: number; height: number };\n  desiredScrollPosition: { x: number; y: number };\n  strategy: ScrollStrategy;\n  pageGap: number;\n  scale: number;\n}\n\nexport interface ScrollerLayout {\n  startSpacing: number;\n  endSpacing: number;\n  totalWidth: number;\n  totalHeight: number;\n  pageGap: number;\n  strategy: ScrollState['strategy'];\n  items: VirtualItem[];\n}\n\nexport enum ScrollStrategy {\n  Vertical = 'vertical',\n  Horizontal = 'horizontal',\n}\n\nexport interface PageVisibilityMetrics {\n  pageNumber: number;\n  viewportX: number;\n  viewportY: number;\n  visiblePercentage: number;\n  original: {\n    pageX: number;\n    pageY: number;\n    visibleWidth: number;\n    visibleHeight: number;\n    scale: number;\n  };\n  scaled: {\n    pageX: number;\n    pageY: number;\n    visibleWidth: number;\n    visibleHeight: number;\n    scale: number;\n  };\n}\n\nexport interface ScrollMetrics {\n  currentPage: number;\n  visiblePages: number[];\n  pageVisibilityMetrics: PageVisibilityMetrics[];\n  renderedPageIndexes: number[];\n  scrollOffset: { x: number; y: number };\n  startSpacing: number;\n  endSpacing: number;\n}\n\nexport interface ScrollStrategyInterface {\n  initialize(container: HTMLElement, innerDiv: HTMLElement): void;\n  destroy(): void;\n  updateLayout(viewport: ViewportMetrics, pdfPageObject: PdfPageObject[][]): void;\n  handleScroll(viewport: ViewportMetrics): void;\n  getVirtualItems(): VirtualItem[];\n  scrollToPage(pageNumber: number, behavior?: ScrollBehavior): void;\n  calculateDimensions(pdfPageObject: PdfPageObject[][]): void;\n}\n\nexport interface ScrollPluginConfig extends BasePluginConfig {\n  strategy?: ScrollStrategy;\n  initialPage?: number;\n  bufferSize?: number;\n  pageGap?: number;\n}\n\nexport type LayoutChangePayload = Pick<ScrollState, 'virtualItems' | 'totalContentSize'>;\n\nexport interface ScrollToPageOptions {\n  pageNumber: number;\n  pageCoordinates?: { x: number; y: number };\n  behavior?: ScrollBehavior;\n  center?: boolean;\n}\n\nexport interface PageChangePayload {\n  pageNumber: number;\n  totalPages: number;\n}\n\nexport interface ScrollCapability {\n  onScrollerData: EventHook<ScrollerLayout>;\n  onStateChange: EventHook<ScrollState>;\n  onScroll: EventHook<ScrollMetrics>;\n  getCurrentPage(): number;\n  getTotalPages(): number;\n  onPageChange: EventHook<PageChangePayload>;\n  onLayoutChange: EventHook<LayoutChangePayload>;\n  onLayoutReady: EventHook<boolean>;\n  scrollToPage(options: ScrollToPageOptions): void;\n  scrollToNextPage(behavior?: ScrollBehavior): void;\n  scrollToPreviousPage(behavior?: ScrollBehavior): void;\n  getMetrics(viewport?: ViewportMetrics): ScrollMetrics;\n  getLayout(): LayoutChangePayload;\n  getScrollerLayout(): ScrollerLayout;\n  getRectPositionForPage(\n    page: number,\n    rect: Rect,\n    scale?: number,\n    rotation?: Rotation,\n  ): Rect | null;\n  setScrollStrategy(strategy: ScrollStrategy): void;\n  getPageGap(): number;\n}\n","import {\n  PdfPageObjectWithRotatedSize,\n  Position,\n  Rect,\n  Rotation,\n  scalePosition,\n  transformPosition,\n  transformRect,\n} from '@embedpdf/models';\nimport { ViewportMetrics } from '@embedpdf/plugin-viewport';\nimport { VirtualItem } from '../types/virtual-item';\nimport { ScrollMetrics } from '../types';\n\nexport interface ScrollStrategyConfig {\n  pageGap?: number;\n  viewportGap?: number;\n  bufferSize?: number;\n}\n\nexport abstract class BaseScrollStrategy {\n  protected pageGap: number;\n  protected viewportGap: number;\n  protected bufferSize: number;\n\n  constructor(config: ScrollStrategyConfig) {\n    this.pageGap = config.pageGap ?? 20;\n    this.viewportGap = config.viewportGap ?? 20;\n    this.bufferSize = config.bufferSize ?? 2;\n  }\n\n  abstract createVirtualItems(pdfPageObject: PdfPageObjectWithRotatedSize[][]): VirtualItem[];\n  abstract getTotalContentSize(virtualItems: VirtualItem[]): { width: number; height: number };\n  protected abstract getScrollOffset(viewport: ViewportMetrics): number;\n  protected abstract getClientSize(viewport: ViewportMetrics): number;\n\n  protected getVisibleRange(\n    viewport: ViewportMetrics,\n    virtualItems: VirtualItem[],\n    scale: number,\n  ): { start: number; end: number } {\n    const scrollOffset = this.getScrollOffset(viewport);\n    const clientSize = this.getClientSize(viewport);\n    const viewportStart = scrollOffset;\n    const viewportEnd = scrollOffset + clientSize;\n\n    let startIndex = 0;\n    while (\n      startIndex < virtualItems.length &&\n      (virtualItems[startIndex].offset + virtualItems[startIndex].height) * scale <= viewportStart\n    ) {\n      startIndex++;\n    }\n\n    let endIndex = startIndex;\n    while (endIndex < virtualItems.length && virtualItems[endIndex].offset * scale <= viewportEnd) {\n      endIndex++;\n    }\n\n    return {\n      start: Math.max(0, startIndex - this.bufferSize),\n      end: Math.min(virtualItems.length - 1, endIndex + this.bufferSize - 1),\n    };\n  }\n\n  handleScroll(\n    viewport: ViewportMetrics,\n    virtualItems: VirtualItem[],\n    scale: number,\n  ): ScrollMetrics {\n    const range = this.getVisibleRange(viewport, virtualItems, scale);\n    const visibleItems = virtualItems.slice(range.start, range.end + 1);\n    const pageVisibilityMetrics = this.calculatePageVisibility(visibleItems, viewport, scale);\n    const visiblePages = pageVisibilityMetrics.map((m) => m.pageNumber);\n    const renderedPageIndexes = virtualItems\n      .slice(range.start, range.end + 1)\n      .flatMap((item) => item.index);\n    const currentPage = this.determineCurrentPage(pageVisibilityMetrics);\n    const first = virtualItems[range.start];\n    const last = virtualItems[range.end];\n    const startSpacing = first ? first.offset * scale : 0;\n    const endSpacing = last\n      ? (virtualItems[virtualItems.length - 1].offset + // end of content\n          virtualItems[virtualItems.length - 1].height) *\n          scale - // minus\n        (last.offset + last.height) * scale // end of last rendered\n      : 0;\n\n    return {\n      currentPage,\n      visiblePages,\n      pageVisibilityMetrics,\n      renderedPageIndexes,\n      scrollOffset: { x: viewport.scrollLeft, y: viewport.scrollTop },\n      startSpacing,\n      endSpacing,\n    };\n  }\n\n  protected calculatePageVisibility(\n    virtualItems: VirtualItem[],\n    viewport: ViewportMetrics,\n    scale: number,\n  ): ScrollMetrics['pageVisibilityMetrics'] {\n    const visibilityMetrics: ScrollMetrics['pageVisibilityMetrics'] = [];\n\n    virtualItems.forEach((item) => {\n      item.pageLayouts.forEach((page) => {\n        const itemX = item.x * scale;\n        const itemY = item.y * scale;\n        const pageX = itemX + page.x * scale;\n        const pageY = itemY + page.y * scale;\n        const pageWidth = page.rotatedWidth * scale;\n        const pageHeight = page.rotatedHeight * scale;\n\n        const viewportLeft = viewport.scrollLeft;\n        const viewportTop = viewport.scrollTop;\n        const viewportRight = viewportLeft + viewport.clientWidth;\n        const viewportBottom = viewportTop + viewport.clientHeight;\n\n        const intersectionLeft = Math.max(pageX, viewportLeft);\n        const intersectionTop = Math.max(pageY, viewportTop);\n        const intersectionRight = Math.min(pageX + pageWidth, viewportRight);\n        const intersectionBottom = Math.min(pageY + pageHeight, viewportBottom);\n\n        if (intersectionLeft < intersectionRight && intersectionTop < intersectionBottom) {\n          const visibleWidth = intersectionRight - intersectionLeft;\n          const visibleHeight = intersectionBottom - intersectionTop;\n          const totalArea = pageWidth * pageHeight;\n          const visibleArea = visibleWidth * visibleHeight;\n\n          visibilityMetrics.push({\n            pageNumber: page.pageNumber,\n            viewportX: intersectionLeft - viewportLeft,\n            viewportY: intersectionTop - viewportTop,\n            visiblePercentage: (visibleArea / totalArea) * 100,\n            original: {\n              pageX: (intersectionLeft - pageX) / scale,\n              pageY: (intersectionTop - pageY) / scale,\n              visibleWidth: visibleWidth / scale,\n              visibleHeight: visibleHeight / scale,\n              scale: 1,\n            },\n            scaled: {\n              pageX: intersectionLeft - pageX,\n              pageY: intersectionTop - pageY,\n              visibleWidth,\n              visibleHeight,\n              scale,\n            },\n          });\n        }\n      });\n    });\n\n    return visibilityMetrics;\n  }\n\n  protected determineCurrentPage(\n    visibilityMetrics: ScrollMetrics['pageVisibilityMetrics'],\n  ): number {\n    if (visibilityMetrics.length === 0) return 1;\n\n    const maxVisibility = Math.max(...visibilityMetrics.map((m) => m.visiblePercentage));\n    const mostVisiblePages = visibilityMetrics.filter((m) => m.visiblePercentage === maxVisibility);\n\n    return mostVisiblePages.length === 1\n      ? mostVisiblePages[0].pageNumber\n      : mostVisiblePages.sort((a, b) => a.pageNumber - b.pageNumber)[0].pageNumber;\n  }\n\n  private getRectLocationForPage(pageNumber: number, virtualItems: VirtualItem[]): Rect | null {\n    // Find the virtual item containing the page\n    const item = virtualItems.find((item) => item.pageNumbers.includes(pageNumber));\n    if (!item) return null;\n\n    // Find the specific page layout for the requested page number\n    const pageLayout = item.pageLayouts.find((layout) => layout.pageNumber === pageNumber);\n    if (!pageLayout) return null;\n\n    return {\n      origin: {\n        x: item.x + pageLayout.x,\n        y: item.y + pageLayout.y,\n      },\n      size: {\n        width: pageLayout.width,\n        height: pageLayout.height,\n      },\n    };\n  }\n\n  getScrollPositionForPage(\n    pageNumber: number,\n    virtualItems: VirtualItem[],\n    scale: number,\n    rotation: Rotation,\n    pageCoordinates?: { x: number; y: number },\n  ): Position | null {\n    // Find the virtual item containing the page\n    const pageRect = this.getRectLocationForPage(pageNumber, virtualItems);\n    if (!pageRect) return null;\n\n    const scaledBasePosition = scalePosition(pageRect.origin, scale);\n\n    // If specific page coordinates are provided, add them to the base position\n    if (pageCoordinates) {\n      const rotatedSize = transformPosition(\n        {\n          width: pageRect.size.width,\n          height: pageRect.size.height,\n        },\n        {\n          x: pageCoordinates.x,\n          y: pageCoordinates.y,\n        },\n        rotation,\n        scale,\n      );\n\n      return {\n        x: scaledBasePosition.x + rotatedSize.x + this.viewportGap,\n        y: scaledBasePosition.y + rotatedSize.y + this.viewportGap,\n      };\n    }\n\n    return {\n      x: scaledBasePosition.x + this.viewportGap,\n      y: scaledBasePosition.y + this.viewportGap,\n    };\n  }\n\n  getRectPositionForPage(\n    pageNumber: number,\n    virtualItems: VirtualItem[],\n    scale: number,\n    rotation: Rotation,\n    rect: Rect,\n  ): Rect | null {\n    const pageRect = this.getRectLocationForPage(pageNumber, virtualItems);\n    if (!pageRect) return null;\n\n    const scaledBasePosition = scalePosition(pageRect.origin, scale);\n\n    const rotatedSize = transformRect(\n      {\n        width: pageRect.size.width,\n        height: pageRect.size.height,\n      },\n      rect,\n      rotation,\n      scale,\n    );\n\n    return {\n      origin: {\n        x: scaledBasePosition.x + rotatedSize.origin.x,\n        y: scaledBasePosition.y + rotatedSize.origin.y,\n      },\n      size: rotatedSize.size,\n    };\n  }\n}\n","import { PdfPageObjectWithRotatedSize } from '@embedpdf/models';\nimport { ViewportMetrics } from '@embedpdf/plugin-viewport';\nimport { BaseScrollStrategy, ScrollStrategyConfig } from './base-strategy';\nimport { VirtualItem, PageLayout } from '../types/virtual-item';\nimport { ScrollMetrics } from '../types';\n\nexport class VerticalScrollStrategy extends BaseScrollStrategy {\n  constructor(config: ScrollStrategyConfig) {\n    super(config);\n  }\n\n  createVirtualItems(pdfPageObject: PdfPageObjectWithRotatedSize[][]): VirtualItem[] {\n    let yOffset = 0;\n    return pdfPageObject.map((pagesInSpread, index) => {\n      let pageX = 0;\n      const pageLayouts: PageLayout[] = pagesInSpread.map((page) => {\n        const layout: PageLayout = {\n          pageNumber: page.index + 1,\n          pageIndex: page.index,\n          x: pageX,\n          y: 0,\n          width: page.size.width,\n          height: page.size.height,\n          rotatedWidth: page.rotatedSize.width,\n          rotatedHeight: page.rotatedSize.height,\n        };\n        pageX += page.rotatedSize.width + this.pageGap;\n        return layout;\n      });\n      const width = pagesInSpread.reduce(\n        (sum, page, i) =>\n          sum + page.rotatedSize.width + (i < pagesInSpread.length - 1 ? this.pageGap : 0),\n        0,\n      );\n      const height = Math.max(...pagesInSpread.map((p) => p.rotatedSize.height));\n      const item: VirtualItem = {\n        id: `item-${index}`,\n        x: 0,\n        y: yOffset,\n        offset: yOffset,\n        width,\n        height,\n        pageLayouts,\n        pageNumbers: pagesInSpread.map((p) => p.index + 1),\n        index,\n      };\n      yOffset += height + this.pageGap;\n      return item;\n    });\n  }\n\n  getTotalContentSize(virtualItems: VirtualItem[]): { width: number; height: number } {\n    if (virtualItems.length === 0) return { width: 0, height: 0 };\n    const maxWidth = Math.max(...virtualItems.map((item) => item.width));\n    const totalHeight =\n      virtualItems[virtualItems.length - 1].y + virtualItems[virtualItems.length - 1].height;\n    return {\n      width: maxWidth,\n      height: totalHeight,\n    };\n  }\n\n  protected getScrollOffset(viewport: ViewportMetrics): number {\n    return viewport.scrollTop;\n  }\n\n  protected getClientSize(viewport: ViewportMetrics): number {\n    return viewport.clientHeight;\n  }\n}\n","import { PdfPageObjectWithRotatedSize } from '@embedpdf/models';\nimport { ViewportMetrics } from '@embedpdf/plugin-viewport';\nimport { BaseScrollStrategy, ScrollStrategyConfig } from './base-strategy';\nimport { VirtualItem, PageLayout } from '../types/virtual-item';\n\nexport class HorizontalScrollStrategy extends BaseScrollStrategy {\n  constructor(config: ScrollStrategyConfig) {\n    super(config);\n  }\n\n  createVirtualItems(pdfPageObject: PdfPageObjectWithRotatedSize[][]): VirtualItem[] {\n    let xOffset = 0;\n    return pdfPageObject.map((pagesInSpread, index) => {\n      let pageX = 0;\n      const pageLayouts: PageLayout[] = pagesInSpread.map((page) => {\n        const layout: PageLayout = {\n          pageNumber: page.index + 1,\n          pageIndex: page.index,\n          x: pageX,\n          y: 0,\n          width: page.size.width,\n          height: page.size.height,\n          rotatedWidth: page.rotatedSize.width,\n          rotatedHeight: page.rotatedSize.height,\n        };\n        pageX += page.rotatedSize.width + this.pageGap;\n        return layout;\n      });\n      const width = pagesInSpread.reduce(\n        (sum, page, i) =>\n          sum + page.rotatedSize.width + (i < pagesInSpread.length - 1 ? this.pageGap : 0),\n        0,\n      );\n      const height = Math.max(...pagesInSpread.map((p) => p.rotatedSize.height));\n      const item: VirtualItem = {\n        id: `item-${index}`,\n        x: xOffset,\n        y: 0,\n        offset: xOffset,\n        width,\n        height,\n        pageLayouts,\n        pageNumbers: pagesInSpread.map((p) => p.index + 1),\n        index,\n      };\n      xOffset += width + this.pageGap;\n      return item;\n    });\n  }\n\n  getTotalContentSize(virtualItems: VirtualItem[]): { width: number; height: number } {\n    if (virtualItems.length === 0) return { width: 0, height: 0 };\n    const totalWidth =\n      virtualItems[virtualItems.length - 1].x + virtualItems[virtualItems.length - 1].width;\n    const maxHeight = Math.max(...virtualItems.map((item) => item.height));\n    return {\n      width: totalWidth,\n      height: maxHeight,\n    };\n  }\n\n  protected getScrollOffset(viewport: ViewportMetrics): number {\n    return viewport.scrollLeft;\n  }\n\n  protected getClientSize(viewport: ViewportMetrics): number {\n    return viewport.clientWidth;\n  }\n}\n","import { Action } from '@embedpdf/core';\nimport { ScrollState } from './types';\n\nexport const UPDATE_SCROLL_STATE = 'UPDATE_SCROLL_STATE';\nexport const SET_DESIRED_SCROLL_POSITION = 'SET_DESIRED_SCROLL_POSITION';\nexport const UPDATE_TOTAL_PAGES = 'UPDATE_TOTAL_PAGES';\n\nexport interface UpdateScrollStateAction extends Action {\n  type: typeof UPDATE_SCROLL_STATE;\n  payload: Partial<ScrollState>;\n}\n\nexport interface SetDesiredScrollPositionAction extends Action {\n  type: typeof SET_DESIRED_SCROLL_POSITION;\n  payload: { x: number; y: number };\n}\n\nexport interface UpdateTotalPagesAction extends Action {\n  type: typeof UPDATE_TOTAL_PAGES;\n  payload: number;\n}\n\nexport type ScrollAction =\n  | UpdateScrollStateAction\n  | SetDesiredScrollPositionAction\n  | UpdateTotalPagesAction;\n\nexport function updateScrollState(payload: Partial<ScrollState>): UpdateScrollStateAction {\n  return { type: UPDATE_SCROLL_STATE, payload };\n}\n\nexport function setDesiredScrollPosition(payload: {\n  x: number;\n  y: number;\n}): SetDesiredScrollPositionAction {\n  return { type: SET_DESIRED_SCROLL_POSITION, payload };\n}\n\nexport function updateTotalPages(payload: number): UpdateTotalPagesAction {\n  return { type: UPDATE_TOTAL_PAGES, payload };\n}\n","import { ScrollerLayout, ScrollState } from './types';\n\nexport const getScrollerLayout = (state: ScrollState, scale: number): ScrollerLayout => {\n  return {\n    startSpacing: state.startSpacing,\n    endSpacing: state.endSpacing,\n    totalWidth: state.totalContentSize.width * scale,\n    totalHeight: state.totalContentSize.height * scale,\n    pageGap: state.pageGap * scale,\n    strategy: state.strategy,\n    items: state.renderedPageIndexes.map((idx) => {\n      return {\n        ...state.virtualItems[idx],\n        pageLayouts: state.virtualItems[idx].pageLayouts.map((layout) => {\n          return {\n            ...layout,\n            rotatedWidth: layout.rotatedWidth * scale,\n            rotatedHeight: layout.rotatedHeight * scale,\n            width: layout.width * scale,\n            height: layout.height * scale,\n          };\n        }),\n      };\n    }),\n  };\n};\n","import {\n  BasePlugin,\n  CoreState,\n  PluginRegistry,\n  SET_DOCUMENT,\n  SET_PAGES,\n  SET_ROTATION,\n  StoreState,\n  createBehaviorEmitter,\n  createEmitter,\n  getPagesWithRotatedSize,\n} from '@embedpdf/core';\nimport {\n  PdfPageObject,\n  PdfPageObjectWithRotatedSize,\n  Position,\n  Rect,\n  restoreRect,\n  rotateRect,\n  Rotation,\n  transformRect,\n} from '@embedpdf/models';\nimport { ViewportCapability, ViewportMetrics, ViewportPlugin } from '@embedpdf/plugin-viewport';\nimport {\n  ScrollCapability,\n  ScrollPluginConfig,\n  ScrollStrategy,\n  ScrollMetrics,\n  ScrollState,\n  LayoutChangePayload,\n  ScrollerLayout,\n  ScrollToPageOptions,\n  PageChangePayload,\n} from './types';\nimport { BaseScrollStrategy, ScrollStrategyConfig } from './strategies/base-strategy';\nimport { VerticalScrollStrategy } from './strategies/vertical-strategy';\nimport { HorizontalScrollStrategy } from './strategies/horizontal-strategy';\nimport { updateScrollState, ScrollAction, updateTotalPages } from './actions';\nimport { VirtualItem } from './types/virtual-item';\nimport { getScrollerLayout } from './selectors';\n\ntype PartialScroll = Partial<ScrollState>;\ntype Emits = {\n  layout?: LayoutChangePayload;\n  metrics?: ScrollMetrics;\n};\n\nexport class ScrollPlugin extends BasePlugin<\n  ScrollPluginConfig,\n  ScrollCapability,\n  ScrollState,\n  ScrollAction\n> {\n  static readonly id = 'scroll' as const;\n  private viewport: ViewportCapability;\n  private strategy: BaseScrollStrategy;\n  private strategyConfig: ScrollStrategyConfig;\n  private currentScale: number = 1;\n  private currentRotation: Rotation = Rotation.Degree0;\n  private initialPage?: number;\n  private currentPage: number = 1;\n  private layoutReady: boolean = false;\n\n  private readonly layout$ = createBehaviorEmitter<LayoutChangePayload>();\n  private readonly scroll$ = createBehaviorEmitter<ScrollMetrics>();\n  private readonly state$ = createBehaviorEmitter<ScrollState>();\n  private readonly scrollerLayout$ = createBehaviorEmitter<ScrollerLayout>();\n  private readonly pageChange$ = createBehaviorEmitter<PageChangePayload>();\n  private readonly layoutReady$ = createBehaviorEmitter<boolean>();\n\n  constructor(\n    public readonly id: string,\n    registry: PluginRegistry,\n    private config?: ScrollPluginConfig,\n  ) {\n    super(id, registry);\n\n    this.viewport = this.registry.getPlugin<ViewportPlugin>('viewport')!.provides();\n\n    this.strategyConfig = {\n      pageGap: this.config?.pageGap ?? 10,\n      viewportGap: this.viewport.getViewportGap(),\n      bufferSize: this.config?.bufferSize ?? 2,\n    };\n\n    this.strategy =\n      this.config?.strategy === ScrollStrategy.Horizontal\n        ? new HorizontalScrollStrategy(this.strategyConfig)\n        : new VerticalScrollStrategy(this.strategyConfig);\n\n    this.initialPage = this.config?.initialPage;\n    this.currentScale = this.coreState.core.scale;\n    this.currentRotation = this.coreState.core.rotation;\n    // Subscribe to viewport and page manager events\n    this.viewport.onViewportChange((vp) => this.commitMetrics(this.computeMetrics(vp)), {\n      mode: 'throttle',\n      wait: 250,\n    });\n    this.coreStore.onAction(SET_DOCUMENT, (_action, state) => {\n      const totalPages = state.core.pages.length;\n      this.dispatch(updateTotalPages(totalPages));\n      this.pageChange$.emit({ pageNumber: this.currentPage, totalPages });\n      this.refreshAll(getPagesWithRotatedSize(state.core), this.viewport.getMetrics());\n    });\n    this.coreStore.onAction(SET_ROTATION, (_action, state) =>\n      this.refreshAll(getPagesWithRotatedSize(state.core), this.viewport.getMetrics()),\n    );\n    this.coreStore.onAction(SET_PAGES, (_action, state) =>\n      this.refreshAll(getPagesWithRotatedSize(state.core), this.viewport.getMetrics()),\n    );\n  }\n\n  /* ------------------------------------------------------------------ */\n  /*  ᴄᴏᴍᴘᴜᴛᴇʀs                                                       */\n  /* ------------------------------------------------------------------ */\n\n  private computeLayout(pages: PdfPageObjectWithRotatedSize[][]) {\n    const virtualItems = this.strategy.createVirtualItems(pages);\n    const totalContentSize = this.strategy.getTotalContentSize(virtualItems);\n    return { virtualItems, totalContentSize };\n  }\n\n  private computeMetrics(vp: ViewportMetrics, items: VirtualItem[] = this.state.virtualItems) {\n    return this.strategy.handleScroll(vp, items, this.currentScale);\n  }\n\n  /* ------------------------------------------------------------------ */\n  /*  ᴄᴏᴍᴍɪᴛ  (single source of truth)                                  */\n  /* ------------------------------------------------------------------ */\n\n  private commit(stateDelta: PartialScroll, emit?: Emits) {\n    /* update Redux-like store */\n    this.dispatch(updateScrollState(stateDelta));\n\n    /* fire optional events */\n    if (emit?.layout) this.layout$.emit(emit.layout);\n    if (emit?.metrics) {\n      this.scroll$.emit(emit.metrics);\n\n      if (emit.metrics.currentPage !== this.currentPage) {\n        this.currentPage = emit.metrics.currentPage;\n        this.pageChange$.emit({ pageNumber: this.currentPage, totalPages: this.state.totalPages });\n      }\n    }\n\n    /* keep scroller-layout reactive */\n    this.scrollerLayout$.emit(this.getScrollerLayoutFromState());\n  }\n\n  /* convenience wrappers */\n  private commitMetrics(metrics: ScrollMetrics) {\n    this.commit(metrics, { metrics });\n  }\n\n  /* full re-compute after page-spread or initialisation */\n  private refreshAll(pages: PdfPageObjectWithRotatedSize[][], vp: ViewportMetrics) {\n    const layout = this.computeLayout(pages);\n    const metrics = this.computeMetrics(vp, layout.virtualItems);\n\n    this.commit({ ...layout, ...metrics }, { layout, metrics });\n  }\n\n  private getVirtualItemsFromState(): VirtualItem[] {\n    return this.state.virtualItems || [];\n  }\n\n  private getScrollerLayoutFromState(): ScrollerLayout {\n    const scale = this.coreState.core.scale;\n    return getScrollerLayout(this.state, scale);\n  }\n\n  private pushScrollLayout() {\n    this.scrollerLayout$.emit(this.getScrollerLayoutFromState());\n  }\n\n  override onStoreUpdated(_prevState: ScrollState, _newState: ScrollState): void {\n    this.pushScrollLayout();\n  }\n\n  override onCoreStoreUpdated(\n    prevState: StoreState<CoreState>,\n    newState: StoreState<CoreState>,\n  ): void {\n    if (prevState.core.scale !== newState.core.scale) {\n      this.currentScale = newState.core.scale;\n      this.commitMetrics(this.computeMetrics(this.viewport.getMetrics()));\n    }\n    if (prevState.core.rotation !== newState.core.rotation) {\n      this.currentRotation = newState.core.rotation;\n    }\n  }\n\n  /**\n   * Change the scroll strategy at runtime (e.g., vertical <-> horizontal)\n   * @param newStrategy ScrollStrategy.Horizontal or ScrollStrategy.Vertical\n   */\n  private setScrollStrategy(newStrategy: ScrollStrategy) {\n    // Only update if the strategy is actually changing\n    if (\n      (newStrategy === ScrollStrategy.Horizontal &&\n        this.strategy instanceof HorizontalScrollStrategy) ||\n      (newStrategy === ScrollStrategy.Vertical && this.strategy instanceof VerticalScrollStrategy)\n    ) {\n      return;\n    }\n\n    this.strategy =\n      newStrategy === ScrollStrategy.Horizontal\n        ? new HorizontalScrollStrategy(this.strategyConfig)\n        : new VerticalScrollStrategy(this.strategyConfig);\n\n    // Update state with new strategy\n    this.dispatch(\n      updateScrollState({\n        strategy: newStrategy,\n      }),\n    );\n\n    // Recalculate layout and scroll metrics\n    const pages = getPagesWithRotatedSize(this.coreState.core);\n    this.refreshAll(pages, this.viewport.getMetrics());\n  }\n\n  public setLayoutReady() {\n    if (this.layoutReady) return;\n\n    this.layoutReady = true;\n    this.layoutReady$.emit(true);\n  }\n\n  protected buildCapability(): ScrollCapability {\n    return {\n      onStateChange: this.state$.on,\n      onLayoutChange: this.layout$.on,\n      onScroll: this.scroll$.on,\n      onPageChange: this.pageChange$.on,\n      onScrollerData: this.scrollerLayout$.on,\n      onLayoutReady: this.layoutReady$.on,\n      getCurrentPage: () => this.currentPage,\n      getTotalPages: () => this.state.totalPages,\n      scrollToPage: (options: ScrollToPageOptions) => {\n        const { pageNumber, behavior = 'smooth', pageCoordinates, center = false } = options;\n        const virtualItems = this.getVirtualItemsFromState();\n        const position = this.strategy.getScrollPositionForPage(\n          pageNumber,\n          virtualItems,\n          this.currentScale,\n          this.currentRotation,\n          pageCoordinates,\n        );\n        if (position) {\n          this.viewport.scrollTo({ ...position, behavior, center });\n        }\n      },\n      scrollToNextPage: (behavior = 'smooth') => {\n        const virtualItems = this.getVirtualItemsFromState();\n        const currentItemIndex = virtualItems.findIndex((item) =>\n          item.pageNumbers.includes(this.currentPage),\n        );\n        if (currentItemIndex >= 0 && currentItemIndex < virtualItems.length - 1) {\n          const nextItem = virtualItems[currentItemIndex + 1];\n          const position = this.strategy.getScrollPositionForPage(\n            nextItem.pageNumbers[0],\n            virtualItems,\n            this.currentScale,\n            this.currentRotation,\n          );\n          if (position) {\n            this.viewport.scrollTo({ ...position, behavior });\n          }\n        }\n      },\n      scrollToPreviousPage: (behavior = 'smooth') => {\n        const virtualItems = this.getVirtualItemsFromState();\n        const currentItemIndex = virtualItems.findIndex((item) =>\n          item.pageNumbers.includes(this.currentPage),\n        );\n        if (currentItemIndex > 0) {\n          const prevItem = virtualItems[currentItemIndex - 1];\n          const position = this.strategy.getScrollPositionForPage(\n            prevItem.pageNumbers[0],\n            virtualItems,\n            this.currentScale,\n            this.currentRotation,\n          );\n          if (position) {\n            this.viewport.scrollTo({ ...position, behavior });\n          }\n        }\n      },\n      getMetrics: this.getMetrics.bind(this),\n      getLayout: this.getLayout.bind(this),\n      getRectPositionForPage: this.getRectPositionForPage.bind(this),\n      getPageGap: () => this.state.pageGap,\n      getScrollerLayout: () => this.getScrollerLayoutFromState(),\n      setScrollStrategy: (strategy: ScrollStrategy) => this.setScrollStrategy(strategy),\n    };\n  }\n\n  private getMetrics(viewport?: ViewportMetrics): ScrollMetrics {\n    const metrics = viewport || this.viewport.getMetrics();\n    const virtualItems = this.getVirtualItemsFromState();\n    return this.strategy.handleScroll(metrics, virtualItems, this.currentScale);\n  }\n\n  private getLayout(): LayoutChangePayload {\n    return {\n      virtualItems: this.state.virtualItems,\n      totalContentSize: this.state.totalContentSize,\n    };\n  }\n\n  private getRectPositionForPage(\n    pageIndex: number,\n    rect: Rect,\n    scale?: number,\n    rotation?: Rotation,\n  ): Rect | null {\n    return this.strategy.getRectPositionForPage(\n      pageIndex + 1,\n      this.state.virtualItems,\n      scale ?? this.currentScale,\n      rotation ?? this.currentRotation,\n      rect,\n    );\n  }\n\n  async initialize(): Promise<void> {\n    // No DOM initialization needed; state drives rendering\n  }\n\n  async destroy(): Promise<void> {\n    this.layout$.clear();\n    this.scroll$.clear();\n    this.pageChange$.clear();\n    this.state$.clear();\n    this.scrollerLayout$.clear();\n    this.layoutReady$.clear();\n    super.destroy();\n  }\n}\n"],"names":["f","y","w","E","T","i","e","t","X","z","M","L","$","F","N","k","P","_","v","r","n","x","a","o","U","B","S","G","d","c","b","C","m","p","h","l","Rotation","Rotation2","swap","size","width","height","rotatePosition","containerSize","position","rotation","scalePosition","scaleFactor","transformPosition","rotateRect","rect","scaleRect","transformRect","PdfSoftHyphenMarker","PdfZeroWidthSpace","PdfWordJoiner","PdfBomOrZwnbsp","PdfNonCharacterFFFE","PdfNonCharacterFFFF","PdfUnwantedTextMarkers","BLEND_MODE_INFOS","info","PdfAnnotationFlagName","acc","bit","name","ScrollStrategy","BaseScrollStrategy","config","viewport","virtualItems","scale","scrollOffset","clientSize","viewportStart","viewportEnd","startIndex","endIndex","range","visibleItems","pageVisibilityMetrics","visiblePages","renderedPageIndexes","item","currentPage","first","last","startSpacing","endSpacing","visibilityMetrics","page","itemX","itemY","pageX","pageY","pageWidth","pageHeight","viewportLeft","viewportTop","viewportRight","viewportBottom","intersectionLeft","intersectionTop","intersectionRight","intersectionBottom","visibleWidth","visibleHeight","totalArea","visibleArea","maxVisibility","mostVisiblePages","pageNumber","pageLayout","layout","pageCoordinates","pageRect","scaledBasePosition","rotatedSize","VerticalScrollStrategy","pdfPageObject","yOffset","pagesInSpread","index","pageLayouts","sum","maxWidth","totalHeight","HorizontalScrollStrategy","xOffset","totalWidth","maxHeight","UPDATE_SCROLL_STATE","SET_DESIRED_SCROLL_POSITION","UPDATE_TOTAL_PAGES","updateScrollState","payload","updateTotalPages","getScrollerLayout","state","idx","_ScrollPlugin","BasePlugin","id","registry","createBehaviorEmitter","_a","_b","_c","_d","vp","SET_DOCUMENT","_action","totalPages","getPagesWithRotatedSize","SET_ROTATION","SET_PAGES","pages","totalContentSize","items","stateDelta","emit","metrics","_prevState","_newState","prevState","newState","newStrategy","options","behavior","center","currentItemIndex","nextItem","prevItem","strategy","pageIndex","ScrollPlugin"],"mappings":"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"}