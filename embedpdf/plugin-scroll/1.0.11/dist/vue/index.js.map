{"version":3,"file":"index.js","sources":["../../../core/dist/vue/index.js","../../src/vue/hooks/use-scroll.ts","../../src/vue/components/scroller.vue"],"sourcesContent":["import { inject as p, ref as u, onMounted as a, onBeforeUnmount as l, shallowRef as d, watch as v, computed as y, defineComponent as m, provide as P, renderSlot as w } from \"vue\";\nimport { a as h, P as S } from \"../math-ChSRQF3r.js\";\nconst f = Symbol(\"pdfKey\");\nfunction c() {\n  const r = p(f);\n  if (!r) throw new Error(\"useRegistry must be used inside <EmbedPDF>\");\n  return r;\n}\nfunction b() {\n  const { registry: r } = c(), e = u();\n  return a(() => {\n    const o = r.value.getStore();\n    e.value = o.getState().core;\n    const t = o.subscribe((s, n, i) => {\n      o.isCoreAction(s) && !h(n.core, i.core) && (e.value = n.core);\n    });\n    l(t);\n  }), e;\n}\nfunction R(r) {\n  const { registry: e } = c(), o = d(null), t = u(!0), s = u(new Promise(() => {\n  })), n = () => {\n    var g;\n    if (!e.value) return;\n    const i = e.value.getPlugin(r);\n    if (!i) throw new Error(`Plugin ${r} not found`);\n    o.value = i, t.value = !1, s.value = ((g = i.ready) == null ? void 0 : g.call(i)) ?? Promise.resolve();\n  };\n  return a(n), v(e, n), { plugin: o, isLoading: t, ready: s };\n}\nfunction z(r) {\n  const { plugin: e, isLoading: o, ready: t } = R(r);\n  return { provides: y(() => {\n    if (!e.value) return null;\n    if (!e.value.provides)\n      throw new Error(`Plugin ${r} does not implement provides()`);\n    return e.value.provides();\n  }), isLoading: o, ready: t };\n}\nfunction C() {\n  const { registry: r } = c(), e = u();\n  function o() {\n    return r.value ? (e.value = r.value.getStore().getState(), r.value.getStore().subscribe((s, n) => e.value = n)) : () => {\n    };\n  }\n  let t = o();\n  return v(r, () => {\n    t == null || t(), t = o();\n  }), l(() => t == null ? void 0 : t()), e;\n}\nconst F = /* @__PURE__ */ m({\n  __name: \"embed-pdf\",\n  props: {\n    engine: {},\n    plugins: {},\n    onInitialized: { type: Function }\n  },\n  setup(r) {\n    const e = r, o = d(null), t = u(!0), s = u(!1);\n    return P(f, { registry: o, isInitializing: t, pluginsReady: s }), a(async () => {\n      var i;\n      const n = new S(e.engine);\n      n.registerPluginBatch(e.plugins), await n.initialize(), await ((i = e.onInitialized) == null ? void 0 : i.call(e, n)), o.value = n, t.value = !1, n.pluginsReady().then(() => s.value = !0);\n    }), l(() => {\n      var n;\n      return (n = o.value) == null ? void 0 : n.destroy();\n    }), (n, i) => w(n.$slots, \"default\", {\n      registry: o.value,\n      isInitializing: t.value,\n      pluginsReady: s.value\n    });\n  }\n});\nexport {\n  F as EmbedPDF,\n  z as useCapability,\n  b as useCoreState,\n  R as usePlugin,\n  c as useRegistry,\n  C as useStoreState\n};\n//# sourceMappingURL=index.js.map\n","import { ref, watchEffect } from 'vue';\nimport { useCapability, usePlugin } from '@embedpdf/core/vue';\nimport { ScrollPlugin } from '@embedpdf/plugin-scroll';\n\nexport const useScrollPlugin = () => usePlugin<ScrollPlugin>(ScrollPlugin.id);\nexport const useScrollCapability = () => useCapability<ScrollPlugin>(ScrollPlugin.id);\n\n/**\n * Convenience hook that also tracks current / total page.\n */\nexport function useScroll() {\n  const { provides: scroll } = useScrollCapability();\n\n  const currentPage = ref(1);\n  const totalPages = ref(1);\n\n  watchEffect((onCleanup) => {\n    if (!scroll.value) return;\n\n    const off = scroll.value.onPageChange(({ pageNumber, totalPages: tp }) => {\n      currentPage.value = pageNumber;\n      totalPages.value = tp;\n    });\n    onCleanup(off);\n  });\n\n  return {\n    scroll,\n    currentPage,\n    totalPages,\n  };\n}\n","<script setup lang=\"ts\">\n/* ------------------------------------------------------------------ */\n/* imports                                                            */\n/* ------------------------------------------------------------------ */\nimport { computed, onMounted, ref, watchEffect, useAttrs } from 'vue';\nimport type { StyleValue } from 'vue';\n\nimport { useScrollCapability, useScrollPlugin } from '../hooks';\nimport { ScrollStrategy, type ScrollerLayout, type PageLayout } from '@embedpdf/plugin-scroll';\nimport { useRegistry } from '@embedpdf/core/vue';\nimport type { PdfDocumentObject, Rotation } from '@embedpdf/models';\n\n/* ------------------------------------------------------------------ */\n/* props â€“Â pure layout; page content comes from the *slot*            */\n/* ------------------------------------------------------------------ */\nconst props = withDefaults(\n  defineProps<{\n    style?: StyleValue;\n    overlayElements?: any[];\n  }>(),\n  { overlayElements: () => [] },\n);\n\nconst attrs = useAttrs();\n\n/* ------------------------------------------------------------------ */\n/* plugin + reactive state                                            */\n/* ------------------------------------------------------------------ */\nconst { provides: scrollProvides } = useScrollCapability();\nconst { plugin: scrollPlugin } = useScrollPlugin();\nconst { registry } = useRegistry(); // shallowRef<PluginRegistry|null>\n\nconst layout = ref<ScrollerLayout | null>(null);\n\n/* subscribe to scrollerâ€‘layout updates */\nwatchEffect((onCleanup) => {\n  if (!scrollProvides.value) return;\n\n  layout.value = scrollProvides.value.getScrollerLayout();\n  const off = scrollProvides.value.onScrollerData((l) => (layout.value = l));\n  onCleanup(off);\n});\n\n/* inform plugin once the DOM is ready */\nonMounted(() => {\n  scrollPlugin.value?.setLayoutReady();\n});\n\n/* ------------------------------------------------------------------ */\n/* helpers                                                            */\n/* ------------------------------------------------------------------ */\ninterface PageSlotProps extends PageLayout {\n  rotation: Rotation;\n  scale: number;\n  document: PdfDocumentObject | null;\n}\n\n/** Build the prop object that weâ€™ll forward into the default slot */\nfunction pageSlotProps(pl: PageLayout): PageSlotProps {\n  const core = registry.value!.getStore().getState().core;\n  return {\n    ...pl,\n    rotation: core.rotation,\n    scale: core.scale,\n    document: core.document,\n  };\n}\n\n/* ------------------------------------------------------------------ */\n/* computed root style                                                */\n/* ------------------------------------------------------------------ */\nconst rootStyle = computed<StyleValue>(() => {\n  if (!layout.value) return props.style;\n\n  const base =\n    typeof props.style === 'object' && !Array.isArray(props.style)\n      ? { ...props.style }\n      : (props.style ?? {});\n\n  return [\n    base,\n    {\n      width: `${layout.value.totalWidth}px`,\n      height: `${layout.value.totalHeight}px`,\n      position: 'relative',\n      boxSizing: 'border-box',\n      margin: '0 auto',\n      ...(layout.value.strategy === ScrollStrategy.Horizontal && {\n        display: 'flex',\n        flexDirection: 'row',\n      }),\n    },\n  ];\n});\n</script>\n\n<template>\n  <!-- render nothing until both layout + registry exist -->\n  <div v-if=\"layout && registry\" :style=\"rootStyle\" v-bind=\"attrs\">\n    <!-- leading spacer -->\n    <div\n      v-if=\"layout.strategy === 'horizontal'\"\n      :style=\"{ width: layout.startSpacing + 'px', height: '100%', flexShrink: 0 }\"\n    />\n    <div v-else :style=\"{ height: layout.startSpacing + 'px', width: '100%' }\" />\n\n    <!-- actual page grid -->\n    <div\n      :style=\"{\n        gap: layout.pageGap + 'px',\n        display: 'flex',\n        alignItems: 'center',\n        position: 'relative',\n        boxSizing: 'border-box',\n        flexDirection: layout.strategy === 'horizontal' ? 'row' : 'column',\n        minHeight: layout.strategy === 'horizontal' ? '100%' : undefined,\n        minWidth: layout.strategy === 'vertical' ? 'fit-content' : undefined,\n      }\"\n    >\n      <template v-for=\"item in layout.items\" :key=\"item.pageNumbers[0]\">\n        <div :style=\"{ display: 'flex', justifyContent: 'center', gap: layout.pageGap + 'px' }\">\n          <div\n            v-for=\"pl in item.pageLayouts\"\n            :key=\"pl.pageNumber\"\n            :style=\"{ width: pl.rotatedWidth + 'px', height: pl.rotatedHeight + 'px' }\"\n          >\n            <!-- ðŸ”‘ give the host app full control over page content -->\n            <slot :page=\"pageSlotProps(pl)\" />\n          </div>\n        </div>\n      </template>\n    </div>\n\n    <!-- trailing spacer -->\n    <div\n      v-if=\"layout.strategy === 'horizontal'\"\n      :style=\"{ width: layout.endSpacing + 'px', height: '100%', flexShrink: 0 }\"\n    />\n    <div v-else :style=\"{ height: layout.endSpacing + 'px', width: '100%' }\" />\n\n    <!-- optional overlay components -->\n    <component v-for=\"(el, i) in props.overlayElements\" :is=\"el\" :key=\"i\" />\n  </div>\n</template>\n"],"names":["f","c","p","R","e","o","d","t","u","s","n","g","i","a","v","z","y","useScrollPlugin","usePlugin","ScrollPlugin","useScrollCapability","useCapability","useScroll","scroll","currentPage","ref","totalPages","watchEffect","onCleanup","off","pageNumber","tp","props","__props","attrs","useAttrs","scrollProvides","scrollPlugin","registry","useRegistry","layout","l","onMounted","_a","pageSlotProps","pl","core","rootStyle","computed","ScrollStrategy","_unref","_openBlock","_createElementBlock","_mergeProps","_normalizeStyle","_createElementVNode","_Fragment","_renderList","item","_renderSlot","_ctx","el","_createBlock","_resolveDynamicComponent"],"mappings":"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"}