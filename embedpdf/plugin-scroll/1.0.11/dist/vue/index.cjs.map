{"version":3,"file":"index.cjs","sources":["../../../core/dist/vue/index.js","../../src/vue/hooks/use-scroll.ts","../../src/vue/components/scroller.vue"],"sourcesContent":["import { inject as p, ref as u, onMounted as a, onBeforeUnmount as l, shallowRef as d, watch as v, computed as y, defineComponent as m, provide as P, renderSlot as w } from \"vue\";\nimport { a as h, P as S } from \"../math-ChSRQF3r.js\";\nconst f = Symbol(\"pdfKey\");\nfunction c() {\n  const r = p(f);\n  if (!r) throw new Error(\"useRegistry must be used inside <EmbedPDF>\");\n  return r;\n}\nfunction b() {\n  const { registry: r } = c(), e = u();\n  return a(() => {\n    const o = r.value.getStore();\n    e.value = o.getState().core;\n    const t = o.subscribe((s, n, i) => {\n      o.isCoreAction(s) && !h(n.core, i.core) && (e.value = n.core);\n    });\n    l(t);\n  }), e;\n}\nfunction R(r) {\n  const { registry: e } = c(), o = d(null), t = u(!0), s = u(new Promise(() => {\n  })), n = () => {\n    var g;\n    if (!e.value) return;\n    const i = e.value.getPlugin(r);\n    if (!i) throw new Error(`Plugin ${r} not found`);\n    o.value = i, t.value = !1, s.value = ((g = i.ready) == null ? void 0 : g.call(i)) ?? Promise.resolve();\n  };\n  return a(n), v(e, n), { plugin: o, isLoading: t, ready: s };\n}\nfunction z(r) {\n  const { plugin: e, isLoading: o, ready: t } = R(r);\n  return { provides: y(() => {\n    if (!e.value) return null;\n    if (!e.value.provides)\n      throw new Error(`Plugin ${r} does not implement provides()`);\n    return e.value.provides();\n  }), isLoading: o, ready: t };\n}\nfunction C() {\n  const { registry: r } = c(), e = u();\n  function o() {\n    return r.value ? (e.value = r.value.getStore().getState(), r.value.getStore().subscribe((s, n) => e.value = n)) : () => {\n    };\n  }\n  let t = o();\n  return v(r, () => {\n    t == null || t(), t = o();\n  }), l(() => t == null ? void 0 : t()), e;\n}\nconst F = /* @__PURE__ */ m({\n  __name: \"embed-pdf\",\n  props: {\n    engine: {},\n    plugins: {},\n    onInitialized: { type: Function }\n  },\n  setup(r) {\n    const e = r, o = d(null), t = u(!0), s = u(!1);\n    return P(f, { registry: o, isInitializing: t, pluginsReady: s }), a(async () => {\n      var i;\n      const n = new S(e.engine);\n      n.registerPluginBatch(e.plugins), await n.initialize(), await ((i = e.onInitialized) == null ? void 0 : i.call(e, n)), o.value = n, t.value = !1, n.pluginsReady().then(() => s.value = !0);\n    }), l(() => {\n      var n;\n      return (n = o.value) == null ? void 0 : n.destroy();\n    }), (n, i) => w(n.$slots, \"default\", {\n      registry: o.value,\n      isInitializing: t.value,\n      pluginsReady: s.value\n    });\n  }\n});\nexport {\n  F as EmbedPDF,\n  z as useCapability,\n  b as useCoreState,\n  R as usePlugin,\n  c as useRegistry,\n  C as useStoreState\n};\n//# sourceMappingURL=index.js.map\n","import { ref, watchEffect } from 'vue';\nimport { useCapability, usePlugin } from '@embedpdf/core/vue';\nimport { ScrollPlugin } from '@embedpdf/plugin-scroll';\n\nexport const useScrollPlugin = () => usePlugin<ScrollPlugin>(ScrollPlugin.id);\nexport const useScrollCapability = () => useCapability<ScrollPlugin>(ScrollPlugin.id);\n\n/**\n * Convenience hook that also tracks current / total page.\n */\nexport function useScroll() {\n  const { provides: scroll } = useScrollCapability();\n\n  const currentPage = ref(1);\n  const totalPages = ref(1);\n\n  watchEffect((onCleanup) => {\n    if (!scroll.value) return;\n\n    const off = scroll.value.onPageChange(({ pageNumber, totalPages: tp }) => {\n      currentPage.value = pageNumber;\n      totalPages.value = tp;\n    });\n    onCleanup(off);\n  });\n\n  return {\n    scroll,\n    currentPage,\n    totalPages,\n  };\n}\n","<script setup lang=\"ts\">\n/* ------------------------------------------------------------------ */\n/* imports                                                            */\n/* ------------------------------------------------------------------ */\nimport { computed, onMounted, ref, watchEffect, useAttrs } from 'vue';\nimport type { StyleValue } from 'vue';\n\nimport { useScrollCapability, useScrollPlugin } from '../hooks';\nimport { ScrollStrategy, type ScrollerLayout, type PageLayout } from '@embedpdf/plugin-scroll';\nimport { useRegistry } from '@embedpdf/core/vue';\nimport type { PdfDocumentObject, Rotation } from '@embedpdf/models';\n\n/* ------------------------------------------------------------------ */\n/* props â€“Â pure layout; page content comes from the *slot*            */\n/* ------------------------------------------------------------------ */\nconst props = withDefaults(\n  defineProps<{\n    style?: StyleValue;\n    overlayElements?: any[];\n  }>(),\n  { overlayElements: () => [] },\n);\n\nconst attrs = useAttrs();\n\n/* ------------------------------------------------------------------ */\n/* plugin + reactive state                                            */\n/* ------------------------------------------------------------------ */\nconst { provides: scrollProvides } = useScrollCapability();\nconst { plugin: scrollPlugin } = useScrollPlugin();\nconst { registry } = useRegistry(); // shallowRef<PluginRegistry|null>\n\nconst layout = ref<ScrollerLayout | null>(null);\n\n/* subscribe to scrollerâ€‘layout updates */\nwatchEffect((onCleanup) => {\n  if (!scrollProvides.value) return;\n\n  layout.value = scrollProvides.value.getScrollerLayout();\n  const off = scrollProvides.value.onScrollerData((l) => (layout.value = l));\n  onCleanup(off);\n});\n\n/* inform plugin once the DOM is ready */\nonMounted(() => {\n  scrollPlugin.value?.setLayoutReady();\n});\n\n/* ------------------------------------------------------------------ */\n/* helpers                                                            */\n/* ------------------------------------------------------------------ */\ninterface PageSlotProps extends PageLayout {\n  rotation: Rotation;\n  scale: number;\n  document: PdfDocumentObject | null;\n}\n\n/** Build the prop object that weâ€™ll forward into the default slot */\nfunction pageSlotProps(pl: PageLayout): PageSlotProps {\n  const core = registry.value!.getStore().getState().core;\n  return {\n    ...pl,\n    rotation: core.rotation,\n    scale: core.scale,\n    document: core.document,\n  };\n}\n\n/* ------------------------------------------------------------------ */\n/* computed root style                                                */\n/* ------------------------------------------------------------------ */\nconst rootStyle = computed<StyleValue>(() => {\n  if (!layout.value) return props.style;\n\n  const base =\n    typeof props.style === 'object' && !Array.isArray(props.style)\n      ? { ...props.style }\n      : (props.style ?? {});\n\n  return [\n    base,\n    {\n      width: `${layout.value.totalWidth}px`,\n      height: `${layout.value.totalHeight}px`,\n      position: 'relative',\n      boxSizing: 'border-box',\n      margin: '0 auto',\n      ...(layout.value.strategy === ScrollStrategy.Horizontal && {\n        display: 'flex',\n        flexDirection: 'row',\n      }),\n    },\n  ];\n});\n</script>\n\n<template>\n  <!-- render nothing until both layout + registry exist -->\n  <div v-if=\"layout && registry\" :style=\"rootStyle\" v-bind=\"attrs\">\n    <!-- leading spacer -->\n    <div\n      v-if=\"layout.strategy === 'horizontal'\"\n      :style=\"{ width: layout.startSpacing + 'px', height: '100%', flexShrink: 0 }\"\n    />\n    <div v-else :style=\"{ height: layout.startSpacing + 'px', width: '100%' }\" />\n\n    <!-- actual page grid -->\n    <div\n      :style=\"{\n        gap: layout.pageGap + 'px',\n        display: 'flex',\n        alignItems: 'center',\n        position: 'relative',\n        boxSizing: 'border-box',\n        flexDirection: layout.strategy === 'horizontal' ? 'row' : 'column',\n        minHeight: layout.strategy === 'horizontal' ? '100%' : undefined,\n        minWidth: layout.strategy === 'vertical' ? 'fit-content' : undefined,\n      }\"\n    >\n      <template v-for=\"item in layout.items\" :key=\"item.pageNumbers[0]\">\n        <div :style=\"{ display: 'flex', justifyContent: 'center', gap: layout.pageGap + 'px' }\">\n          <div\n            v-for=\"pl in item.pageLayouts\"\n            :key=\"pl.pageNumber\"\n            :style=\"{ width: pl.rotatedWidth + 'px', height: pl.rotatedHeight + 'px' }\"\n          >\n            <!-- ðŸ”‘ give the host app full control over page content -->\n            <slot :page=\"pageSlotProps(pl)\" />\n          </div>\n        </div>\n      </template>\n    </div>\n\n    <!-- trailing spacer -->\n    <div\n      v-if=\"layout.strategy === 'horizontal'\"\n      :style=\"{ width: layout.endSpacing + 'px', height: '100%', flexShrink: 0 }\"\n    />\n    <div v-else :style=\"{ height: layout.endSpacing + 'px', width: '100%' }\" />\n\n    <!-- optional overlay components -->\n    <component v-for=\"(el, i) in props.overlayElements\" :is=\"el\" :key=\"i\" />\n  </div>\n</template>\n"],"names":["f","c","r","p","R","e","o","d","t","u","s","n","g","i","a","v","z","y","useScrollPlugin","usePlugin","ScrollPlugin","useScrollCapability","useCapability","useScroll","scroll","currentPage","ref","totalPages","watchEffect","onCleanup","off","pageNumber","tp","props","__props","attrs","useAttrs","scrollProvides","scrollPlugin","registry","useRegistry","layout","l","onMounted","pageSlotProps","pl","core","rootStyle","computed","ScrollStrategy","_unref","_openBlock","_createElementBlock","_mergeProps","_normalizeStyle","_createElementVNode","_Fragment","_renderList","item","_renderSlot","_ctx","el","_createBlock","_resolveDynamicComponent"],"mappings":"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"}