{"version":3,"file":"index.js","sources":["../../../core/dist/preact/index.js","../../src/preact/hooks/use-scroll.ts","../../src/preact/components/scroller.tsx"],"sourcesContent":["import { createContext as b } from \"preact\";\nimport { u as w } from \"../jsxRuntime.module-Bzuv3cXw.js\";\nimport { useState as a, useRef as m, useEffect as f, useContext as S } from \"preact/hooks\";\nimport { P as v, a as C } from \"../math-ChSRQF3r.js\";\nconst P = b({\n  registry: null,\n  isInitializing: !0,\n  pluginsReady: !1\n});\nfunction F({ engine: t, onInitialized: r, plugins: e, children: i }) {\n  const [o, s] = a(null), [u, c] = a(!0), [y, d] = a(!1), l = m(r);\n  return f(() => {\n    l.current = r;\n  }, [r]), f(() => {\n    const n = new v(t);\n    return n.registerPluginBatch(e), (async () => {\n      var p;\n      await n.initialize(), !n.isDestroyed() && (await ((p = l.current) == null ? void 0 : p.call(l, n)), !n.isDestroyed() && (n.pluginsReady().then(() => {\n        n.isDestroyed() || d(!0);\n      }), s(n), c(!1)));\n    })().catch(console.error), () => {\n      n.destroy(), s(null), c(!0), d(!1);\n    };\n  }, [t, e]), /* @__PURE__ */ w(P.Provider, { value: { registry: o, isInitializing: u, pluginsReady: y }, children: typeof i == \"function\" ? i({ registry: o, isInitializing: u, pluginsReady: y }) : i });\n}\nfunction g() {\n  const t = S(P);\n  if (t === void 0)\n    throw new Error(\"useCapability must be used within a PDFContext.Provider\");\n  const { registry: r, isInitializing: e } = t;\n  if (e)\n    return t;\n  if (r === null)\n    throw new Error(\"PDF registry failed to initialize properly\");\n  return t;\n}\nfunction h(t) {\n  const { registry: r } = g();\n  if (r === null)\n    return {\n      plugin: null,\n      isLoading: !0,\n      ready: new Promise(() => {\n      })\n    };\n  const e = r.getPlugin(t);\n  if (!e)\n    throw new Error(`Plugin ${t} not found`);\n  return {\n    plugin: e,\n    isLoading: !1,\n    ready: e.ready()\n  };\n}\nfunction L(t) {\n  const { plugin: r, isLoading: e, ready: i } = h(t);\n  if (!r)\n    return {\n      provides: null,\n      isLoading: e,\n      ready: i\n    };\n  if (!r.provides)\n    throw new Error(`Plugin ${t} does not provide a capability`);\n  return {\n    provides: r.provides(),\n    isLoading: e,\n    ready: i\n  };\n}\nfunction V() {\n  const { registry: t } = g(), [r, e] = a(null);\n  return f(() => {\n    if (!t) return;\n    e(t.getStore().getState());\n    const i = t.getStore().subscribe((o, s) => {\n      e(s);\n    });\n    return () => i();\n  }, [t]), r;\n}\nfunction $() {\n  const { registry: t } = g(), [r, e] = a(null);\n  return f(() => {\n    if (!t) return;\n    const i = t.getStore();\n    e(i.getState().core);\n    const o = i.subscribe((s, u, c) => {\n      i.isCoreAction(s) && !C(u.core, c.core) && e(u.core);\n    });\n    return () => o();\n  }, [t]), r;\n}\nexport {\n  F as EmbedPDF,\n  P as PDFContext,\n  L as useCapability,\n  $ as useCoreState,\n  h as usePlugin,\n  g as useRegistry,\n  V as useStoreState\n};\n//# sourceMappingURL=index.js.map\n","import { useCapability, usePlugin } from '@embedpdf/core/preact';\nimport { ScrollPlugin } from '@embedpdf/plugin-scroll';\nimport { useEffect, useState } from 'preact/hooks';\n\nexport const useScrollPlugin = () => usePlugin<ScrollPlugin>(ScrollPlugin.id);\nexport const useScrollCapability = () => useCapability<ScrollPlugin>(ScrollPlugin.id);\n\nexport const useScroll = () => {\n  const { provides: scroll } = useScrollCapability();\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n\n  useEffect(() => {\n    if (!scroll) return;\n    return scroll.onPageChange(({ pageNumber, totalPages }) => {\n      setCurrentPage(pageNumber);\n      setTotalPages(totalPages);\n    });\n  }, [scroll]);\n\n  return {\n    ...scroll,\n    currentPage,\n    totalPages,\n  };\n};\n","/** @jsxImportSource preact */\nimport { JSX } from 'preact';\nimport { useEffect, useState } from 'preact/hooks';\nimport { ScrollStrategy, ScrollerLayout, PageLayout } from '@embedpdf/plugin-scroll';\nimport { useRegistry } from '@embedpdf/core/preact';\nimport { PdfDocumentObject, Rotation } from '@embedpdf/models';\n\nimport { useScrollCapability, useScrollPlugin } from '../hooks';\n\ninterface RenderPageProps extends PageLayout {\n  rotation: Rotation;\n  scale: number;\n  document: PdfDocumentObject | null;\n}\n\ntype ScrollerProps = JSX.HTMLAttributes<HTMLDivElement> & {\n  renderPage: (props: RenderPageProps) => JSX.Element;\n  overlayElements?: JSX.Element[];\n};\n\nexport function Scroller({ renderPage, overlayElements, ...props }: ScrollerProps) {\n  const { provides: scrollProvides } = useScrollCapability();\n  const { plugin: scrollPlugin } = useScrollPlugin();\n  const { registry } = useRegistry();\n  const [scrollerLayout, setScrollerLayout] = useState<ScrollerLayout | null>(\n    () => scrollProvides?.getScrollerLayout() ?? null,\n  );\n\n  useEffect(() => {\n    if (!scrollProvides) return;\n\n    return scrollProvides.onScrollerData(setScrollerLayout);\n  }, [scrollProvides]);\n\n  useEffect(() => {\n    if (!scrollPlugin) return;\n\n    scrollPlugin.setLayoutReady();\n  }, [scrollPlugin]);\n\n  if (!scrollerLayout) return null;\n  if (!registry) return null;\n\n  const coreState = registry.getStore().getState();\n\n  return (\n    <div\n      {...props}\n      style={{\n        width: `${scrollerLayout.totalWidth}px`,\n        height: `${scrollerLayout.totalHeight}px`,\n        position: 'relative',\n        boxSizing: 'border-box',\n        margin: '0 auto',\n        ...(scrollerLayout.strategy === ScrollStrategy.Horizontal && {\n          display: 'flex',\n          flexDirection: 'row',\n        }),\n      }}\n    >\n      <div\n        style={{\n          ...(scrollerLayout.strategy === ScrollStrategy.Horizontal\n            ? {\n                width: scrollerLayout.startSpacing,\n                height: '100%',\n                flexShrink: 0,\n              }\n            : {\n                height: scrollerLayout.startSpacing,\n                width: '100%',\n              }),\n        }}\n      />\n      <div\n        style={{\n          gap: scrollerLayout.pageGap,\n          display: 'flex',\n          alignItems: 'center',\n          position: 'relative',\n          boxSizing: 'border-box',\n          ...(scrollerLayout.strategy === ScrollStrategy.Horizontal\n            ? {\n                flexDirection: 'row',\n                minHeight: '100%',\n              }\n            : {\n                flexDirection: 'column',\n                minWidth: 'fit-content',\n              }),\n        }}\n      >\n        {scrollerLayout.items.map((item) => (\n          <div\n            key={item.pageNumbers[0]}\n            style={{\n              display: 'flex',\n              justifyContent: 'center',\n              gap: scrollerLayout.pageGap,\n            }}\n          >\n            {item.pageLayouts.map((layout) => (\n              <div\n                key={layout.pageNumber}\n                style={{\n                  width: `${layout.rotatedWidth}px`,\n                  height: `${layout.rotatedHeight}px`,\n                }}\n              >\n                {renderPage({\n                  ...layout,\n                  rotation: coreState.core.rotation,\n                  scale: coreState.core.scale,\n                  document: coreState.core.document,\n                })}\n              </div>\n            ))}\n          </div>\n        ))}\n      </div>\n      <div\n        style={{\n          ...(scrollerLayout.strategy === ScrollStrategy.Horizontal\n            ? {\n                width: scrollerLayout.endSpacing,\n                height: '100%',\n                flexShrink: 0,\n              }\n            : {\n                height: scrollerLayout.endSpacing,\n                width: '100%',\n              }),\n        }}\n      />\n      {overlayElements}\n    </div>\n  );\n}\n"],"names":["P","b","g","S","e","h","L","i","useScrollPlugin","usePlugin","ScrollPlugin","useScrollCapability","useCapability","useScroll","scroll","currentPage","setCurrentPage","useState","totalPages","setTotalPages","useEffect","pageNumber","Scroller","renderPage","overlayElements","props","scrollProvides","scrollPlugin","registry","useRegistry","scrollerLayout","setScrollerLayout","coreState","jsxs","ScrollStrategy","jsx","item","layout"],"mappings":"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"}