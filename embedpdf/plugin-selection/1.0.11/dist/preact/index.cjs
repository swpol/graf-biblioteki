"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const E=require("preact"),o=require("preact/hooks"),d=require("../selection-plugin-DJLc-Ifx.cjs"),m=require("../jsxRuntime.module-BSRTsKji.cjs"),z=require("../index-Q-vI1_iw-D2nGhF_a.cjs"),F=E.createContext({registry:null,isInitializing:!0,pluginsReady:!1});function M(){const e=o.useContext(F);if(e===void 0)throw new Error("useCapability must be used within a PDFContext.Provider");const{registry:t,isInitializing:r}=e;if(r)return e;if(t===null)throw new Error("PDF registry failed to initialize properly");return e}function L(e){const{registry:t}=M();if(t===null)return{plugin:null,isLoading:!0,ready:new Promise(()=>{})};const r=t.getPlugin(e);if(!r)throw new Error(`Plugin ${e} not found`);return{plugin:r,isLoading:!1,ready:r.ready()}}function A(e){const{plugin:t,isLoading:r,ready:i}=L(e);if(!t)return{provides:null,isLoading:r,ready:i};if(!t.provides)throw new Error(`Plugin ${e} does not provide a capability`);return{provides:t.provides(),isLoading:r,ready:i}}const y=()=>A(d.SelectionPlugin.id),q=()=>L(d.SelectionPlugin.id),D=E.createContext({registry:null,isInitializing:!0,pluginsReady:!1});function _(){const e=o.useContext(D);if(e===void 0)throw new Error("useCapability must be used within a PDFContext.Provider");const{registry:t,isInitializing:r}=e;if(r)return e;if(t===null)throw new Error("PDF registry failed to initialize properly");return e}function k(e){const{registry:t}=_();if(t===null)return{plugin:null,isLoading:!0,ready:new Promise(()=>{})};const r=t.getPlugin(e);if(!r)throw new Error(`Plugin ${e} not found`);return{plugin:r,isLoading:!1,ready:r.ready()}}function T(e){const{plugin:t,isLoading:r,ready:i}=k(e);if(!t)return{provides:null,isLoading:r,ready:i};if(!t.provides)throw new Error(`Plugin ${e} does not provide a capability`);return{provides:t.provides(),isLoading:r,ready:i}}const v=()=>T(z.w.id);function $(){const{provides:e}=v();return{setCursor:(t,r,i=0)=>{e==null||e.setCursor(t,r,i)},removeCursor:t=>{e==null||e.removeCursor(t)}}}function j({modeId:e,pageIndex:t}){const{provides:r}=v();return{register:(i,u)=>{const a=(u==null?void 0:u.modeId)??e,c=(u==null?void 0:u.pageIndex)??t;return a?r==null?void 0:r.registerHandlers({modeId:a,handlers:i,pageIndex:c}):r==null?void 0:r.registerAlways({scope:c!==void 0?{type:"page",pageIndex:c}:{type:"global"},handlers:i})}}}function B({pageIndex:e,scale:t,background:r="rgba(33,150,243)"}){const{provides:i}=y(),{provides:u}=v(),{register:a}=j({pageIndex:e}),[c,h]=o.useState([]),[l,w]=o.useState(null),{setCursor:S,removeCursor:x}=$(),p=o.useRef(null);o.useEffect(()=>{if(i)return i.onSelectionChange(()=>{(u==null?void 0:u.getActiveMode())==="default"?(h(i.getHighlightRectsForPage(e)),w(i.getBoundingRectForPage(e))):(h([]),w(null))})},[i,e]);const C=o.useCallback(n=>{const s=p.current;return s?d.glyphAt(s,n):-1},[]);o.useEffect(()=>{if(!i)return;const n=i.getGeometry(e);return n.wait(s=>p.current=s,d.ignore),()=>{n.abort({code:d.PdfErrorCode.Cancelled,message:"Cancelled"}),p.current=null}},[i,e]);const P=o.useMemo(()=>({onPointerDown:(n,s,g)=>{if(!i||!i.isEnabledForMode(g))return;i.clear(),i.getGeometry(e).wait(R=>{const b=d.glyphAt(R,n);b!==-1&&i.begin(e,b)},d.ignore)},onPointerMove:(n,s,g)=>{if(!i||!i.isEnabledForMode(g))return;const f=C(n);f!==-1?S("selection-text","text",10):x("selection-text"),f!==-1&&i.update(e,f)},onPointerUp:(n,s,g)=>{i&&i.isEnabledForMode(g)&&i.end()},onHandlerActiveEnd(n){i&&i.isEnabledForMode(n)&&i.clear()}}),[i,e,C]);return o.useEffect(()=>{if(a)return a(P)},[a,P]),l?m.u("div",{style:{position:"absolute",left:l.origin.x*t,top:l.origin.y*t,width:l.size.width*t,height:l.size.height*t,mixBlendMode:"multiply",isolation:"isolate"},children:c.map((n,s)=>m.u("div",{style:{position:"absolute",left:(n.origin.x-l.origin.x)*t,top:(n.origin.y-l.origin.y)*t,width:n.size.width*t,height:n.size.height*t,background:r,pointerEvents:"none"}},s))}):null}function G(){const{provides:e}=y();return o.useEffect(()=>{if(e)return e.onCopyToClipboard(t=>{navigator.clipboard.writeText(t)})},[e]),null}exports.CopyToClipboard=G;exports.SelectionLayer=B;exports.useSelectionCapability=y;exports.useSelectionPlugin=q;
//# sourceMappingURL=index.cjs.map
