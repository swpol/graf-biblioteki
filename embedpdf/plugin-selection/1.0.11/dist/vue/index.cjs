"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const n=require("vue"),p=require("../selection-plugin-DJLc-Ifx.cjs"),P=require("../index-Q-vI1_iw-D2nGhF_a.cjs"),E=Symbol("pdfKey");function C(){const t=n.inject(E);if(!t)throw new Error("useRegistry must be used inside <EmbedPDF>");return t}function b(t){const{registry:o}=C(),e=n.shallowRef(null),l=n.ref(!0),i=n.ref(new Promise(()=>{})),s=()=>{var d;if(!o.value)return;const a=o.value.getPlugin(t);if(!a)throw new Error(`Plugin ${t} not found`);e.value=a,l.value=!1,i.value=((d=a.ready)==null?void 0:d.call(a))??Promise.resolve()};return n.onMounted(s),n.watch(o,s),{plugin:e,isLoading:l,ready:i}}function I(t){const{plugin:o,isLoading:e,ready:l}=b(t);return{provides:n.computed(()=>{if(!o.value)return null;if(!o.value.provides)throw new Error(`Plugin ${t} does not implement provides()`);return o.value.provides()}),isLoading:e,ready:l}}const m=()=>I(p.SelectionPlugin.id),S=()=>b(p.SelectionPlugin.id),k=Symbol("pdfKey");function $(){const t=n.inject(k);if(!t)throw new Error("useRegistry must be used inside <EmbedPDF>");return t}function F(t){const{registry:o}=$(),e=n.shallowRef(null),l=n.ref(!0),i=n.ref(new Promise(()=>{})),s=()=>{var d;if(!o.value)return;const a=o.value.getPlugin(t);if(!a)throw new Error(`Plugin ${t} not found`);e.value=a,l.value=!1,i.value=((d=a.ready)==null?void 0:d.call(a))??Promise.resolve()};return n.onMounted(s),n.watch(o,s),{plugin:e,isLoading:l,ready:i}}function M(t){const{plugin:o,isLoading:e,ready:l}=F(t);return{provides:n.computed(()=>{if(!o.value)return null;if(!o.value.provides)throw new Error(`Plugin ${t} does not implement provides()`);return o.value.provides()}),isLoading:e,ready:l}}const y=()=>M(P.w.id);function _(){const{provides:t}=y();return{setCursor:(o,e,l=0)=>{var i;(i=t.value)==null||i.setCursor(o,e,l)},removeCursor:o=>{var e;(e=t.value)==null||e.removeCursor(o)}}}function L({modeId:t,pageIndex:o}){const{provides:e}=y();return{register:(l,i)=>{const s=(i==null?void 0:i.modeId)??t,d=(i==null?void 0:i.pageIndex)??o;if(e.value)return s?e.value.registerHandlers({modeId:s,handlers:l,pageIndex:d}):e.value.registerAlways({scope:d!==void 0?{type:"page",pageIndex:d}:{type:"global"},handlers:l})}}}const B=n.defineComponent({__name:"selection-layer",props:{pageIndex:{},scale:{},background:{default:"rgba(33, 150, 243)"}},setup(t){const o=t,{provides:e}=m(),{provides:l}=y(),{register:i}=L({pageIndex:o.pageIndex}),{setCursor:s,removeCursor:d}=_(),a=n.ref([]),v=n.ref(null);n.watchEffect(r=>{if(e.value){const c=e.value.onSelectionChange(()=>{var g;((g=l.value)==null?void 0:g.getActiveMode())==="default"?(a.value=e.value.getHighlightRectsForPage(o.pageIndex),v.value=e.value.getBoundingRectForPage(o.pageIndex)):(a.value=[],v.value=null)});r(c)}});let f;n.watchEffect(r=>{if(e.value){const c=e.value.getGeometry(o.pageIndex);c.wait(u=>f=u,p.ignore),r(()=>{c.abort({code:p.PdfErrorCode.Cancelled,message:"SelectionLayer unmounted"})})}});const w=n.computed(()=>({onPointerDown:(r,c,u)=>{if(!e.value||!e.value.isEnabledForMode(u))return;e.value.clear(),e.value.getGeometry(o.pageIndex).wait(x=>{const h=p.glyphAt(x,r);h!==-1&&e.value.begin(o.pageIndex,h)},p.ignore)},onPointerMove:(r,c,u)=>{if(!e.value||!e.value.isEnabledForMode(u))return;const g=f?p.glyphAt(f,r):-1;g!==-1?(s("selection-text","text",10),e.value.update(o.pageIndex,g)):d("selection-text")},onPointerUp:(r,c,u)=>{!e.value||!e.value.isEnabledForMode(u)||e.value.end()},onHandlerActiveEnd:r=>{!e.value||!e.value.isEnabledForMode(r)||e.value.clear()}}));return n.watchEffect(r=>{if(i){const c=i(w.value);c&&r(c)}}),(r,c)=>v.value?(n.openBlock(),n.createElementBlock("div",{key:0,style:n.normalizeStyle({position:"absolute",left:`${v.value.origin.x*r.scale}px`,top:`${v.value.origin.y*r.scale}px`,width:`${v.value.size.width*r.scale}px`,height:`${v.value.size.height*r.scale}px`,mixBlendMode:"multiply",isolation:"isolate",pointerEvents:"none"})},[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(a.value,(u,g)=>(n.openBlock(),n.createElementBlock("div",{key:g,style:n.normalizeStyle({position:"absolute",left:`${(u.origin.x-v.value.origin.x)*r.scale}px`,top:`${(u.origin.y-v.value.origin.y)*r.scale}px`,width:`${u.size.width*r.scale}px`,height:`${u.size.height*r.scale}px`,background:r.background})},null,4))),128))],4)):n.createCommentVNode("",!0)}}),R=n.defineComponent({__name:"copy-to-clipboard",setup(t){const{provides:o}=m();return n.watchEffect(e=>{if(o.value){const l=o.value.onCopyToClipboard(i=>{navigator.clipboard.writeText(i).catch(s=>{console.error("Failed to copy text to clipboard:",s)})});e(l)}}),(e,l)=>null}});exports.CopyToClipboard=R;exports.SelectionLayer=B;exports.useSelectionCapability=m;exports.useSelectionPlugin=S;
//# sourceMappingURL=index.cjs.map
