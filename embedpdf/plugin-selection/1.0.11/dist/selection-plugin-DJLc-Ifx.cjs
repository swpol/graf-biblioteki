"use strict";const q="SET_DOCUMENT";var K="­",Q="​",P="⁠",tt="\uFEFF",et="￾",it="￿",nt=Object.freeze([K,Q,P,tt,et,it]);new RegExp(`[${nt.join("")}]`,"g");var A=Object.freeze([{id:0,label:"Normal",css:"normal"},{id:1,label:"Multiply",css:"multiply"},{id:2,label:"Screen",css:"screen"},{id:3,label:"Overlay",css:"overlay"},{id:4,label:"Darken",css:"darken"},{id:5,label:"Lighten",css:"lighten"},{id:6,label:"Color Dodge",css:"color-dodge"},{id:7,label:"Color Burn",css:"color-burn"},{id:8,label:"Hard Light",css:"hard-light"},{id:9,label:"Soft Light",css:"soft-light"},{id:10,label:"Difference",css:"difference"},{id:11,label:"Exclusion",css:"exclusion"},{id:12,label:"Hue",css:"hue"},{id:13,label:"Saturation",css:"saturation"},{id:14,label:"Color",css:"color"},{id:15,label:"Luminosity",css:"luminosity"}]);A.reduce((e,t)=>(e[t.id]=t,e),{});A.reduce((e,t)=>(e[t.css]=t.id,e),{});A.map(e=>({value:e.id,label:e.label}));var st=Object.freeze({1:"invisible",2:"hidden",4:"print",8:"noZoom",16:"noRotate",32:"noView",64:"readOnly",128:"locked",256:"toggleNoView"});Object.entries(st).reduce((e,[t,i])=>(e[i]=Number(t),e),{});function f(e,t,i){if(e===t)return!0;if(e==null||t==null)return e===t;const n=typeof e;if(n!==typeof t)return!1;if(n==="object"){i||(i=new Set);const s=ot(e,t);if(i.has(s))return!0;i.add(s);const o=Array.isArray(e),c=Array.isArray(t);return o&&c?ct(e,t,i):!o&&!c?rt(e,t,i):!1}return!1}function ot(e,t){return`${E(e)}__${E(t)}`}let at=0;const v=new WeakMap;function E(e){return v.has(e)||v.set(e,++at),v.get(e)}function ct(e,t,i){if(e.length!==t.length)return!1;const n=new Array(t.length).fill(!1);t:for(let s=0;s<e.length;s++){const o=e[s];for(let c=0;c<t.length;c++)if(!n[c]&&f(o,t[c],i)){n[c]=!0;continue t}return!1}return!0}function rt(e,t,i){const n=Object.keys(e).sort(),s=Object.keys(t).sort();if(n.length!==s.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!==s[o])return!1;for(const o of n){const c=e[o],a=t[o];if(!f(c,a,i))return!1}return!0}class lt{constructor(t,i){if(this.id=t,this.registry=i,this.debouncedActions={},this.unsubscribeFromState=null,this.unsubscribeFromCoreStore=null,t!==this.constructor.id)throw new Error(`Plugin ID mismatch: ${t} !== ${this.constructor.id}`);this.coreStore=this.registry.getStore(),this.pluginStore=this.coreStore.getPluginStore(this.id),this.unsubscribeFromState=this.pluginStore.subscribeToState((n,s,o)=>{this.onStoreUpdated(o,s)}),this.unsubscribeFromCoreStore=this.coreStore.subscribe((n,s,o)=>{this.onCoreStoreUpdated(o,s)}),this.readyPromise=new Promise(n=>{this.readyResolve=n}),this.readyResolve()}provides(){if(!this._capability){const t=this.buildCapability();this._capability=Object.freeze(t)}return this._capability}get state(){return this.pluginStore.getState()}get coreState(){return this.coreStore.getState()}getState(){return this.pluginStore.getState()}getCoreState(){return this.coreStore.getState()}dispatchCoreAction(t){return this.coreStore.dispatchToCore(t)}dispatchToAllPlugins(t){return this.coreStore.dispatch(t)}dispatch(t){return this.pluginStore.dispatch(t)}debouncedDispatch(t,i=100){const n=Date.now(),s=this.debouncedActions[t.type]||0;return n-s>=i?(this.debouncedActions[t.type]=n,this.dispatch(t),!0):!1}subscribe(t){return this.pluginStore.subscribeToState(t)}subscribeToCoreStore(t){return this.coreStore.subscribe(t)}onStoreUpdated(t,i){}onCoreStoreUpdated(t,i){}destroy(){this.unsubscribeFromState&&(this.unsubscribeFromState(),this.unsubscribeFromState=null),this.unsubscribeFromCoreStore&&(this.unsubscribeFromCoreStore(),this.unsubscribeFromCoreStore=null)}ready(){return this.readyPromise}markReady(){this.readyResolve()}resetReady(){this.readyPromise=new Promise(t=>{this.readyResolve=t})}}class ht{constructor(t,i){this.handler=t,this.options=i,this.lastRun=0,this.handle=n=>{this.options.mode==="debounce"?this.debounce(n):this.throttle(n)}}debounce(t){this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.handler(t),this.timeoutId=void 0},this.options.wait)}throttle(t){if(this.options.mode==="debounce")return;const i=Date.now(),n=this.options.throttleMode||"leading-trailing";i-this.lastRun>=this.options.wait&&(n==="leading-trailing"&&this.handler(t),this.lastRun=i),this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.handler(t),this.lastRun=Date.now(),this.timeoutId=void 0},this.options.wait-(i-this.lastRun))}destroy(){this.timeoutId&&window.clearTimeout(this.timeoutId)}}function C(){const e=new Set;return{emit:(t=void 0)=>e.forEach(i=>i(t)),on:t=>(e.add(t),()=>e.delete(t)),off:t=>e.delete(t),clear:()=>e.clear()}}function L(e,t=f){const i=new Set,n=new Map;let s=e;const o=a=>i.forEach(r=>r(a)),c=(a,r)=>{let u=a,l=()=>{};if(r){const h=new ht(a,r);u=h.handle,l=()=>h.destroy(),n.set(a,{wrapped:u,destroy:l})}return s!==void 0&&u(s),i.add(u),()=>{i.delete(u),l(),n.delete(a)}};return{get value(){return s},emit(a=void 0){(s===void 0||!t(s,a))&&(s=a,o(a))},on:c,off(a){const r=n.get(a);r?(i.delete(r.wrapped),r.destroy(),n.delete(a)):i.delete(a)},clear(){i.clear(),n.forEach(a=>a.destroy()),n.clear()},select(a,r=f){return(u,l)=>{let h;if(s!==void 0){const d=a(s);h=d,u(d)}return c(d=>{const g=a(d);(h===void 0||!r(h,g))&&(h=g,u(g))},l)}}}}function z(e){if(e.length===0)return null;let t=e[0].origin.x,i=e[0].origin.y,n=e[0].origin.x+e[0].size.width,s=e[0].origin.y+e[0].size.height;for(const o of e)t=Math.min(t,o.origin.x),i=Math.min(i,o.origin.y),n=Math.max(n,o.origin.x+o.size.width),s=Math.max(s,o.origin.y+o.size.height);return{origin:{x:t,y:i},size:{width:n-t,height:s-i}}}var ut=class extends Error{constructor(e){super(`Task aborted: ${JSON.stringify(e)}`),this.name="TaskAbortedError"}},dt=class extends Error{constructor(e){super(`Task rejected: ${JSON.stringify(e)}`),this.name="TaskRejectedError"}},p=class S{constructor(){this.state={stage:0},this.resolvedCallbacks=[],this.rejectedCallbacks=[],this._promise=null}toPromise(){return this._promise||(this._promise=new Promise((t,i)=>{this.wait(n=>t(n),n=>{n.type==="abort"?i(new ut(n.reason)):i(new dt(n.reason))})})),this._promise}wait(t,i){switch(this.state.stage){case 0:this.resolvedCallbacks.push(t),this.rejectedCallbacks.push(i);break;case 1:t(this.state.result);break;case 2:i({type:"reject",reason:this.state.reason});break;case 3:i({type:"abort",reason:this.state.reason});break}}resolve(t){if(this.state.stage===0){this.state={stage:1,result:t};for(const i of this.resolvedCallbacks)try{i(t)}catch{}this.resolvedCallbacks=[],this.rejectedCallbacks=[]}}reject(t){if(this.state.stage===0){this.state={stage:2,reason:t};for(const i of this.rejectedCallbacks)try{i({type:"reject",reason:t})}catch{}this.resolvedCallbacks=[],this.rejectedCallbacks=[]}}abort(t){if(this.state.stage===0){this.state={stage:3,reason:t};for(const i of this.rejectedCallbacks)try{i({type:"abort",reason:t})}catch{}this.resolvedCallbacks=[],this.rejectedCallbacks=[]}}fail(t){t.type==="abort"?this.abort(t.reason):this.reject(t.reason)}static all(t){const i=new S;if(t.length===0)return i.resolve([]),i;const n=new Array(t.length);let s=0,o=!1;return t.forEach((c,a)=>{c.wait(r=>{o||(n[a]=r,s++,s===t.length&&(o=!0,i.resolve(n)))},r=>{o||(o=!0,r.type==="abort"?i.abort(r.reason):i.reject(r.reason))})}),i}static allSettled(t){const i=new S;if(t.length===0)return i.resolve([]),i;const n=new Array(t.length);let s=0;return t.forEach((o,c)=>{o.wait(a=>{n[c]={status:"resolved",value:a},s++,s===t.length&&i.resolve(n)},a=>{n[c]={status:a.type==="abort"?"aborted":"rejected",reason:a.reason},s++,s===t.length&&i.resolve(n)})}),i}static race(t){const i=new S;if(t.length===0)return i.reject("No tasks provided"),i;let n=!1;return t.forEach(s=>{s.wait(o=>{n||(n=!0,i.resolve(o))},o=>{n||(n=!0,o.type==="abort"?i.abort(o.reason):i.reject(o.reason))})}),i}static withProgress(t,i){const n=S.all(t);if(i){let s=0;t.forEach(o=>{o.wait(()=>{s++,i(s,t.length)},()=>{s++,i(s,t.length)})})}return n}},gt="­",bt="​",St="⁠",pt="\uFEFF",mt="￾",yt="￿",ft=Object.freeze([gt,bt,St,pt,mt,yt]);new RegExp(`[${ft.join("")}]`,"g");var O=Object.freeze([{id:0,label:"Normal",css:"normal"},{id:1,label:"Multiply",css:"multiply"},{id:2,label:"Screen",css:"screen"},{id:3,label:"Overlay",css:"overlay"},{id:4,label:"Darken",css:"darken"},{id:5,label:"Lighten",css:"lighten"},{id:6,label:"Color Dodge",css:"color-dodge"},{id:7,label:"Color Burn",css:"color-burn"},{id:8,label:"Hard Light",css:"hard-light"},{id:9,label:"Soft Light",css:"soft-light"},{id:10,label:"Difference",css:"difference"},{id:11,label:"Exclusion",css:"exclusion"},{id:12,label:"Hue",css:"hue"},{id:13,label:"Saturation",css:"saturation"},{id:14,label:"Color",css:"color"},{id:15,label:"Luminosity",css:"luminosity"}]);O.reduce((e,t)=>(e[t.id]=t,e),{});O.reduce((e,t)=>(e[t.css]=t.id,e),{});O.map(e=>({value:e.id,label:e.label}));var wt=Object.freeze({1:"invisible",2:"hidden",4:"print",8:"noZoom",16:"noRotate",32:"noView",64:"readOnly",128:"locked",256:"toggleNoView"});Object.entries(wt).reduce((e,[t,i])=>(e[i]=Number(t),e),{});var w=(e=>(e[e.Ok=0]="Ok",e[e.Unknown=1]="Unknown",e[e.NotFound=2]="NotFound",e[e.WrongFormat=3]="WrongFormat",e[e.Password=4]="Password",e[e.Security=5]="Security",e[e.PageError=6]="PageError",e[e.XFALoad=7]="XFALoad",e[e.XFALayout=8]="XFALayout",e[e.Cancelled=9]="Cancelled",e[e.Initialization=10]="Initialization",e[e.NotReady=11]="NotReady",e[e.NotSupport=12]="NotSupport",e[e.LoadDoc=13]="LoadDoc",e[e.DocNotOpen=14]="DocNotOpen",e[e.CantCloseDoc=15]="CantCloseDoc",e[e.CantCreateNewDoc=16]="CantCreateNewDoc",e[e.CantImportPages=17]="CantImportPages",e[e.CantCreateAnnot=18]="CantCreateAnnot",e[e.CantSetAnnotRect=19]="CantSetAnnotRect",e[e.CantSetAnnotContent=20]="CantSetAnnotContent",e[e.CantRemoveInkList=21]="CantRemoveInkList",e[e.CantAddInkStoke=22]="CantAddInkStoke",e[e.CantReadAttachmentSize=23]="CantReadAttachmentSize",e[e.CantReadAttachmentContent=24]="CantReadAttachmentContent",e[e.CantFocusAnnot=25]="CantFocusAnnot",e[e.CantSelectText=26]="CantSelectText",e[e.CantSelectOption=27]="CantSelectOption",e[e.CantCheckField=28]="CantCheckField",e))(w||{}),m=class{static create(){return new p}static resolve(e){const t=new p;return t.resolve(e),t}static reject(e){const t=new p;return t.reject(e),t}static abort(e){const t=new p;return t.reject(e),t}};function y(){}const M="CACHE_PAGE_GEOMETRY",j="SET_SELECTION",_="START_SELECTION",D="END_SELECTION",$="CLEAR_SELECTION",H="SET_RECTS",B="SET_SLICES",G="RESET",Rt=(e,t)=>({type:M,payload:{page:e,geo:t}}),Tt=e=>({type:j,payload:e}),xt=()=>({type:_}),vt=()=>({type:D}),Ct=()=>({type:$}),Ft=e=>({type:H,payload:e}),At=e=>({type:B,payload:e}),Ot=()=>({type:G});function U(e,t){return e.rects[t]??[]}function I(e,t){return z(U(e,t))}function It(e){const t=[],i=e.rects;for(const n in i){const s=Number(n),o=z(i[s]);o&&t.push({page:s,rect:o})}return t}function kt(e,t){const i=e.rects[t]||[];if(i.length===0)return null;const n=I(e,t);return n?{pageIndex:t,rect:n,segmentRects:i}:null}function Nt(e){const t=[],i=Object.keys(e.rects).map(Number);for(const n of i){const s=e.rects[n]||[];if(s.length===0)continue;const o=I(e,n);o&&t.push({pageIndex:n,rect:o,segmentRects:s})}return t}function Et(e,t){for(const i of e.runs){if(!(t.y>=i.rect.y&&t.y<=i.rect.y+i.rect.height&&t.x>=i.rect.x&&t.x<=i.rect.x+i.rect.width))continue;const s=i.glyphs.findIndex(o=>t.x>=o.x&&t.x<=o.x+o.width&&t.y>=o.y&&t.y<=o.y+o.height);if(s!==-1)return i.charStart+s}return-1}function V(e,t,i){if(!e||!t||i<e.start.page||i>e.end.page)return null;const n=i===e.start.page?e.start.index:0,s=t.runs[t.runs.length-1],o=s.charStart+s.glyphs.length-1,c=i===e.end.page?e.end.index:o;return{from:n,to:c}}function W(e,t,i,n=!0){const s=[];for(const o of e.runs){const c=o.charStart,a=c+o.glyphs.length-1;if(a<t||c>i)continue;const r=Math.max(t,c)-c,u=Math.min(i,a)-c;let l=1/0,h=-1/0,d=1/0,g=-1/0,T=0;for(let x=r;x<=u;x++){const b=o.glyphs[x];b.flags!==2&&(l=Math.min(l,b.x),h=Math.max(h,b.x+b.width),d=Math.min(d,b.y),g=Math.max(g,b.y+b.height),T++)}l!==1/0&&T>0&&s.push({rect:{origin:{x:l,y:d},size:{width:h-l,height:g-d}},charCount:T})}return n?J(s):s.map(o=>o.rect)}function k(e,t){const i=Math.min(e.origin.x,t.origin.x),n=Math.min(e.origin.y,t.origin.y),s=Math.max(e.origin.x+e.size.width,t.origin.x+t.size.width),o=Math.max(e.origin.y+e.size.height,t.origin.y+t.size.height);return{origin:{x:i,y:n},size:{width:s-i,height:o-n}}}function X(e,t){const i=Math.max(e.origin.x,t.origin.x),n=Math.max(e.origin.y,t.origin.y),s=Math.min(e.origin.x+e.size.width,t.origin.x+t.size.width),o=Math.min(e.origin.y+e.size.height,t.origin.y+t.size.height),c=Math.max(0,s-i),a=Math.max(0,o-n);return{origin:{x:i,y:n},size:{width:c,height:a}}}function R(e){return e.size.width<=0||e.size.height<=0}function Y(e,t){if(R(e)||R(t))return 0;const i=k(e,t);return i.size.height===e.size.height||i.size.height===t.size.height?1:X(e,t).size.height/i.size.height}function Z(e,t){const n=e.rect,s=t.rect;if(Y(n,s)<.8)return!1;const o=1,c=o*n.size.width/e.charCount,a=o*s.size.width/t.charCount,r=n.origin.x-c,u=n.origin.x+n.size.width+c,l=s.origin.x-a,h=s.origin.x+s.size.width+a;return r<h&&u>l}function J(e){const t=[];let i=null,n=null;for(const s of e)i&&n?Z(i,s)?n=k(n,s.rect):(t.push(n),n=s.rect):n=s.rect,i=s;return n&&!R(n)&&t.push(n),t}const N=class N extends lt{constructor(t,i,n){super(t,i),this.engine=n,this.enabledModes=new Set(["default"]),this.selecting=!1,this.selChange$=L(),this.textRetrieved$=L(),this.copyToClipboard$=C(),this.beginSelection$=C(),this.endSelection$=C(),this.coreStore.onAction(q,s=>{this.dispatch(Ot())})}async initialize(){}async destroy(){this.selChange$.clear()}buildCapability(){return{getGeometry:t=>this.getOrLoadGeometry(t),getFormattedSelection:()=>Nt(this.state),getFormattedSelectionForPage:t=>kt(this.state,t),getHighlightRectsForPage:t=>U(this.state,t),getHighlightRects:()=>this.state.rects,getBoundingRectForPage:t=>I(this.state,t),getBoundingRects:()=>It(this.state),begin:(t,i)=>this.beginSelection(t,i),update:(t,i)=>this.updateSelection(t,i),end:()=>this.endSelection(),clear:()=>this.clearSelection(),onCopyToClipboard:this.copyToClipboard$.on,onSelectionChange:this.selChange$.on,onTextRetrieved:this.textRetrieved$.on,onBeginSelection:this.beginSelection$.on,onEndSelection:this.endSelection$.on,getSelectedText:()=>this.getSelectedText(),copyToClipboard:()=>this.copyToClipboard(),enableForMode:t=>this.enabledModes.add(t),isEnabledForMode:t=>this.enabledModes.has(t),getState:()=>this.state}}getOrLoadGeometry(t){const i=this.state.geometry[t];if(i)return m.resolve(i);if(!this.coreState.core.document)return m.reject({code:w.NotFound,message:"Doc Not Found"});const n=this.coreState.core.document.pages.find(o=>o.index===t),s=this.engine.getPageGeometry(this.coreState.core.document,n);return s.wait(o=>{this.dispatch(Rt(t,o))},y),s}beginSelection(t,i){this.selecting=!0,this.anchor={page:t,index:i},this.dispatch(xt()),this.beginSelection$.emit({page:t,index:i})}endSelection(){this.selecting=!1,this.anchor=void 0,this.dispatch(vt()),this.endSelection$.emit()}clearSelection(){this.selecting=!1,this.anchor=void 0,this.dispatch(Ct()),this.selChange$.emit(null)}updateSelection(t,i){if(!this.selecting||!this.anchor)return;const n=this.anchor,s=t>n.page||t===n.page&&i>=n.index,a={start:s?n:{page:t,index:i},end:s?{page:t,index:i}:n};this.dispatch(Tt(a)),this.updateRectsAndSlices(a),this.selChange$.emit(a)}updateRectsAndSlices(t){const i={},n={};for(let s=t.start.page;s<=t.end.page;s++){const o=this.state.geometry[s],c=V(t,o,s);c&&(i[s]=W(o,c.from,c.to),n[s]={start:c.from,count:c.to-c.from+1})}this.dispatch(Ft(i)),this.dispatch(At(n))}getSelectedText(){if(!this.coreState.core.document||!this.state.selection)return m.reject({code:w.NotFound,message:"Doc Not Found or No Selection"});const t=this.state.selection,i=[];for(let s=t.start.page;s<=t.end.page;s++){const o=this.state.slices[s];o&&i.push({pageIndex:s,charIndex:o.start,charCount:o.count})}if(i.length===0)return m.resolve([]);const n=this.engine.getTextSlices(this.coreState.core.document,i);return n.wait(s=>{this.textRetrieved$.emit(s)},y),n}copyToClipboard(){this.getSelectedText().wait(i=>{this.copyToClipboard$.emit(i.join(`
`))},y)}};N.id="selection";let F=N;exports.CACHE_PAGE_GEOMETRY=M;exports.CLEAR_SELECTION=$;exports.END_SELECTION=D;exports.PdfErrorCode=w;exports.RESET=G;exports.SET_RECTS=H;exports.SET_SELECTION=j;exports.SET_SLICES=B;exports.START_SELECTION=_;exports.SelectionPlugin=F;exports.getVerticalOverlap=Y;exports.glyphAt=Et;exports.ignore=y;exports.mergeAdjacentRects=J;exports.rectIntersect=X;exports.rectIsEmpty=R;exports.rectUnion=k;exports.rectsWithinSlice=W;exports.shouldMergeHorizontalRects=Z;exports.sliceBounds=V;
//# sourceMappingURL=selection-plugin-DJLc-Ifx.cjs.map
