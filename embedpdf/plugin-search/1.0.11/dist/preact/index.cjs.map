{"version":3,"sources":["../../src/preact/index.ts","../../src/preact/hooks/use-search.ts","../../src/preact/components/search-layer.tsx"],"sourcesContent":["export * from './hooks';\nexport * from './components';\n","import { useCapability, usePlugin } from '@embedpdf/core/preact';\nimport { SearchPlugin, SearchState } from '@embedpdf/plugin-search';\nimport { useEffect, useState } from 'preact/hooks';\n\nexport const useSearchPlugin = () => usePlugin<SearchPlugin>(SearchPlugin.id);\nexport const useSearchCapability = () => useCapability<SearchPlugin>(SearchPlugin.id);\n\nexport const useSearch = () => {\n  const { provides } = useSearchCapability();\n  const [searchState, setSearchState] = useState<SearchState>({\n    flags: [],\n    results: [],\n    total: 0,\n    activeResultIndex: 0,\n    showAllResults: true,\n    query: '',\n    loading: false,\n    active: false,\n  });\n\n  useEffect(() => {\n    return provides?.onStateChange((state) => setSearchState(state));\n  }, [provides]);\n\n  return {\n    state: searchState,\n    provides,\n  };\n};\n","/** @jsxImportSource preact */\nimport { ComponentChildren, Fragment, JSX } from 'preact';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { SearchResultState } from '@embedpdf/plugin-search';\n\nimport { useSearchCapability } from '../hooks';\n\ntype SearchLayoutProps = Omit<JSX.HTMLAttributes<HTMLDivElement>, 'style'> & {\n  pageIndex: number;\n  scale: number;\n  highlightColor?: string;\n  activeHighlightColor?: string;\n  style?: JSX.CSSProperties;\n};\n\nexport function SearchLayer({\n  pageIndex,\n  scale,\n  style,\n  highlightColor = '#FFFF00',\n  activeHighlightColor = '#FFBF00',\n  ...props\n}: SearchLayoutProps) {\n  const { provides: searchProvides } = useSearchCapability();\n  const [searchResultState, setSearchResultState] = useState<SearchResultState | null>(null);\n\n  useEffect(() => {\n    return searchProvides?.onSearchResultStateChange((state) => {\n      setSearchResultState(state);\n    });\n  }, [searchProvides]);\n\n  if (!searchResultState) {\n    return null;\n  }\n\n  // Filter results for current page while preserving original indices\n  const pageResults = searchResultState.results\n    .map((result, originalIndex) => ({ result, originalIndex }))\n    .filter(({ result }) => result.pageIndex === pageIndex);\n\n  return (\n    <div\n      style={{\n        ...style,\n      }}\n      {...props}\n    >\n      {pageResults.map(({ result, originalIndex }) =>\n        result.rects.map((rect) => (\n          <div\n            style={{\n              position: 'absolute',\n              top: rect.origin.y * scale,\n              left: rect.origin.x * scale,\n              width: rect.size.width * scale,\n              height: rect.size.height * scale,\n              backgroundColor:\n                originalIndex === searchResultState.activeResultIndex\n                  ? activeHighlightColor\n                  : highlightColor,\n              mixBlendMode: 'multiply',\n              transform: 'scale(1.02)',\n              transformOrigin: 'center',\n              transition: 'opacity .3s ease-in-out',\n              opacity: 1,\n            }}\n          ></div>\n        )),\n      )}\n    </div>\n  );\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAA,oBAAyC;AACzC,2BAA0C;AAC1C,mBAAoC;AAE7B,IAAM,kBAAkB,UAAM,yBAAwB,kCAAa,EAAE;AACrE,IAAM,sBAAsB,UAAM,6BAA4B,kCAAa,EAAE;AAE7E,IAAM,YAAY,MAAM;AAC7B,QAAM,EAAE,SAAS,IAAI,oBAAoB;AACzC,QAAM,CAAC,aAAa,cAAc,QAAI,uBAAsB;AAAA,IAC1D,OAAO,CAAC;AAAA,IACR,SAAS,CAAC;AAAA,IACV,OAAO;AAAA,IACP,mBAAmB;AAAA,IACnB,gBAAgB;AAAA,IAChB,OAAO;AAAA,IACP,SAAS;AAAA,IACT,QAAQ;AAAA,EACV,CAAC;AAED,8BAAU,MAAM;AACd,WAAO,UAAU,cAAc,CAAC,UAAU,eAAe,KAAK,CAAC;AAAA,EACjE,GAAG,CAAC,QAAQ,CAAC;AAEb,SAAO;AAAA,IACL,OAAO;AAAA,IACP;AAAA,EACF;AACF;;;AC1BA,IAAAA,gBAA4C;AAgDlC;AAnCH,SAAS,YAAY;AAAA,EAC1B;AAAA,EACA;AAAA,EACA;AAAA,EACA,iBAAiB;AAAA,EACjB,uBAAuB;AAAA,EACvB,GAAG;AACL,GAAsB;AACpB,QAAM,EAAE,UAAU,eAAe,IAAI,oBAAoB;AACzD,QAAM,CAAC,mBAAmB,oBAAoB,QAAI,wBAAmC,IAAI;AAEzF,+BAAU,MAAM;AACd,WAAO,gBAAgB,0BAA0B,CAAC,UAAU;AAC1D,2BAAqB,KAAK;AAAA,IAC5B,CAAC;AAAA,EACH,GAAG,CAAC,cAAc,CAAC;AAEnB,MAAI,CAAC,mBAAmB;AACtB,WAAO;AAAA,EACT;AAGA,QAAM,cAAc,kBAAkB,QACnC,IAAI,CAAC,QAAQ,mBAAmB,EAAE,QAAQ,cAAc,EAAE,EAC1D,OAAO,CAAC,EAAE,OAAO,MAAM,OAAO,cAAc,SAAS;AAExD,SACE;AAAA,IAAC;AAAA;AAAA,MACC,OAAO;AAAA,QACL,GAAG;AAAA,MACL;AAAA,MACC,GAAG;AAAA,MAEH,sBAAY;AAAA,QAAI,CAAC,EAAE,QAAQ,cAAc,MACxC,OAAO,MAAM,IAAI,CAAC,SAChB;AAAA,UAAC;AAAA;AAAA,YACC,OAAO;AAAA,cACL,UAAU;AAAA,cACV,KAAK,KAAK,OAAO,IAAI;AAAA,cACrB,MAAM,KAAK,OAAO,IAAI;AAAA,cACtB,OAAO,KAAK,KAAK,QAAQ;AAAA,cACzB,QAAQ,KAAK,KAAK,SAAS;AAAA,cAC3B,iBACE,kBAAkB,kBAAkB,oBAChC,uBACA;AAAA,cACN,cAAc;AAAA,cACd,WAAW;AAAA,cACX,iBAAiB;AAAA,cACjB,YAAY;AAAA,cACZ,SAAS;AAAA,YACX;AAAA;AAAA,QACD,CACF;AAAA,MACH;AAAA;AAAA,EACF;AAEJ;","names":["import_hooks"]}